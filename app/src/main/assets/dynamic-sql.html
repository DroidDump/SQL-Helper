<!DOCTYPE html><html lang="ru-RU"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="viewport" content="width=device-width"><title>Oracle/PLSQL динамический SQL &#8212; SQL Helper</title><link rel="stylesheet" href="wp-content/cache/min/1/fa8990c4217289171489528cd3f70146.css" media="all" data-minify="1"><script type="text/javascript" src="wp-includes/js/jquery/jquery.min.js?ver=3.6.1" id="jquery-core-js" defer=""></script><link rel="stylesheet" href="css/style.css"></head><body class="post-template-default single single-post postid-8212 single-format-standard one-sidebar-left medium-sidebar large-font-sidebar large-font-content"><div id="page" class="hfeed site"><header id="masthead" class="site-header" role="banner"><div class="site-branding"><h1 class="site-title"><a href="index.html" rel="home">SQL Helper</a></h1></div><nav role="navigation" class="site-navigation main-navigation"><h1 class="assistive-text">Menu</h1><div class="assistive-text skip-link"><a href="#content" title="Skip to content">Skip to content</a></div><div class="menu-sql-container"><ul id="menu-sql" class="menu"><li id="menu-item-2533" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-2533"><a href="sql-language.html">SQL</a></li><li id="menu-item-7341" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-7341"><a href="contents-oracle-plsql.html">Oracle PL/SQL</a></li><li id="menu-item-3192" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3192"><a href="mysql-manual.html">MySQL</a></li><li id="menu-item-7342" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-7342"><a href="contents-sql-server.html">SQL Server</a></li><li id="menu-item-7343" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-7343"><a href="sqlite-manual.html">SQLite</a></li><li id="menu-item-6422" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-6422"><a href="postgresql-manual.html">PostgreSQL</a></li><li id="menu-item-7201" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-7201"><a href="mariadb-manual.html">MariaDB</a></li></ul></div></nav></header><div id="main" class="site-main"><div id="primary" class="content-area"><div id="content" class="site-content" role="main"><article id="post-8212" class="post-8212 post type-post status-publish format-standard hentry category-oracle-programming"><header class="entry-header"><h1 class="entry-title">Oracle/PLSQL динамический SQL</h1><div class="entry-meta"></div></header><div class="entry-content"><p>В этом учебном материале вы узнаете, как использовать динамический SQL в Oracle/PLSQL с синтаксисом и примерами.<br><span id="more-8212"></span></p><h2>Описание</h2><ul><li>Динамический SQL делает ваши программы более гибкими, создавая и обрабатывая SQL предложения во время выполнения программ.</li><li>С динамическим SQL вы можете напрямую выполнять большинство типов операторов SQL, включая определение данных и операторы управления данными.</li><li>Вы можете строить запросы, в которых вы заранее не знаете имен таблиц, предложений <a href="where.html">WHERE</a> и другой информации.</li></ul><h2>Оператор EXECUTE IMMEDIATE</h2><p>Oracle/PLSQL оператор EXECUTE IMMEDIATE подготавливает (анализирует) и немедленно выполняет динамический SQL-запрос или <a href="anonymous-block-plsql.html">анонимный PL/SQL блок</a>.<br>Основным аргументом EXECUTE IMMEDIATE является строка, содержащая SQL-запрос для выполнения. Вы можете создать строку, используя <a href="concat-operator.html">конкатенацию</a>, или использовать предопределенную строку.<br>Динамическая строка может содержать любой оператор SQL (без последней точки с запятой), за исключением многострочных запросов или любой PL/SQL блок (с последней точкой с запятой).<br>Строка <span class="arg">dynamic_string</span> также может содержать заполнители, произвольные имена, которым предшествует двоеточие, для аргументов связывания <span class="arg">bind_argument</span>. В этом случае вы указываете, какие переменные PL/SQL соответствуют заполнителям, с помощью операторов INTO, USING и RETURNING INTO. Во время выполнения аргументы связывания заменяют соответствующие заполнители в динамической строке. Каждый заполнитель должен быть связан с аргументом связывания в предложении USING и/или предложении RETURNING INTO.</p><h2>Синтаксис</h2><p>Синтаксис Oracle/PLSQL оператора EXECUTE IMMEDIATE для передачи значения в переменную или строку:</p><div class="sintax">EXECUTE IMMEDIATE dynamic_string<br>[ INTO {[define_variable[, define_variable] ... | record_name}]<br>[USING [IN | OUT | IN OUT] bind_argument ]<br>returning_clause;</div><p>или синтаксис Oracle/PLSQL оператора EXECUTE IMMEDIATE для передачи значения в коллекцию</p><div class="sintax">EXECUTE IMMEDIATE dynamic_string<br>[[ BULK COLLECT] INTO {host_array_name | collection_name}]<br>[USING [IN | OUT | IN OUT] bind_argument]<br>returning_clause;</div><h2>Параметры или аргументы</h2><dl><dt>dynamic_string</dt><dd>Строковый литерал, переменная или выражение, представляющее один оператор SQL или блок PL/SQL. Он должен иметь тип CHAR или VARCHAR2, а не NCHAR или NVARCHAR2.</dd><dt>BULK COLLECT</dt><dd>Сохраняет значения результатов в одной или нескольких коллекциях для более быстрых запросов, чем циклы с операторами FETCH.</dd><dt>INTO</dt><dd>Используется только для однострочных запросов, в этом разделе указываются переменные или записи, в которые извлекаются значения столбцов. Для каждого значения, полученного запросом, в предложении INTO должна быть соответствующая тип-совместимая переменная или поле.</dd><dt>define_variable</dt><dd>Переменная, в которой сохраняется значение выбранного столбца.</dd><dt>record_name</dt><dd>Пользовательская запись или запись <a href="rowtype-oracle-plsql.html">%ROWTYPE</a>, в которой сохраняется выбранная строка.</dd><dt>bind_argument</dt><dd>Выражение, значение которого передается в динамический оператор SQL, или переменная, в которой сохраняется значение, возвращаемое динамическим оператором SQL.</dd><dt>collection_name</dt><dd>Объявленная коллекция, в которую извлекаются значения select_item из <span class="arg">dynamic_string</span>. Для каждого select_item должна быть соответствующая, совместимая с типом коллекция в списке.</dd><dt>host_array_name</dt><dd>Массив (объявленный в хост-среде PL/SQL и переданный PL/SQL как переменная связывания), в который извлекаются значения select_item. Для каждого select_item должен быть соответствующий, совместимый с типом массив в списке. Массивы хоста должны начинаться с двоеточия.</dd><dt>USING</dt><dd>По умолчанию - IN. Определяет список входных и/или выходных аргументов привязки.</dd><dt>returning_clause</dt><dd>Возвращает значения из вставленных строк, устраняя необходимость SELECT строки после. Вы можете извлечь значения столбца в переменные или в коллекции. Вы не можете использовать предложение RETURNING для удаленной или параллельной вставки. Если инструкция не влияет ни на какие строки, значения переменных, указанных в предложении RETURNING, не определены.</dd></dl><h2>Примеры:</h2><ul><li><a href="#evry">Некоторые примеры динамического SQL</a></li><li><a href="#prcdyn">Пример процедуры динамического SQL, которая принимает имя таблицы и предложение WHERE</a></li><li><a href="#pardyn">Указание режимов параметров для переменных связывания в строках динамического SQL</a></li><li><a href="#qerdyn">Построение динамического запроса с помощью динамического SQL</a></li><li><a href="#typdyn">Примеры динамического SQL для типов объектов и коллекций</a></li><li><a href="#bulkdyn">Использование Bulk (множественного) SQL в динамическом SQL</a></li><li><a href="#usbulkdyn">Использование динамического SQL с Bulk SQL</a></li><li><a href="#bulkcoldyn">Примеры динамический SQL с предложением BULK COLLECT INTO</a></li><li><a href="#bulkintdyn">Пример динамический SQL с предложением RETURNING BULK COLLECT INTO</a></li><li><a href="#bulkfordyn">Пример динамический SQL внутри оператора FORALL</a></li><li><a href="#rekomdyn">Рекомендации по динамическому SQL</a></li><li><a href="#whdyn">Когда использовать или пропустить точку с запятой с помощью динамического SQL</a></li><li><a href="#updyn">Повышение производительности динамического SQL с помощью переменных связывания</a></li><li><a href="#passdyn">Передача имен объектов схемы в качестве параметров</a></li><li><a href="#dubldyn">Использование дублирующих заполнителей с динамическим SQL</a></li><li><a href="#atrdyn">Использование атрибутов курсора с динамическим SQL</a></li><li><a href="#nulldyn">Передача NULL в динамический SQL</a></li><li><a href="#relatdyn">Использование связей базы данных с динамическим SQL</a></li><li><a href="#invdyn">Использование прав Invoker с динамическим SQL</a></li><li><a href="#deadlockdyn">Как избежать тупиков с помощью динамического SQL</a></li></ul><p><a name="evry"></a></p><h3>Некоторые примеры динамического SQL</h3><p>Рассмотрим несколько примеров использования Oracle/PLSQL оператора EXECUTE IMMEDIATE, чтобы понять как использовать EXECUTE IMMEDIATE в Oracle/PLSQL.<br><strong>Описание команд в комментариях (--).</strong></p><div id="crayon-63f843893d21f441278119" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top:12px;margin-bottom:12px;font-size:12px!important;line-height:15px!important"><div class="crayon-toolbar" data-settings=" show" style="font-size:12px!important;height:18px!important;line-height:18px!important"><span class="crayon-title"></span><div class="crayon-tools" style="font-size:12px!important;height:18px!important;line-height:18px!important"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Oracle PL/SQL</span></div></div><div class="crayon-info" style="min-height:16.8px!important;line-height:16.8px!important"></div><div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4;font-size:12px!important;line-height:15px!important">
DECLARE
sql_stmt    VARCHAR2(200);
plsql_block VARCHAR2(500);
emp_id      NUMBER(4) := 7566;
salary      NUMBER(7,2);
dept_id     NUMBER(2) := 50;
dept_name   VARCHAR2(14) := 'PERSONNEL';
location    VARCHAR2(13) := 'DALLAS';
emp_rec     emp%ROWTYPE;
BEGIN
--EXECUTE IMMEDIATE c SQL предложением
EXECUTE IMMEDIATE 'CREATE TABLE bonus (id NUMBER, amt NUMBER)';
--присвоим sql_stmt строковое SQL предложение с заполнителями :1, :2, :3
sql_stmt := 'INSERT INTO dept VALUES (:1, :2, :3)';
--запустим EXECUTE IMMEDIATE с sql_stmt используя аргументы связывания dept_id, dept_name, location
EXECUTE IMMEDIATE sql_stmt USING dept_id, dept_name, location;
--присвоим sql_stmt SQL предложение с заполнителем :id
sql_stmt := 'SELECT * FROM emp WHERE empno = :id';
--запустим EXECUTE IMMEDIATE с sql_stmt используя аргумент связывания emp_id и сохраним результат в emp_rec
EXECUTE IMMEDIATE sql_stmt INTO emp_rec USING emp_id;
--присвоим plsql_block запуск анонимного блока с подпрограммой raise_salary пакета emp_pkg с заполнителями :id, :amt
plsql_block := 'BEGIN emp_pkg.raise_salary(:id, :amt); END;';
--запустим EXECUTE IMMEDIATE с plsql_block используя аргументы связывания :id, :amt
EXECUTE IMMEDIATE plsql_block USING 7788, 500;
--присвоим sql_stmt SQL предложение с заполнителем :1, :2
sql_stmt := 'UPDATE emp SET sal = 2000 WHERE empno = :1 RETURNING sal INTO :2';
--запустим EXECUTE IMMEDIATE с sql_stmt используя аргументы связывания emp_id, salary
EXECUTE IMMEDIATE sql_stmt USING emp_id RETURNING INTO salary;
--EXECUTE IMMEDIATE c SQL предложение с заполнителем :num и аргументом связывания dept_id
EXECUTE IMMEDIATE 'DELETE FROM dept WHERE deptno = :num' USING dept_id;
--EXECUTE IMMEDIATE c SQL предложением
EXECUTE IMMEDIATE 'ALTER SESSION SET SQL_TRACE TRUE';
END;</textarea></div><div class="crayon-main" style=""><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums" data-settings="hide"><div class="crayon-nums-content" style="font-size:12px!important;line-height:15px!important"><div class="crayon-num" data-line="crayon-63f843893d21f441278119-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d21f441278119-2">2</div><div class="crayon-num" data-line="crayon-63f843893d21f441278119-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d21f441278119-4">4</div><div class="crayon-num" data-line="crayon-63f843893d21f441278119-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d21f441278119-6">6</div><div class="crayon-num" data-line="crayon-63f843893d21f441278119-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d21f441278119-8">8</div><div class="crayon-num" data-line="crayon-63f843893d21f441278119-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d21f441278119-10">10</div><div class="crayon-num" data-line="crayon-63f843893d21f441278119-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d21f441278119-12">12</div><div class="crayon-num" data-line="crayon-63f843893d21f441278119-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d21f441278119-14">14</div><div class="crayon-num" data-line="crayon-63f843893d21f441278119-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d21f441278119-16">16</div><div class="crayon-num" data-line="crayon-63f843893d21f441278119-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d21f441278119-18">18</div><div class="crayon-num" data-line="crayon-63f843893d21f441278119-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d21f441278119-20">20</div><div class="crayon-num" data-line="crayon-63f843893d21f441278119-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d21f441278119-22">22</div><div class="crayon-num" data-line="crayon-63f843893d21f441278119-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d21f441278119-24">24</div><div class="crayon-num" data-line="crayon-63f843893d21f441278119-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d21f441278119-26">26</div><div class="crayon-num" data-line="crayon-63f843893d21f441278119-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d21f441278119-28">28</div><div class="crayon-num" data-line="crayon-63f843893d21f441278119-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d21f441278119-30">30</div><div class="crayon-num" data-line="crayon-63f843893d21f441278119-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d21f441278119-32">32</div><div class="crayon-num" data-line="crayon-63f843893d21f441278119-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d21f441278119-34">34</div><div class="crayon-num" data-line="crayon-63f843893d21f441278119-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d21f441278119-36">36</div><div class="crayon-num" data-line="crayon-63f843893d21f441278119-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d21f441278119-38">38</div><div class="crayon-num" data-line="crayon-63f843893d21f441278119-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d21f441278119-40">40</div><div class="crayon-num" data-line="crayon-63f843893d21f441278119-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d21f441278119-42">42</div><div class="crayon-num" data-line="crayon-63f843893d21f441278119-43">43</div></div></td><td class="crayon-code"><div class="crayon-pre" style="font-size:12px!important;line-height:15px!important;-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4"><div class="crayon-line" id="crayon-63f843893d21f441278119-1"><span class="crayon-r">DECLARE</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d21f441278119-2"><span class="crayon-h">&nbsp;&nbsp; </span>sql_stmt<span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">VARCHAR2</span>(200);</div><div class="crayon-line" id="crayon-63f843893d21f441278119-3"><span class="crayon-h">&nbsp;&nbsp; </span>plsql_block<span class="crayon-h"> </span><span class="crayon-r">VARCHAR2</span>(500);</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d21f441278119-4"><span class="crayon-h">&nbsp;&nbsp; </span>emp_id<span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">NUMBER</span>(4)<span class="crayon-h"> </span>:=<span class="crayon-h"> </span>7566;</div><div class="crayon-line" id="crayon-63f843893d21f441278119-5"><span class="crayon-h">&nbsp;&nbsp; </span>salary<span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">NUMBER</span>(7,2);</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d21f441278119-6"><span class="crayon-h">&nbsp;&nbsp; </span>dept_id<span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-r">NUMBER</span>(2)<span class="crayon-h"> </span>:=<span class="crayon-h"> </span>50;</div><div class="crayon-line" id="crayon-63f843893d21f441278119-7"><span class="crayon-h">&nbsp;&nbsp; </span>dept_name<span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">VARCHAR2</span>(14)<span class="crayon-h"> </span>:=<span class="crayon-h"> </span><span class="crayon-s">'PERSONNEL'</span>;</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d21f441278119-8"><span class="crayon-h">&nbsp;&nbsp; </span>location<span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">VARCHAR2</span>(13)<span class="crayon-h"> </span>:=<span class="crayon-h"> </span><span class="crayon-s">'DALLAS'</span>;</div><div class="crayon-line" id="crayon-63f843893d21f441278119-9"><span class="crayon-h">&nbsp;&nbsp; </span>emp_rec<span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp; </span>emp<span class="crayon-t">%ROWTYPE</span>;</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d21f441278119-10"><span class="crayon-r">BEGIN</span></div><div class="crayon-line" id="crayon-63f843893d21f441278119-11"><span class="crayon-c">--EXECUTE IMMEDIATE c SQL предложением</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d21f441278119-12"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">EXECUTE</span><span class="crayon-h"> </span><span class="crayon-r">IMMEDIATE</span><span class="crayon-h"> </span><span class="crayon-s">'CREATE TABLE bonus (id NUMBER, amt NUMBER)'</span>;</div><div class="crayon-line" id="crayon-63f843893d21f441278119-13">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d21f441278119-14"><span class="crayon-c">--присвоим sql_stmt строковое SQL предложение с заполнителями :1, :2, :3</span></div><div class="crayon-line" id="crayon-63f843893d21f441278119-15"><span class="crayon-h">&nbsp;&nbsp; </span>sql_stmt<span class="crayon-h"> </span>:=<span class="crayon-h"> </span><span class="crayon-s">'INSERT INTO dept VALUES (:1, :2, :3)'</span>;</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d21f441278119-16">&nbsp;</div><div class="crayon-line" id="crayon-63f843893d21f441278119-17"><span class="crayon-c">--запустим EXECUTE IMMEDIATE с sql_stmt используя аргументы связывания dept_id, dept_name, location</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d21f441278119-18"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">EXECUTE</span><span class="crayon-h"> </span><span class="crayon-r">IMMEDIATE</span><span class="crayon-h"> </span>sql_stmt<span class="crayon-h"> </span><span class="crayon-r">USING</span><span class="crayon-h"> </span>dept_id,<span class="crayon-h"> </span>dept_name,<span class="crayon-h"> </span>location;</div><div class="crayon-line" id="crayon-63f843893d21f441278119-19">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d21f441278119-20"><span class="crayon-c">--присвоим sql_stmt SQL предложение с заполнителем :id</span></div><div class="crayon-line" id="crayon-63f843893d21f441278119-21"><span class="crayon-h">&nbsp;&nbsp; </span>sql_stmt<span class="crayon-h"> </span>:=<span class="crayon-h"> </span><span class="crayon-s">'SELECT * FROM emp WHERE empno = :id'</span>;</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d21f441278119-22">&nbsp;</div><div class="crayon-line" id="crayon-63f843893d21f441278119-23"><span class="crayon-c">--запустим EXECUTE IMMEDIATE с sql_stmt используя аргумент связывания emp_id и сохраним результат в emp_rec</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d21f441278119-24"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">EXECUTE</span><span class="crayon-h"> </span><span class="crayon-r">IMMEDIATE</span><span class="crayon-h"> </span>sql_stmt<span class="crayon-h"> </span><span class="crayon-r">INTO</span><span class="crayon-h"> </span>emp_rec<span class="crayon-h"> </span><span class="crayon-r">USING</span><span class="crayon-h"> </span>emp_id;</div><div class="crayon-line" id="crayon-63f843893d21f441278119-25">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d21f441278119-26"><span class="crayon-c">--присвоим plsql_block запуск анонимного блока с подпрограммой raise_salary пакета emp_pkg с заполнителями :id, :amt</span></div><div class="crayon-line" id="crayon-63f843893d21f441278119-27"><span class="crayon-h">&nbsp;&nbsp; </span>plsql_block<span class="crayon-h"> </span>:=<span class="crayon-h"> </span><span class="crayon-s">'BEGIN emp_pkg.raise_salary(:id, :amt); END;'</span>;</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d21f441278119-28">&nbsp;</div><div class="crayon-line" id="crayon-63f843893d21f441278119-29"><span class="crayon-c">--запустим EXECUTE IMMEDIATE с plsql_block используя аргументы связывания :id, :amt&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d21f441278119-30"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">EXECUTE</span><span class="crayon-h"> </span><span class="crayon-r">IMMEDIATE</span><span class="crayon-h"> </span>plsql_block<span class="crayon-h"> </span><span class="crayon-r">USING</span><span class="crayon-h"> </span>7788,<span class="crayon-h"> </span>500;</div><div class="crayon-line" id="crayon-63f843893d21f441278119-31">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d21f441278119-32"><span class="crayon-c">--присвоим sql_stmt SQL предложение с заполнителем :1, :2</span></div><div class="crayon-line" id="crayon-63f843893d21f441278119-33"><span class="crayon-h">&nbsp;&nbsp; </span>sql_stmt<span class="crayon-h"> </span>:=<span class="crayon-h"> </span><span class="crayon-s">'UPDATE emp SET sal = 2000 WHERE empno = :1 RETURNING sal INTO :2'</span>;</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d21f441278119-34">&nbsp;</div><div class="crayon-line" id="crayon-63f843893d21f441278119-35"><span class="crayon-c">--запустим EXECUTE IMMEDIATE с sql_stmt используя аргументы связывания emp_id, salary</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d21f441278119-36"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">EXECUTE</span><span class="crayon-h"> </span><span class="crayon-r">IMMEDIATE</span><span class="crayon-h"> </span>sql_stmt<span class="crayon-h"> </span><span class="crayon-r">USING</span><span class="crayon-h"> </span>emp_id<span class="crayon-h"> </span><span class="crayon-r">RETURNING</span><span class="crayon-h"> </span><span class="crayon-r">INTO</span><span class="crayon-h"> </span>salary;</div><div class="crayon-line" id="crayon-63f843893d21f441278119-37">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d21f441278119-38"><span class="crayon-c">--EXECUTE IMMEDIATE c SQL предложение с заполнителем :num и аргументом связывания dept_id</span></div><div class="crayon-line" id="crayon-63f843893d21f441278119-39"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">EXECUTE</span><span class="crayon-h"> </span><span class="crayon-r">IMMEDIATE</span><span class="crayon-h"> </span><span class="crayon-s">'DELETE FROM dept WHERE deptno = :num'</span><span class="crayon-h"> </span><span class="crayon-r">USING</span><span class="crayon-h"> </span>dept_id;</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d21f441278119-40">&nbsp;</div><div class="crayon-line" id="crayon-63f843893d21f441278119-41"><span class="crayon-c">--EXECUTE IMMEDIATE c SQL предложением	&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d21f441278119-42"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">EXECUTE</span><span class="crayon-h"> </span><span class="crayon-r">IMMEDIATE</span><span class="crayon-h"> </span><span class="crayon-s">'ALTER SESSION SET SQL_TRACE TRUE'</span>;</div><div class="crayon-line" id="crayon-63f843893d21f441278119-43"><span class="crayon-r">END</span>;</div></div></td></tr></table></div></div><p></p><p><a name="prcdyn"></a></p><h3>Пример процедуры динамического SQL, которая принимает имя таблицы и предложение WHERE</h3><p>В этом примере автономная процедура принимает имя таблицы базы данных и необязательное условие предложения WHERE. Если вы пропустите условие, процедура удалит все строки из таблицы. В противном случае процедура удаляет только те строки, которые соответствуют условию.</p><p></p><div id="crayon-63f843893d225190812700" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top:12px;margin-bottom:12px;font-size:12px!important;line-height:15px!important"><div class="crayon-toolbar" data-settings=" show" style="font-size:12px!important;height:18px!important;line-height:18px!important"><span class="crayon-title"></span><div class="crayon-tools" style="font-size:12px!important;height:18px!important;line-height:18px!important"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Oracle PL/SQL</span></div></div><div class="crayon-info" style="min-height:16.8px!important;line-height:16.8px!important"></div><div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4;font-size:12px!important;line-height:15px!important">
CREATE OR REPLACE PROCEDURE delete_rows (
table_name IN VARCHAR2,
condition IN VARCHAR2 DEFAULT NULL) AS
where_clause VARCHAR2(100) := ' WHERE ' || condition;
BEGIN
IF condition IS NULL THEN where_clause := NULL; END IF;
EXECUTE IMMEDIATE 'DELETE FROM ' || table_name || where_clause;
END;</textarea></div><div class="crayon-main" style=""><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums" data-settings="hide"><div class="crayon-nums-content" style="font-size:12px!important;line-height:15px!important"><div class="crayon-num" data-line="crayon-63f843893d225190812700-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d225190812700-2">2</div><div class="crayon-num" data-line="crayon-63f843893d225190812700-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d225190812700-4">4</div><div class="crayon-num" data-line="crayon-63f843893d225190812700-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d225190812700-6">6</div><div class="crayon-num" data-line="crayon-63f843893d225190812700-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d225190812700-8">8</div></div></td><td class="crayon-code"><div class="crayon-pre" style="font-size:12px!important;line-height:15px!important;-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4"><div class="crayon-line" id="crayon-63f843893d225190812700-1"><span class="crayon-r">CREATE</span><span class="crayon-h"> </span><span class="crayon-r">OR</span><span class="crayon-h"> </span><span class="crayon-r">REPLACE</span><span class="crayon-h"> </span><span class="crayon-r">PROCEDURE</span><span class="crayon-h"> </span>delete_rows<span class="crayon-h"> </span>(</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d225190812700-2"><span class="crayon-h">&nbsp;&nbsp; </span>table_name<span class="crayon-h"> </span><span class="crayon-r">IN</span><span class="crayon-h"> </span><span class="crayon-r">VARCHAR2</span>,</div><div class="crayon-line" id="crayon-63f843893d225190812700-3"><span class="crayon-h">&nbsp;&nbsp; </span>condition<span class="crayon-h"> </span><span class="crayon-r">IN</span><span class="crayon-h"> </span><span class="crayon-r">VARCHAR2</span><span class="crayon-h"> </span><span class="crayon-r">DEFAULT</span><span class="crayon-h"> </span><span class="crayon-r">NULL</span>)<span class="crayon-h"> </span><span class="crayon-r">AS</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d225190812700-4"><span class="crayon-h">&nbsp;&nbsp; </span>where_clause<span class="crayon-h"> </span><span class="crayon-r">VARCHAR2</span>(100)<span class="crayon-h"> </span>:=<span class="crayon-h"> </span><span class="crayon-s">' WHERE '</span><span class="crayon-h"> </span>||<span class="crayon-h"> </span>condition;</div><div class="crayon-line" id="crayon-63f843893d225190812700-5"><span class="crayon-r">BEGIN</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d225190812700-6"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">IF</span><span class="crayon-h"> </span>condition<span class="crayon-h"> </span><span class="crayon-r">IS</span><span class="crayon-h"> </span><span class="crayon-r">NULL</span><span class="crayon-h"> </span><span class="crayon-r">THEN</span><span class="crayon-h"> </span>where_clause<span class="crayon-h"> </span>:=<span class="crayon-h"> </span><span class="crayon-r">NULL</span>;<span class="crayon-h"> </span><span class="crayon-r">END</span><span class="crayon-h"> </span><span class="crayon-r">IF</span>;</div><div class="crayon-line" id="crayon-63f843893d225190812700-7"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">EXECUTE</span><span class="crayon-h"> </span><span class="crayon-r">IMMEDIATE</span><span class="crayon-h"> </span><span class="crayon-s">'DELETE FROM '</span><span class="crayon-h"> </span>||<span class="crayon-h"> </span>table_name<span class="crayon-h"> </span>||<span class="crayon-h"> </span>where_clause;</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d225190812700-8"><span class="crayon-r">END</span>;</div></div></td></tr></table></div></div><p></p><p><a name="pardyn"></a></p><h2>Указание режимов параметров для переменных связывания в строках динамического SQL</h2><p>С предложением USING режимом по умолчанию является IN, поэтому вам не нужно указывать режим параметров для аргументов связывания ввода.<br>С предложением RETURNING INTO режим имеет значение OUT, поэтому вы не можете указать режим параметров для выходных аргументов связывания.<br>Вы должны указать режим параметров в более сложных случаях, таких как этот, где вы вызываете процедуру из динамического блока PL/SQL:</p><p>Пример</p><p></p><div id="crayon-63f843893d228873421287" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top:12px;margin-bottom:12px;font-size:12px!important;line-height:15px!important"><div class="crayon-toolbar" data-settings=" show" style="font-size:12px!important;height:18px!important;line-height:18px!important"><span class="crayon-title"></span><div class="crayon-tools" style="font-size:12px!important;height:18px!important;line-height:18px!important"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Oracle PL/SQL</span></div></div><div class="crayon-info" style="min-height:16.8px!important;line-height:16.8px!important"></div><div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4;font-size:12px!important;line-height:15px!important">
CREATE PROCEDURE create_dept (
deptno IN OUT NUMBER,
dname  IN VARCHAR2,
loc    IN VARCHAR2) AS
BEGIN
SELECT deptno_seq.NEXTVAL INTO deptno FROM dual;
INSERT INTO dept VALUES (deptno, dname, loc);
END;</textarea></div><div class="crayon-main" style=""><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums" data-settings="hide"><div class="crayon-nums-content" style="font-size:12px!important;line-height:15px!important"><div class="crayon-num" data-line="crayon-63f843893d228873421287-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d228873421287-2">2</div><div class="crayon-num" data-line="crayon-63f843893d228873421287-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d228873421287-4">4</div><div class="crayon-num" data-line="crayon-63f843893d228873421287-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d228873421287-6">6</div><div class="crayon-num" data-line="crayon-63f843893d228873421287-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d228873421287-8">8</div></div></td><td class="crayon-code"><div class="crayon-pre" style="font-size:12px!important;line-height:15px!important;-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4"><div class="crayon-line" id="crayon-63f843893d228873421287-1"><span class="crayon-r">CREATE</span><span class="crayon-h"> </span><span class="crayon-r">PROCEDURE</span><span class="crayon-h"> </span>create_dept<span class="crayon-h"> </span>(</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d228873421287-2"><span class="crayon-h">&nbsp;&nbsp; </span>deptno<span class="crayon-h"> </span><span class="crayon-r">IN</span><span class="crayon-h"> </span>OUT<span class="crayon-h"> </span><span class="crayon-r">NUMBER</span>,</div><div class="crayon-line" id="crayon-63f843893d228873421287-3"><span class="crayon-h">&nbsp;&nbsp; </span>dname<span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-r">IN</span><span class="crayon-h"> </span><span class="crayon-r">VARCHAR2</span>,</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d228873421287-4"><span class="crayon-h">&nbsp;&nbsp; </span>loc<span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">IN</span><span class="crayon-h"> </span><span class="crayon-r">VARCHAR2</span>)<span class="crayon-h"> </span><span class="crayon-r">AS</span></div><div class="crayon-line" id="crayon-63f843893d228873421287-5"><span class="crayon-r">BEGIN</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d228873421287-6"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">SELECT</span><span class="crayon-h"> </span>deptno_seq.NEXTVAL<span class="crayon-h"> </span><span class="crayon-r">INTO</span><span class="crayon-h"> </span>deptno<span class="crayon-h"> </span><span class="crayon-r">FROM</span><span class="crayon-h"> </span>dual;</div><div class="crayon-line" id="crayon-63f843893d228873421287-7"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">INSERT</span><span class="crayon-h"> </span><span class="crayon-r">INTO</span><span class="crayon-h"> </span>dept<span class="crayon-h"> </span><span class="crayon-r">VALUES</span><span class="crayon-h"> </span>(deptno,<span class="crayon-h"> </span>dname,<span class="crayon-h"> </span>loc);</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d228873421287-8"><span class="crayon-r">END</span>;</div></div></td></tr></table></div></div><p></p><p>Чтобы вызвать процедуру из динамического блока PL/SQL, необходимо указать режим IN OUT для аргумента связывания, связанного с формальным параметром <span class="arg">deptno</span>, следующим образом:</p><p></p><div id="crayon-63f843893d22b677483430" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top:12px;margin-bottom:12px;font-size:12px!important;line-height:15px!important"><div class="crayon-toolbar" data-settings=" show" style="font-size:12px!important;height:18px!important;line-height:18px!important"><span class="crayon-title"></span><div class="crayon-tools" style="font-size:12px!important;height:18px!important;line-height:18px!important"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Oracle PL/SQL</span></div></div><div class="crayon-info" style="min-height:16.8px!important;line-height:16.8px!important"></div><div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4;font-size:12px!important;line-height:15px!important">
DECLARE
plsql_block VARCHAR2(500);
new_deptno NUMBER(2);
new_dname  VARCHAR2(14) := 'ADVERTISING';
new_loc    VARCHAR2(13) := 'NEW YORK';
BEGIN
plsql_block := 'BEGIN create_dept(:a, :b, :c); END;';
EXECUTE IMMEDIATE plsql_block
USING IN OUT new_deptno, new_dname, new_loc;
IF new_deptno &gt; 90 THEN ...
END;</textarea></div><div class="crayon-main" style=""><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums" data-settings="hide"><div class="crayon-nums-content" style="font-size:12px!important;line-height:15px!important"><div class="crayon-num" data-line="crayon-63f843893d22b677483430-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d22b677483430-2">2</div><div class="crayon-num" data-line="crayon-63f843893d22b677483430-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d22b677483430-4">4</div><div class="crayon-num" data-line="crayon-63f843893d22b677483430-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d22b677483430-6">6</div><div class="crayon-num" data-line="crayon-63f843893d22b677483430-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d22b677483430-8">8</div><div class="crayon-num" data-line="crayon-63f843893d22b677483430-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d22b677483430-10">10</div><div class="crayon-num" data-line="crayon-63f843893d22b677483430-11">11</div></div></td><td class="crayon-code"><div class="crayon-pre" style="font-size:12px!important;line-height:15px!important;-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4"><div class="crayon-line" id="crayon-63f843893d22b677483430-1"><span class="crayon-r">DECLARE</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d22b677483430-2"><span class="crayon-h">&nbsp;&nbsp; </span>plsql_block<span class="crayon-h"> </span><span class="crayon-r">VARCHAR2</span>(500);</div><div class="crayon-line" id="crayon-63f843893d22b677483430-3"><span class="crayon-h">&nbsp;&nbsp; </span>new_deptno<span class="crayon-h"> </span><span class="crayon-r">NUMBER</span>(2);</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d22b677483430-4"><span class="crayon-h">&nbsp;&nbsp; </span>new_dname<span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-r">VARCHAR2</span>(14)<span class="crayon-h"> </span>:=<span class="crayon-h"> </span><span class="crayon-s">'ADVERTISING'</span>;</div><div class="crayon-line" id="crayon-63f843893d22b677483430-5"><span class="crayon-h">&nbsp;&nbsp; </span>new_loc<span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">VARCHAR2</span>(13)<span class="crayon-h"> </span>:=<span class="crayon-h"> </span><span class="crayon-s">'NEW YORK'</span>;</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d22b677483430-6"><span class="crayon-r">BEGIN</span></div><div class="crayon-line" id="crayon-63f843893d22b677483430-7"><span class="crayon-h">&nbsp;&nbsp; </span>plsql_block<span class="crayon-h"> </span>:=<span class="crayon-h"> </span><span class="crayon-s">'BEGIN create_dept(:a, :b, :c); END;'</span>;</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d22b677483430-8"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">EXECUTE</span><span class="crayon-h"> </span><span class="crayon-r">IMMEDIATE</span><span class="crayon-h"> </span>plsql_block</div><div class="crayon-line" id="crayon-63f843893d22b677483430-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">USING</span><span class="crayon-h"> </span><span class="crayon-r">IN</span><span class="crayon-h"> </span>OUT<span class="crayon-h"> </span>new_deptno,<span class="crayon-h"> </span>new_dname,<span class="crayon-h"> </span>new_loc;</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d22b677483430-10"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">IF</span><span class="crayon-h"> </span>new_deptno<span class="crayon-h"> </span><span class="crayon-h">&gt;</span><span class="crayon-h"> </span>90<span class="crayon-h"> </span><span class="crayon-r">THEN</span><span class="crayon-h"> </span>...</div><div class="crayon-line" id="crayon-63f843893d22b677483430-11"><span class="crayon-r">END</span>;</div></div></td></tr></table></div></div><p></p><p><a name="qerdyn"></a></p><h2>Построение динамического запроса с помощью динамического SQL</h2><p>Для обработки динамического многострочного запроса вы используете три оператора: OPEN-FOR, FETCH и CLOSE.<br>Сначала вы открываете переменную курсора для многострочного запроса. Затем вы выбираете строки из набора результатов по одной за раз.<br>Когда все строки обработаны, вы закрываете (CLOSE) курсорную переменную.</p><p>В следующем примере показано, как вы можете извлечь строки из результирующего набора динамического многострочного запроса в запись:</p><p></p><div id="crayon-63f843893d22d146400080" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top:12px;margin-bottom:12px;font-size:12px!important;line-height:15px!important"><div class="crayon-toolbar" data-settings=" show" style="font-size:12px!important;height:18px!important;line-height:18px!important"><span class="crayon-title"></span><div class="crayon-tools" style="font-size:12px!important;height:18px!important;line-height:18px!important"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Oracle PL/SQL</span></div></div><div class="crayon-info" style="min-height:16.8px!important;line-height:16.8px!important"></div><div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4;font-size:12px!important;line-height:15px!important">
DECLARE
TYPE EmpCurTyp IS REF CURSOR;
emp_cv   EmpCurTyp;
emp_rec  emp%ROWTYPE;
sql_stmt VARCHAR2(200);
my_job   VARCHAR2(15) := 'CLERK';
BEGIN
sql_stmt := 'SELECT * FROM emp WHERE job = :j';
OPEN emp_cv FOR sql_stmt USING my_job;
LOOP
FETCH emp_cv INTO emp_rec;
EXIT WHEN emp_cv%NOTFOUND;
-- запись процесса
END LOOP;
CLOSE emp_cv;
END;</textarea></div><div class="crayon-main" style=""><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums" data-settings="hide"><div class="crayon-nums-content" style="font-size:12px!important;line-height:15px!important"><div class="crayon-num" data-line="crayon-63f843893d22d146400080-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d22d146400080-2">2</div><div class="crayon-num" data-line="crayon-63f843893d22d146400080-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d22d146400080-4">4</div><div class="crayon-num" data-line="crayon-63f843893d22d146400080-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d22d146400080-6">6</div><div class="crayon-num" data-line="crayon-63f843893d22d146400080-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d22d146400080-8">8</div><div class="crayon-num" data-line="crayon-63f843893d22d146400080-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d22d146400080-10">10</div><div class="crayon-num" data-line="crayon-63f843893d22d146400080-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d22d146400080-12">12</div><div class="crayon-num" data-line="crayon-63f843893d22d146400080-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d22d146400080-14">14</div><div class="crayon-num" data-line="crayon-63f843893d22d146400080-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d22d146400080-16">16</div></div></td><td class="crayon-code"><div class="crayon-pre" style="font-size:12px!important;line-height:15px!important;-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4"><div class="crayon-line" id="crayon-63f843893d22d146400080-1"><span class="crayon-r">DECLARE</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d22d146400080-2"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">TYPE</span><span class="crayon-h"> </span>EmpCurTyp<span class="crayon-h"> </span><span class="crayon-r">IS</span><span class="crayon-h"> </span><span class="crayon-r">REF</span><span class="crayon-h"> </span><span class="crayon-r">CURSOR</span>;</div><div class="crayon-line" id="crayon-63f843893d22d146400080-3"><span class="crayon-h">&nbsp;&nbsp; </span>emp_cv<span class="crayon-h">&nbsp;&nbsp; </span>EmpCurTyp;</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d22d146400080-4"><span class="crayon-h">&nbsp;&nbsp; </span>emp_rec<span class="crayon-h">&nbsp;&nbsp;</span>emp<span class="crayon-t">%ROWTYPE</span>;</div><div class="crayon-line" id="crayon-63f843893d22d146400080-5"><span class="crayon-h">&nbsp;&nbsp; </span>sql_stmt<span class="crayon-h"> </span><span class="crayon-r">VARCHAR2</span>(200);</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d22d146400080-6"><span class="crayon-h">&nbsp;&nbsp; </span>my_job<span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">VARCHAR2</span>(15)<span class="crayon-h"> </span>:=<span class="crayon-h"> </span><span class="crayon-s">'CLERK'</span>;</div><div class="crayon-line" id="crayon-63f843893d22d146400080-7"><span class="crayon-r">BEGIN</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d22d146400080-8"><span class="crayon-h">&nbsp;&nbsp; </span>sql_stmt<span class="crayon-h"> </span>:=<span class="crayon-h"> </span><span class="crayon-s">'SELECT * FROM emp WHERE job = :j'</span>;</div><div class="crayon-line" id="crayon-63f843893d22d146400080-9"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">OPEN</span><span class="crayon-h"> </span>emp_cv<span class="crayon-h"> </span><span class="crayon-r">FOR</span><span class="crayon-h"> </span>sql_stmt<span class="crayon-h"> </span><span class="crayon-r">USING</span><span class="crayon-h"> </span>my_job;</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d22d146400080-10"><span class="crayon-h">&nbsp;&nbsp; </span>LOOP</div><div class="crayon-line" id="crayon-63f843893d22d146400080-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">FETCH</span><span class="crayon-h"> </span>emp_cv<span class="crayon-h"> </span><span class="crayon-r">INTO</span><span class="crayon-h"> </span>emp_rec;</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d22d146400080-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>EXIT<span class="crayon-h"> </span><span class="crayon-r">WHEN</span><span class="crayon-h"> </span>emp_cv%<span class="crayon-st">NOTFOUND</span>;</div><div class="crayon-line" id="crayon-63f843893d22d146400080-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">-- запись процесса</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d22d146400080-14"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">END</span><span class="crayon-h"> </span>LOOP;</div><div class="crayon-line" id="crayon-63f843893d22d146400080-15"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">CLOSE</span><span class="crayon-h"> </span>emp_cv;</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d22d146400080-16"><span class="crayon-r">END</span>;</div></div></td></tr></table></div></div><p></p><p><a name="typdyn"></a></p><h3>Примеры динамического SQL для типов объектов и коллекций</h3><p>Следующий пример иллюстрирует использование объектов и коллекций. Предположим, вы определили тип объекта Person и VARRAY тип Hobbies следующим образом:</p><p></p><div id="crayon-63f843893d230696415483" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top:12px;margin-bottom:12px;font-size:12px!important;line-height:15px!important"><div class="crayon-toolbar" data-settings=" show" style="font-size:12px!important;height:18px!important;line-height:18px!important"><span class="crayon-title"></span><div class="crayon-tools" style="font-size:12px!important;height:18px!important;line-height:18px!important"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Oracle PL/SQL</span></div></div><div class="crayon-info" style="min-height:16.8px!important;line-height:16.8px!important"></div><div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4;font-size:12px!important;line-height:15px!important">
CREATE TYPE Person AS OBJECT (name VARCHAR2(25), age NUMBER);
CREATE TYPE Hobbies IS VARRAY(10) OF VARCHAR2(25);</textarea></div><div class="crayon-main" style=""><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums" data-settings="hide"><div class="crayon-nums-content" style="font-size:12px!important;line-height:15px!important"><div class="crayon-num" data-line="crayon-63f843893d230696415483-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d230696415483-2">2</div></div></td><td class="crayon-code"><div class="crayon-pre" style="font-size:12px!important;line-height:15px!important;-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4"><div class="crayon-line" id="crayon-63f843893d230696415483-1"><span class="crayon-r">CREATE</span><span class="crayon-h"> </span><span class="crayon-r">TYPE</span><span class="crayon-h"> </span>Person<span class="crayon-h"> </span><span class="crayon-r">AS</span><span class="crayon-h"> </span><span class="crayon-r">OBJECT</span><span class="crayon-h"> </span>(name<span class="crayon-h"> </span><span class="crayon-r">VARCHAR2</span>(25),<span class="crayon-h"> </span>age<span class="crayon-h"> </span><span class="crayon-r">NUMBER</span>);</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d230696415483-2"><span class="crayon-r">CREATE</span><span class="crayon-h"> </span><span class="crayon-r">TYPE</span><span class="crayon-h"> </span>Hobbies<span class="crayon-h"> </span><span class="crayon-r">IS</span><span class="crayon-h"> </span><span class="crayon-t">VARRAY</span>(10)<span class="crayon-h"> </span><span class="crayon-r">OF</span><span class="crayon-h"> </span><span class="crayon-r">VARCHAR2</span>(25);</div></div></td></tr></table></div></div><p></p><p>Используя динамический SQL, вы можете <a href="packages-oracle-plsql.html">создать пакет</a>, который использует эти типы:</p><p></p><div id="crayon-63f843893d232238224870" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top:12px;margin-bottom:12px;font-size:12px!important;line-height:15px!important"><div class="crayon-toolbar" data-settings=" show" style="font-size:12px!important;height:18px!important;line-height:18px!important"><span class="crayon-title"></span><div class="crayon-tools" style="font-size:12px!important;height:18px!important;line-height:18px!important"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Oracle PL/SQL</span></div></div><div class="crayon-info" style="min-height:16.8px!important;line-height:16.8px!important"></div><div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4;font-size:12px!important;line-height:15px!important">
--создать спецификацию пакета
CREATE OR REPLACE PACKAGE teams AS
PROCEDURE create_table (tab_name VARCHAR2);
PROCEDURE insert_row (tab_name VARCHAR2, p Person, h Hobbies);
PROCEDURE print_table (tab_name VARCHAR2);
END;
--создать тело пакета
CREATE OR REPLACE PACKAGE BODY teams AS
PROCEDURE create_table (tab_name VARCHAR2) IS
BEGIN
EXECUTE IMMEDIATE 'CREATE TABLE ' || tab_name ||
' (pers Person, hobbs Hobbies)';
END;
PROCEDURE insert_row (
tab_name VARCHAR2,
p Person,
h Hobbies) IS
BEGIN
EXECUTE IMMEDIATE 'INSERT INTO ' || tab_name ||
' VALUES (:1, :2)' USING p, h;
END;
PROCEDURE print_table (tab_name VARCHAR2) IS
TYPE RefCurTyp IS REF CURSOR;
cv RefCurTyp;
p  Person;
h  Hobbies;
BEGIN
OPEN cv FOR 'SELECT pers, hobbs FROM ' || tab_name;
LOOP
FETCH cv INTO p, h;
EXIT WHEN cv%NOTFOUND;
-- print attributes of 'p' and elements of 'h'
END LOOP;
CLOSE cv;
END;
END;</textarea></div><div class="crayon-main" style=""><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums" data-settings="hide"><div class="crayon-nums-content" style="font-size:12px!important;line-height:15px!important"><div class="crayon-num" data-line="crayon-63f843893d232238224870-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d232238224870-2">2</div><div class="crayon-num" data-line="crayon-63f843893d232238224870-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d232238224870-4">4</div><div class="crayon-num" data-line="crayon-63f843893d232238224870-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d232238224870-6">6</div><div class="crayon-num" data-line="crayon-63f843893d232238224870-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d232238224870-8">8</div><div class="crayon-num" data-line="crayon-63f843893d232238224870-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d232238224870-10">10</div><div class="crayon-num" data-line="crayon-63f843893d232238224870-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d232238224870-12">12</div><div class="crayon-num" data-line="crayon-63f843893d232238224870-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d232238224870-14">14</div><div class="crayon-num" data-line="crayon-63f843893d232238224870-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d232238224870-16">16</div><div class="crayon-num" data-line="crayon-63f843893d232238224870-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d232238224870-18">18</div><div class="crayon-num" data-line="crayon-63f843893d232238224870-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d232238224870-20">20</div><div class="crayon-num" data-line="crayon-63f843893d232238224870-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d232238224870-22">22</div><div class="crayon-num" data-line="crayon-63f843893d232238224870-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d232238224870-24">24</div><div class="crayon-num" data-line="crayon-63f843893d232238224870-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d232238224870-26">26</div><div class="crayon-num" data-line="crayon-63f843893d232238224870-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d232238224870-28">28</div><div class="crayon-num" data-line="crayon-63f843893d232238224870-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d232238224870-30">30</div><div class="crayon-num" data-line="crayon-63f843893d232238224870-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d232238224870-32">32</div><div class="crayon-num" data-line="crayon-63f843893d232238224870-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d232238224870-34">34</div><div class="crayon-num" data-line="crayon-63f843893d232238224870-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d232238224870-36">36</div><div class="crayon-num" data-line="crayon-63f843893d232238224870-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d232238224870-38">38</div><div class="crayon-num" data-line="crayon-63f843893d232238224870-39">39</div></div></td><td class="crayon-code"><div class="crayon-pre" style="font-size:12px!important;line-height:15px!important;-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4"><div class="crayon-line" id="crayon-63f843893d232238224870-1"><span class="crayon-c">--создать спецификацию пакета</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d232238224870-2"><span class="crayon-r">CREATE</span><span class="crayon-h"> </span><span class="crayon-r">OR</span><span class="crayon-h"> </span><span class="crayon-r">REPLACE</span><span class="crayon-h"> </span><span class="crayon-r">PACKAGE</span><span class="crayon-h"> </span>teams<span class="crayon-h"> </span><span class="crayon-r">AS</span></div><div class="crayon-line" id="crayon-63f843893d232238224870-3"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">PROCEDURE</span><span class="crayon-h"> </span>create_table<span class="crayon-h"> </span>(tab_name<span class="crayon-h"> </span><span class="crayon-r">VARCHAR2</span>);</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d232238224870-4"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">PROCEDURE</span><span class="crayon-h"> </span>insert_row<span class="crayon-h"> </span>(tab_name<span class="crayon-h"> </span><span class="crayon-r">VARCHAR2</span>,<span class="crayon-h"> </span>p<span class="crayon-h"> </span>Person,<span class="crayon-h"> </span>h<span class="crayon-h"> </span>Hobbies);</div><div class="crayon-line" id="crayon-63f843893d232238224870-5"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">PROCEDURE</span><span class="crayon-h"> </span>print_table<span class="crayon-h"> </span>(tab_name<span class="crayon-h"> </span><span class="crayon-r">VARCHAR2</span>);</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d232238224870-6"><span class="crayon-r">END</span>;</div><div class="crayon-line" id="crayon-63f843893d232238224870-7">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d232238224870-8"><span class="crayon-c">--создать тело пакета</span></div><div class="crayon-line" id="crayon-63f843893d232238224870-9"><span class="crayon-r">CREATE</span><span class="crayon-h"> </span><span class="crayon-r">OR</span><span class="crayon-h"> </span><span class="crayon-r">REPLACE</span><span class="crayon-h"> </span><span class="crayon-r">PACKAGE</span><span class="crayon-h"> </span><span class="crayon-r">BODY</span><span class="crayon-h"> </span>teams<span class="crayon-h"> </span><span class="crayon-r">AS</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d232238224870-10"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">PROCEDURE</span><span class="crayon-h"> </span>create_table<span class="crayon-h"> </span>(tab_name<span class="crayon-h"> </span><span class="crayon-r">VARCHAR2</span>)<span class="crayon-h"> </span><span class="crayon-r">IS</span></div><div class="crayon-line" id="crayon-63f843893d232238224870-11"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">BEGIN</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d232238224870-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">EXECUTE</span><span class="crayon-h"> </span><span class="crayon-r">IMMEDIATE</span><span class="crayon-h"> </span><span class="crayon-s">'CREATE TABLE '</span><span class="crayon-h"> </span>||<span class="crayon-h"> </span>tab_name<span class="crayon-h"> </span>||</div><div class="crayon-line" id="crayon-63f843893d232238224870-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-s">' (pers Person, hobbs Hobbies)'</span>;</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d232238224870-14"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">END</span>;</div><div class="crayon-line" id="crayon-63f843893d232238224870-15">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d232238224870-16"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">PROCEDURE</span><span class="crayon-h"> </span>insert_row<span class="crayon-h"> </span>(</div><div class="crayon-line" id="crayon-63f843893d232238224870-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>tab_name<span class="crayon-h"> </span><span class="crayon-r">VARCHAR2</span>,</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d232238224870-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>p<span class="crayon-h"> </span>Person,</div><div class="crayon-line" id="crayon-63f843893d232238224870-19"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>h<span class="crayon-h"> </span>Hobbies)<span class="crayon-h"> </span><span class="crayon-r">IS</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d232238224870-20"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">BEGIN</span></div><div class="crayon-line" id="crayon-63f843893d232238224870-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">EXECUTE</span><span class="crayon-h"> </span><span class="crayon-r">IMMEDIATE</span><span class="crayon-h"> </span><span class="crayon-s">'INSERT INTO '</span><span class="crayon-h"> </span>||<span class="crayon-h"> </span>tab_name<span class="crayon-h"> </span>||</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d232238224870-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-s">' VALUES (:1, :2)'</span><span class="crayon-h"> </span><span class="crayon-r">USING</span><span class="crayon-h"> </span>p,<span class="crayon-h"> </span>h;</div><div class="crayon-line" id="crayon-63f843893d232238224870-23"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">END</span>;</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d232238224870-24">&nbsp;</div><div class="crayon-line" id="crayon-63f843893d232238224870-25"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">PROCEDURE</span><span class="crayon-h"> </span>print_table<span class="crayon-h"> </span>(tab_name<span class="crayon-h"> </span><span class="crayon-r">VARCHAR2</span>)<span class="crayon-h"> </span><span class="crayon-r">IS</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d232238224870-26"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">TYPE</span><span class="crayon-h"> </span>RefCurTyp<span class="crayon-h"> </span><span class="crayon-r">IS</span><span class="crayon-h"> </span><span class="crayon-r">REF</span><span class="crayon-h"> </span><span class="crayon-r">CURSOR</span>;</div><div class="crayon-line" id="crayon-63f843893d232238224870-27"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-k">cv</span><span class="crayon-h"> </span>RefCurTyp;</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d232238224870-28"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>p<span class="crayon-h">&nbsp;&nbsp;</span>Person;</div><div class="crayon-line" id="crayon-63f843893d232238224870-29"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>h<span class="crayon-h">&nbsp;&nbsp;</span>Hobbies;</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d232238224870-30"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">BEGIN</span></div><div class="crayon-line" id="crayon-63f843893d232238224870-31"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">OPEN</span><span class="crayon-h"> </span><span class="crayon-k">cv</span><span class="crayon-h"> </span><span class="crayon-r">FOR</span><span class="crayon-h"> </span><span class="crayon-s">'SELECT pers, hobbs FROM '</span><span class="crayon-h"> </span>||<span class="crayon-h"> </span>tab_name;</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d232238224870-32"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>LOOP</div><div class="crayon-line" id="crayon-63f843893d232238224870-33"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-r">FETCH</span><span class="crayon-h"> </span><span class="crayon-k">cv</span><span class="crayon-h"> </span><span class="crayon-r">INTO</span><span class="crayon-h"> </span>p,<span class="crayon-h"> </span>h;</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d232238224870-34"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>EXIT<span class="crayon-h"> </span><span class="crayon-r">WHEN</span><span class="crayon-h"> </span><span class="crayon-k">cv</span>%<span class="crayon-st">NOTFOUND</span>;</div><div class="crayon-line" id="crayon-63f843893d232238224870-35"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-c">-- print attributes of 'p' and elements of 'h'</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d232238224870-36"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">END</span><span class="crayon-h"> </span>LOOP;</div><div class="crayon-line" id="crayon-63f843893d232238224870-37"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">CLOSE</span><span class="crayon-h"> </span><span class="crayon-k">cv</span>;</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d232238224870-38"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">END</span>;</div><div class="crayon-line" id="crayon-63f843893d232238224870-39"><span class="crayon-r">END</span>;</div></div></td></tr></table></div></div><p></p><p>Из анонимного блока вы можете вызвать процедуры из пакета TEAMS:</p><p></p><div id="crayon-63f843893d235087107608" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top:12px;margin-bottom:12px;font-size:12px!important;line-height:15px!important"><div class="crayon-toolbar" data-settings=" show" style="font-size:12px!important;height:18px!important;line-height:18px!important"><span class="crayon-title"></span><div class="crayon-tools" style="font-size:12px!important;height:18px!important;line-height:18px!important"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Oracle PL/SQL</span></div></div><div class="crayon-info" style="min-height:16.8px!important;line-height:16.8px!important"></div><div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4;font-size:12px!important;line-height:15px!important">
DECLARE
team_name VARCHAR2(15);
BEGIN
team_name := 'Notables';
teams.create_table(team_name);
teams.insert_row(team_name, Person('John', 31),
Hobbies('skiing', 'coin collecting', 'tennis'));
teams.insert_row(team_name, Person('Mary', 28),
Hobbies('golf', 'quilting', 'rock climbing'));
teams.print_table(team_name);
END;</textarea></div><div class="crayon-main" style=""><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums" data-settings="hide"><div class="crayon-nums-content" style="font-size:12px!important;line-height:15px!important"><div class="crayon-num" data-line="crayon-63f843893d235087107608-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d235087107608-2">2</div><div class="crayon-num" data-line="crayon-63f843893d235087107608-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d235087107608-4">4</div><div class="crayon-num" data-line="crayon-63f843893d235087107608-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d235087107608-6">6</div><div class="crayon-num" data-line="crayon-63f843893d235087107608-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d235087107608-8">8</div><div class="crayon-num" data-line="crayon-63f843893d235087107608-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d235087107608-10">10</div><div class="crayon-num" data-line="crayon-63f843893d235087107608-11">11</div></div></td><td class="crayon-code"><div class="crayon-pre" style="font-size:12px!important;line-height:15px!important;-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4"><div class="crayon-line" id="crayon-63f843893d235087107608-1"><span class="crayon-r">DECLARE</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d235087107608-2"><span class="crayon-h">&nbsp;&nbsp; </span>team_name<span class="crayon-h"> </span><span class="crayon-r">VARCHAR2</span>(15);</div><div class="crayon-line" id="crayon-63f843893d235087107608-3"><span class="crayon-r">BEGIN</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d235087107608-4"><span class="crayon-h">&nbsp;&nbsp; </span>team_name<span class="crayon-h"> </span>:=<span class="crayon-h"> </span><span class="crayon-s">'Notables'</span>;</div><div class="crayon-line" id="crayon-63f843893d235087107608-5"><span class="crayon-h">&nbsp;&nbsp; </span>teams.create_table(team_name);</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d235087107608-6"><span class="crayon-h">&nbsp;&nbsp; </span>teams.insert_row(team_name,<span class="crayon-h"> </span>Person(<span class="crayon-s">'John'</span>,<span class="crayon-h"> </span>31),</div><div class="crayon-line" id="crayon-63f843893d235087107608-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>Hobbies(<span class="crayon-s">'skiing'</span>,<span class="crayon-h"> </span><span class="crayon-s">'coin collecting'</span>,<span class="crayon-h"> </span><span class="crayon-s">'tennis'</span>));</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d235087107608-8"><span class="crayon-h">&nbsp;&nbsp; </span>teams.insert_row(team_name,<span class="crayon-h"> </span>Person(<span class="crayon-s">'Mary'</span>,<span class="crayon-h"> </span>28),</div><div class="crayon-line" id="crayon-63f843893d235087107608-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>Hobbies(<span class="crayon-s">'golf'</span>,<span class="crayon-h"> </span><span class="crayon-s">'quilting'</span>,<span class="crayon-h"> </span><span class="crayon-s">'rock climbing'</span>));</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d235087107608-10"><span class="crayon-h">&nbsp;&nbsp; </span>teams.print_table(team_name);</div><div class="crayon-line" id="crayon-63f843893d235087107608-11"><span class="crayon-r">END</span>;</div></div></td></tr></table></div></div><p></p><p><a name="bulkdyn"></a></p><h2>Использование Bulk (множественного) SQL в динамическом SQL</h2><p>SQL Bulk связывает целые коллекции, а не только отдельные элементы. Этот метод повышает производительность за счет минимизации количества переключений контекста между механизмами PL/SQL и SQL. Вы можете использовать один оператор вместо цикла, который выдает оператор SQL на каждой итерации.</p><p>Используя следующие команды, предложения и атрибут курсора, ваши приложения могут создавать объемные операторы SQL, а затем выполнять их динамически во время выполнения:</p><ul><li>BULK FETCH предложение</li><li>BULK EXECUTE IMMEDIATE предложение</li><li>FORALL предложение</li><li>COLLECT INTO выражение</li><li>RETURNING INTO выражение</li><li>%BULK_ROWCOUNT атрибут курсора</li></ul><p><a name="usbulkdyn"></a></p><h2>Использование динамического SQL с Bulk SQL</h2><p>Массовое (множественное) связывание позволяет Oracle связать переменную в операторе SQL с коллекцией значений.<br>Тип коллекции может быть любым <a href="collections-and-records-oracle-plsql.html">типом коллекции</a> Oracle/PLSQL (<a href="associative-arrays-oracle-plsql.html">index-by table</a>, <a href="nested-tables-oracle-plsql.html">nested table</a> или <a href="varrays-oracle-plsql.html">varray</a>).<br>Элементы коллекции должны иметь <a href="data-types-sql.html">тип данных SQL</a>, такой как CHAR, DATE или NUMBER.<br>Три оператора поддерживают динамическое массовое связывание: EXECUTE IMMEDIATE, FETCH и FORALL.</p><h4>EXECUTE IMMEDIATE</h4><ul><li>Вы можете использовать предложение BULK COLLECT INTO с оператором EXECUTE IMMEDIATE, чтобы хранить значения из каждого столбца набора результатов запроса в отдельной коллекции.</li><li>Вы можете использовать предложение RETURNING BULK COLLECT INTO с оператором EXECUTE IMMEDIATE, чтобы сохранить результаты оператора INSERT, UPDATE или DELETE в наборе коллекций.</li></ul><h4>FETCH</h4><ul><li>Вы можете использовать предложение BULK COLLECT INTO с оператором FETCH для хранения значений из каждого столбца курсора в отдельной коллекции.</li></ul><h4>FORALL</h4><ul><li>Вы можете совместить EXECUTE IMMEDIATE инструкцию с RETURNING BULK COLLECT INTO внутри инструкции FORALL. Вы можете хранить результаты всех операторов INSERT, UPDATE или DELETE в наборе коллекций.</li><li>Вы можете передать индексированные элементы коллекции в инструкцию EXECUTE IMMEDIATE через предложение USING.</li><li>Вы не можете объединить индексированные элементы непосредственно в строковый аргумент для EXECUTE IMMEDIATE; например, вы не можете создать коллекцию имен таблиц и написать оператор FORALL, где каждая итерация применяется к другой таблице.</li></ul><p><a name="bulkcoldyn"></a></p><h3>Примеры динамический SQL с предложением BULK COLLECT INTO</h3><p>Вы можете связать определенные переменные в динамическом запросе, используя предложение BULK COLLECT INTO. Как показано в следующем примере, вы можете использовать это предложение в массовом выражении FETCH или в массовом выражении EXECUTE IMMEDIATE:</p><p></p><div id="crayon-63f843893d237320372979" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top:12px;margin-bottom:12px;font-size:12px!important;line-height:15px!important"><div class="crayon-toolbar" data-settings=" show" style="font-size:12px!important;height:18px!important;line-height:18px!important"><span class="crayon-title"></span><div class="crayon-tools" style="font-size:12px!important;height:18px!important;line-height:18px!important"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Oracle PL/SQL</span></div></div><div class="crayon-info" style="min-height:16.8px!important;line-height:16.8px!important"></div><div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4;font-size:12px!important;line-height:15px!important">
DECLARE
TYPE EmpCurTyp IS REF CURSOR;
TYPE NumList IS TABLE OF NUMBER;
TYPE NameList IS TABLE OF VARCHAR2(15);
emp_cv EmpCurTyp;
empnos NumList;
enames NameList;
sals   NumList;
BEGIN
OPEN emp_cv FOR 'SELECT empno, ename FROM emp';
FETCH emp_cv BULK COLLECT INTO empnos, enames;
CLOSE emp_cv;
EXECUTE IMMEDIATE 'SELECT sal FROM emp'
BULK COLLECT INTO sals;
END;</textarea></div><div class="crayon-main" style=""><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums" data-settings="hide"><div class="crayon-nums-content" style="font-size:12px!important;line-height:15px!important"><div class="crayon-num" data-line="crayon-63f843893d237320372979-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d237320372979-2">2</div><div class="crayon-num" data-line="crayon-63f843893d237320372979-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d237320372979-4">4</div><div class="crayon-num" data-line="crayon-63f843893d237320372979-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d237320372979-6">6</div><div class="crayon-num" data-line="crayon-63f843893d237320372979-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d237320372979-8">8</div><div class="crayon-num" data-line="crayon-63f843893d237320372979-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d237320372979-10">10</div><div class="crayon-num" data-line="crayon-63f843893d237320372979-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d237320372979-12">12</div><div class="crayon-num" data-line="crayon-63f843893d237320372979-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d237320372979-14">14</div><div class="crayon-num" data-line="crayon-63f843893d237320372979-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d237320372979-16">16</div></div></td><td class="crayon-code"><div class="crayon-pre" style="font-size:12px!important;line-height:15px!important;-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4"><div class="crayon-line" id="crayon-63f843893d237320372979-1"><span class="crayon-r">DECLARE</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d237320372979-2"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">TYPE</span><span class="crayon-h"> </span>EmpCurTyp<span class="crayon-h"> </span><span class="crayon-r">IS</span><span class="crayon-h"> </span><span class="crayon-r">REF</span><span class="crayon-h"> </span><span class="crayon-r">CURSOR</span>;</div><div class="crayon-line" id="crayon-63f843893d237320372979-3"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">TYPE</span><span class="crayon-h"> </span>NumList<span class="crayon-h"> </span><span class="crayon-r">IS</span><span class="crayon-h"> </span><span class="crayon-r">TABLE</span><span class="crayon-h"> </span><span class="crayon-r">OF</span><span class="crayon-h"> </span><span class="crayon-r">NUMBER</span>;</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d237320372979-4"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">TYPE</span><span class="crayon-h"> </span>NameList<span class="crayon-h"> </span><span class="crayon-r">IS</span><span class="crayon-h"> </span><span class="crayon-r">TABLE</span><span class="crayon-h"> </span><span class="crayon-r">OF</span><span class="crayon-h"> </span><span class="crayon-r">VARCHAR2</span>(15);</div><div class="crayon-line" id="crayon-63f843893d237320372979-5"><span class="crayon-h">&nbsp;&nbsp; </span>emp_cv<span class="crayon-h"> </span>EmpCurTyp;</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d237320372979-6"><span class="crayon-h">&nbsp;&nbsp; </span>empnos<span class="crayon-h"> </span>NumList;</div><div class="crayon-line" id="crayon-63f843893d237320372979-7"><span class="crayon-h">&nbsp;&nbsp; </span>enames<span class="crayon-h"> </span>NameList;</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d237320372979-8"><span class="crayon-h">&nbsp;&nbsp; </span>sals<span class="crayon-h">&nbsp;&nbsp; </span>NumList;</div><div class="crayon-line" id="crayon-63f843893d237320372979-9"><span class="crayon-r">BEGIN</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d237320372979-10"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">OPEN</span><span class="crayon-h"> </span>emp_cv<span class="crayon-h"> </span><span class="crayon-r">FOR</span><span class="crayon-h"> </span><span class="crayon-s">'SELECT empno, ename FROM emp'</span>;</div><div class="crayon-line" id="crayon-63f843893d237320372979-11"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">FETCH</span><span class="crayon-h"> </span>emp_cv<span class="crayon-h"> </span>BULK<span class="crayon-h"> </span><span class="crayon-k">COLLECT</span><span class="crayon-h"> </span><span class="crayon-r">INTO</span><span class="crayon-h"> </span>empnos,<span class="crayon-h"> </span>enames;</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d237320372979-12"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">CLOSE</span><span class="crayon-h"> </span>emp_cv;</div><div class="crayon-line" id="crayon-63f843893d237320372979-13">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d237320372979-14"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">EXECUTE</span><span class="crayon-h"> </span><span class="crayon-r">IMMEDIATE</span><span class="crayon-h"> </span><span class="crayon-s">'SELECT sal FROM emp'</span></div><div class="crayon-line" id="crayon-63f843893d237320372979-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>BULK<span class="crayon-h"> </span><span class="crayon-k">COLLECT</span><span class="crayon-h"> </span><span class="crayon-r">INTO</span><span class="crayon-h"> </span>sals;</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d237320372979-16"><span class="crayon-r">END</span>;</div></div></td></tr></table></div></div><p></p><p><a name="bulkintdyn"></a></p><h3>Пример динамический SQL с предложением RETURNING BULK COLLECT INTO</h3><p>Только операторы <a href="insert.html">INSERT</a>, <a href="update.html">UPDATE</a> и <a href="delete.html">DELETE</a> могут иметь выходные переменные связывания. Вы массово связываете их в EXECUTE IMMEDIATE с предложением RETURNING BULK COLLECT INTO.<br>Например:</p><p></p><div id="crayon-63f843893d244092421083" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top:12px;margin-bottom:12px;font-size:12px!important;line-height:15px!important"><div class="crayon-toolbar" data-settings=" show" style="font-size:12px!important;height:18px!important;line-height:18px!important"><span class="crayon-title"></span><div class="crayon-tools" style="font-size:12px!important;height:18px!important;line-height:18px!important"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Oracle PL/SQL</span></div></div><div class="crayon-info" style="min-height:16.8px!important;line-height:16.8px!important"></div><div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4;font-size:12px!important;line-height:15px!important">
DECLARE
TYPE NameList IS TABLE OF VARCHAR2(15);
enames    NameList;
bonus_amt NUMBER := 500;
sql_stmt  VARCHAR(200);
BEGIN
sql_stmt := 'UPDATE emp SET bonus = :1 RETURNING ename INTO :2';
EXECUTE IMMEDIATE sql_stmt
USING bonus_amt RETURNING BULK COLLECT INTO enames;
END;</textarea></div><div class="crayon-main" style=""><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums" data-settings="hide"><div class="crayon-nums-content" style="font-size:12px!important;line-height:15px!important"><div class="crayon-num" data-line="crayon-63f843893d244092421083-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d244092421083-2">2</div><div class="crayon-num" data-line="crayon-63f843893d244092421083-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d244092421083-4">4</div><div class="crayon-num" data-line="crayon-63f843893d244092421083-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d244092421083-6">6</div><div class="crayon-num" data-line="crayon-63f843893d244092421083-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d244092421083-8">8</div><div class="crayon-num" data-line="crayon-63f843893d244092421083-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d244092421083-10">10</div></div></td><td class="crayon-code"><div class="crayon-pre" style="font-size:12px!important;line-height:15px!important;-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4"><div class="crayon-line" id="crayon-63f843893d244092421083-1"><span class="crayon-r">DECLARE</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d244092421083-2"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">TYPE</span><span class="crayon-h"> </span>NameList<span class="crayon-h"> </span><span class="crayon-r">IS</span><span class="crayon-h"> </span><span class="crayon-r">TABLE</span><span class="crayon-h"> </span><span class="crayon-r">OF</span><span class="crayon-h"> </span><span class="crayon-r">VARCHAR2</span>(15);</div><div class="crayon-line" id="crayon-63f843893d244092421083-3"><span class="crayon-h">&nbsp;&nbsp; </span>enames<span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>NameList;</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d244092421083-4"><span class="crayon-h">&nbsp;&nbsp; </span>bonus_amt<span class="crayon-h"> </span><span class="crayon-r">NUMBER</span><span class="crayon-h"> </span>:=<span class="crayon-h"> </span>500;</div><div class="crayon-line" id="crayon-63f843893d244092421083-5"><span class="crayon-h">&nbsp;&nbsp; </span>sql_stmt<span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-r">VARCHAR</span>(200);</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d244092421083-6"><span class="crayon-r">BEGIN</span></div><div class="crayon-line" id="crayon-63f843893d244092421083-7"><span class="crayon-h">&nbsp;&nbsp; </span>sql_stmt<span class="crayon-h"> </span>:=<span class="crayon-h"> </span><span class="crayon-s">'UPDATE emp SET bonus = :1 RETURNING ename INTO :2'</span>;</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d244092421083-8"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">EXECUTE</span><span class="crayon-h"> </span><span class="crayon-r">IMMEDIATE</span><span class="crayon-h"> </span>sql_stmt</div><div class="crayon-line" id="crayon-63f843893d244092421083-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">USING</span><span class="crayon-h"> </span>bonus_amt<span class="crayon-h"> </span><span class="crayon-r">RETURNING</span><span class="crayon-h"> </span>BULK<span class="crayon-h"> </span><span class="crayon-k">COLLECT</span><span class="crayon-h"> </span><span class="crayon-r">INTO</span><span class="crayon-h"> </span>enames;</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d244092421083-10"><span class="crayon-r">END</span>;</div></div></td></tr></table></div></div><p></p><p><a name="bulkfordyn"></a></p><h3>Пример динамический SQL внутри оператора FORALL</h3><p>Чтобы связать входные переменные в операторе SQL, вы можете использовать оператор FORALL и предложение USING, как показано ниже. Оператор SQL не может быть запросом.<br>Например:</p><div id="crayon-63f843893d246009677046" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top:12px;margin-bottom:12px;font-size:12px!important;line-height:15px!important"><div class="crayon-toolbar" data-settings=" show" style="font-size:12px!important;height:18px!important;line-height:18px!important"><span class="crayon-title"></span><div class="crayon-tools" style="font-size:12px!important;height:18px!important;line-height:18px!important"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Oracle PL/SQL</span></div></div><div class="crayon-info" style="min-height:16.8px!important;line-height:16.8px!important"></div><div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4;font-size:12px!important;line-height:15px!important">
DECLARE
TYPE NumList IS TABLE OF NUMBER;
TYPE NameList IS TABLE OF VARCHAR2(15);
empnos NumList;
enames NameList;
BEGIN
empnos := NumList(1,2,3,4,5);
FORALL i IN 1..5
EXECUTE IMMEDIATE
'UPDATE emp SET sal = sal * 1.1 WHERE empno = :1
RETURNING ename INTO :2'
USING empnos(i) RETURNING BULK COLLECT INTO enames;
...
END;</textarea></div><div class="crayon-main" style=""><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums" data-settings="hide"><div class="crayon-nums-content" style="font-size:12px!important;line-height:15px!important"><div class="crayon-num" data-line="crayon-63f843893d246009677046-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d246009677046-2">2</div><div class="crayon-num" data-line="crayon-63f843893d246009677046-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d246009677046-4">4</div><div class="crayon-num" data-line="crayon-63f843893d246009677046-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d246009677046-6">6</div><div class="crayon-num" data-line="crayon-63f843893d246009677046-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d246009677046-8">8</div><div class="crayon-num" data-line="crayon-63f843893d246009677046-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d246009677046-10">10</div><div class="crayon-num" data-line="crayon-63f843893d246009677046-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d246009677046-12">12</div><div class="crayon-num" data-line="crayon-63f843893d246009677046-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d246009677046-14">14</div></div></td><td class="crayon-code"><div class="crayon-pre" style="font-size:12px!important;line-height:15px!important;-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4"><div class="crayon-line" id="crayon-63f843893d246009677046-1"><span class="crayon-r">DECLARE</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d246009677046-2"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">TYPE</span><span class="crayon-h"> </span>NumList<span class="crayon-h"> </span><span class="crayon-r">IS</span><span class="crayon-h"> </span><span class="crayon-r">TABLE</span><span class="crayon-h"> </span><span class="crayon-r">OF</span><span class="crayon-h"> </span><span class="crayon-r">NUMBER</span>;</div><div class="crayon-line" id="crayon-63f843893d246009677046-3"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">TYPE</span><span class="crayon-h"> </span>NameList<span class="crayon-h"> </span><span class="crayon-r">IS</span><span class="crayon-h"> </span><span class="crayon-r">TABLE</span><span class="crayon-h"> </span><span class="crayon-r">OF</span><span class="crayon-h"> </span><span class="crayon-r">VARCHAR2</span>(15);</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d246009677046-4"><span class="crayon-h">&nbsp;&nbsp; </span>empnos<span class="crayon-h"> </span>NumList;</div><div class="crayon-line" id="crayon-63f843893d246009677046-5"><span class="crayon-h">&nbsp;&nbsp; </span>enames<span class="crayon-h"> </span>NameList;</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d246009677046-6"><span class="crayon-r">BEGIN</span></div><div class="crayon-line" id="crayon-63f843893d246009677046-7"><span class="crayon-h">&nbsp;&nbsp; </span>empnos<span class="crayon-h"> </span>:=<span class="crayon-h"> </span>NumList(1,2,3,4,5);</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d246009677046-8"><span class="crayon-h">&nbsp;&nbsp; </span>FORALL<span class="crayon-h"> </span>i<span class="crayon-h"> </span><span class="crayon-r">IN</span><span class="crayon-h"> </span>1..5</div><div class="crayon-line" id="crayon-63f843893d246009677046-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">EXECUTE</span><span class="crayon-h"> </span><span class="crayon-r">IMMEDIATE</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d246009677046-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'UPDATE emp SET sal = sal * 1.1 WHERE empno = :1</span></div><div class="crayon-line" id="crayon-63f843893d246009677046-11"><span class="crayon-s">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; RETURNING ename INTO :2'</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d246009677046-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-r">USING</span><span class="crayon-h"> </span>empnos(i)<span class="crayon-h"> </span><span class="crayon-r">RETURNING</span><span class="crayon-h"> </span>BULK<span class="crayon-h"> </span><span class="crayon-k">COLLECT</span><span class="crayon-h"> </span><span class="crayon-r">INTO</span><span class="crayon-h"> </span>enames;</div><div class="crayon-line" id="crayon-63f843893d246009677046-13"><span class="crayon-h">&nbsp;&nbsp; </span>...</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d246009677046-14"><span class="crayon-r">END</span>;</div></div></td></tr></table></div></div><p></p><p><a name="rekomdyn"></a></p><h2>Рекомендации по динамическому SQL</h2><p>В этом разделе показано, как в полной мере использовать преимущества динамического SQL и как избежать некоторых распространенных ошибок.</p><p><a name="whdyn"></a></p><h3>Когда использовать или пропустить точку с запятой с помощью динамического SQL</h3><p>При построении одного оператора SQL в строке не ставьте точку с запятой в конце.<br>При создании анонимного блока PL/SQL добавьте точку с запятой в конце каждого оператора PL/SQL и в конце анонимного блока.<br>Например:</p><p></p><div id="crayon-63f843893d249684301559" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top:12px;margin-bottom:12px;font-size:12px!important;line-height:15px!important"><div class="crayon-toolbar" data-settings=" show" style="font-size:12px!important;height:18px!important;line-height:18px!important"><span class="crayon-title"></span><div class="crayon-tools" style="font-size:12px!important;height:18px!important;line-height:18px!important"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Oracle PL/SQL</span></div></div><div class="crayon-info" style="min-height:16.8px!important;line-height:16.8px!important"></div><div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4;font-size:12px!important;line-height:15px!important">
BEGIN
EXECUTE IMMEDIATE 'dbms_output.put_line(''Нет точки с запятой'')';
EXECUTE IMMEDIATE 'BEGIN dbms_output.put_line(''точка с запятой''); END;';
END;</textarea></div><div class="crayon-main" style=""><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums" data-settings="hide"><div class="crayon-nums-content" style="font-size:12px!important;line-height:15px!important"><div class="crayon-num" data-line="crayon-63f843893d249684301559-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d249684301559-2">2</div><div class="crayon-num" data-line="crayon-63f843893d249684301559-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d249684301559-4">4</div></div></td><td class="crayon-code"><div class="crayon-pre" style="font-size:12px!important;line-height:15px!important;-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4"><div class="crayon-line" id="crayon-63f843893d249684301559-1"><span class="crayon-r">BEGIN</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d249684301559-2"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">EXECUTE</span><span class="crayon-h"> </span><span class="crayon-r">IMMEDIATE</span><span class="crayon-h"> </span><span class="crayon-s">'dbms_output.put_line('</span><span class="crayon-s">'Нет точки с запятой'</span><span class="crayon-s">')'</span>;</div><div class="crayon-line" id="crayon-63f843893d249684301559-3"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">EXECUTE</span><span class="crayon-h"> </span><span class="crayon-r">IMMEDIATE</span><span class="crayon-h"> </span><span class="crayon-s">'BEGIN dbms_output.put_line('</span><span class="crayon-s">'точка с запятой'</span><span class="crayon-s">'); END;'</span>;</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d249684301559-4"><span class="crayon-r">END</span>;</div></div></td></tr></table></div></div><p></p><p><a name="updyn"></a></p><h3>Повышение производительности динамического SQL с помощью переменных связывания</h3><p>Когда код ваших операторов INSERT, UPDATE, DELETE, и SELECT находится непосредственно в PL/SQL, PL/SQL превращает переменные в переменные связывания автоматически, чтобы операторы эффективно работали с SQL. Когда вы создаете такие операторы в динамическом SQL, вам нужно указать переменные связывания самостоятельно, чтобы получить ту же производительность.</p><p>В приведенном ниже примере Oracle открывает отдельный курсор для каждого отдельного значения <span class="arg">emp_id</span>. Это может привести к конфликту ресурсов и снижению производительности, поскольку каждый оператор анализируется и кэшируется.</p><p></p><div id="crayon-63f843893d24b219410526" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top:12px;margin-bottom:12px;font-size:12px!important;line-height:15px!important"><div class="crayon-toolbar" data-settings=" show" style="font-size:12px!important;height:18px!important;line-height:18px!important"><span class="crayon-title"></span><div class="crayon-tools" style="font-size:12px!important;height:18px!important;line-height:18px!important"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Oracle PL/SQL</span></div></div><div class="crayon-info" style="min-height:16.8px!important;line-height:16.8px!important"></div><div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4;font-size:12px!important;line-height:15px!important">
CREATE PROCEDURE fire_employee (emp_id NUMBER) AS
BEGIN
EXECUTE IMMEDIATE
'DELETE FROM emp WHERE empno = ' || TO_CHAR(emp_id);
END;</textarea></div><div class="crayon-main" style=""><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums" data-settings="hide"><div class="crayon-nums-content" style="font-size:12px!important;line-height:15px!important"><div class="crayon-num" data-line="crayon-63f843893d24b219410526-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d24b219410526-2">2</div><div class="crayon-num" data-line="crayon-63f843893d24b219410526-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d24b219410526-4">4</div><div class="crayon-num" data-line="crayon-63f843893d24b219410526-5">5</div></div></td><td class="crayon-code"><div class="crayon-pre" style="font-size:12px!important;line-height:15px!important;-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4"><div class="crayon-line" id="crayon-63f843893d24b219410526-1"><span class="crayon-r">CREATE</span><span class="crayon-h"> </span><span class="crayon-r">PROCEDURE</span><span class="crayon-h"> </span>fire_employee<span class="crayon-h"> </span>(emp_id<span class="crayon-h"> </span><span class="crayon-r">NUMBER</span>)<span class="crayon-h"> </span><span class="crayon-r">AS</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d24b219410526-2"><span class="crayon-r">BEGIN</span></div><div class="crayon-line" id="crayon-63f843893d24b219410526-3"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">EXECUTE</span><span class="crayon-h"> </span><span class="crayon-r">IMMEDIATE</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d24b219410526-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'DELETE FROM emp WHERE empno = '</span><span class="crayon-h"> </span>||<span class="crayon-h"> </span><span class="crayon-k">TO_CHAR</span>(emp_id);</div><div class="crayon-line" id="crayon-63f843893d24b219410526-5"><span class="crayon-r">END</span>;</div></div></td></tr></table></div></div><p></p><p>Вы можете улучшить производительность, используя переменную связывания, которая позволяет Oracle повторно использовать один и тот же курсор для разных значений <span class="arg">emp_id</span>:</p><p></p><div id="crayon-63f843893d24f984641088" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top:12px;margin-bottom:12px;font-size:12px!important;line-height:15px!important"><div class="crayon-toolbar" data-settings=" show" style="font-size:12px!important;height:18px!important;line-height:18px!important"><span class="crayon-title"></span><div class="crayon-tools" style="font-size:12px!important;height:18px!important;line-height:18px!important"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Oracle PL/SQL</span></div></div><div class="crayon-info" style="min-height:16.8px!important;line-height:16.8px!important"></div><div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4;font-size:12px!important;line-height:15px!important">
CREATE PROCEDURE fire_employee (emp_id NUMBER) AS
BEGIN
EXECUTE IMMEDIATE
'DELETE FROM emp WHERE empno = :num' USING emp_id;
END;</textarea></div><div class="crayon-main" style=""><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums" data-settings="hide"><div class="crayon-nums-content" style="font-size:12px!important;line-height:15px!important"><div class="crayon-num" data-line="crayon-63f843893d24f984641088-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d24f984641088-2">2</div><div class="crayon-num" data-line="crayon-63f843893d24f984641088-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d24f984641088-4">4</div><div class="crayon-num" data-line="crayon-63f843893d24f984641088-5">5</div></div></td><td class="crayon-code"><div class="crayon-pre" style="font-size:12px!important;line-height:15px!important;-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4"><div class="crayon-line" id="crayon-63f843893d24f984641088-1"><span class="crayon-r">CREATE</span><span class="crayon-h"> </span><span class="crayon-r">PROCEDURE</span><span class="crayon-h"> </span>fire_employee<span class="crayon-h"> </span>(emp_id<span class="crayon-h"> </span><span class="crayon-r">NUMBER</span>)<span class="crayon-h"> </span><span class="crayon-r">AS</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d24f984641088-2"><span class="crayon-r">BEGIN</span></div><div class="crayon-line" id="crayon-63f843893d24f984641088-3"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">EXECUTE</span><span class="crayon-h"> </span><span class="crayon-r">IMMEDIATE</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d24f984641088-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">'DELETE FROM emp WHERE empno = :num'</span><span class="crayon-h"> </span><span class="crayon-r">USING</span><span class="crayon-h"> </span>emp_id;</div><div class="crayon-line" id="crayon-63f843893d24f984641088-5"><span class="crayon-r">END</span>;</div></div></td></tr></table></div></div><p></p><p><a name="passdyn"></a></p><h3>Передача имен объектов схемы в качестве параметров</h3><p>Предположим, вам нужна процедура, которая принимает имя любой таблицы базы данных, а затем удаляет эту таблицу из вашей схемы. Вы должны создать строку с оператором, который включает имена объектов, а затем использовать EXECUTE IMMEDIATE для выполнения оператора:</p><p></p><div id="crayon-63f843893d252515454225" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top:12px;margin-bottom:12px;font-size:12px!important;line-height:15px!important"><div class="crayon-toolbar" data-settings=" show" style="font-size:12px!important;height:18px!important;line-height:18px!important"><span class="crayon-title"></span><div class="crayon-tools" style="font-size:12px!important;height:18px!important;line-height:18px!important"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Oracle PL/SQL</span></div></div><div class="crayon-info" style="min-height:16.8px!important;line-height:16.8px!important"></div><div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4;font-size:12px!important;line-height:15px!important">
CREATE PROCEDURE drop_table (table_name IN VARCHAR2) AS
BEGIN
EXECUTE IMMEDIATE 'DROP TABLE ' || table_name;
END;</textarea></div><div class="crayon-main" style=""><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums" data-settings="hide"><div class="crayon-nums-content" style="font-size:12px!important;line-height:15px!important"><div class="crayon-num" data-line="crayon-63f843893d252515454225-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d252515454225-2">2</div><div class="crayon-num" data-line="crayon-63f843893d252515454225-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d252515454225-4">4</div></div></td><td class="crayon-code"><div class="crayon-pre" style="font-size:12px!important;line-height:15px!important;-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4"><div class="crayon-line" id="crayon-63f843893d252515454225-1"><span class="crayon-r">CREATE</span><span class="crayon-h"> </span><span class="crayon-r">PROCEDURE</span><span class="crayon-h"> </span>drop_table<span class="crayon-h"> </span>(table_name<span class="crayon-h"> </span><span class="crayon-r">IN</span><span class="crayon-h"> </span><span class="crayon-r">VARCHAR2</span>)<span class="crayon-h"> </span><span class="crayon-r">AS</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d252515454225-2"><span class="crayon-r">BEGIN</span></div><div class="crayon-line" id="crayon-63f843893d252515454225-3"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">EXECUTE</span><span class="crayon-h"> </span><span class="crayon-r">IMMEDIATE</span><span class="crayon-h"> </span><span class="crayon-s">'DROP TABLE '</span><span class="crayon-h"> </span>||<span class="crayon-h"> </span>table_name;</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d252515454225-4"><span class="crayon-r">END</span>;</div></div></td></tr></table></div></div><p></p><p>Используйте конкатенацию для построения строки, а не пытайтесь передать имя таблицы как переменную связывания через предложение USING.</p><p><a name="dubldyn"></a></p><h3>Использование дублирующих заполнителей с динамическим SQL</h3><p>Заполнители в динамическом операторе SQL связаны с аргументами связывания в предложении USING по позиции, а не по имени. Если вы укажете последовательность заполнителей, например <span class="arg">:a</span>, <span class="arg">:a</span>, <span class="arg">:b</span>, <span class="arg">:b</span>, вы должны включить в предложение USING четыре элемента. Например, учитывая динамическую строку:</p><p></p><div id="crayon-63f843893d254199011902" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top:12px;margin-bottom:12px;font-size:12px!important;line-height:15px!important"><div class="crayon-toolbar" data-settings=" show" style="font-size:12px!important;height:18px!important;line-height:18px!important"><span class="crayon-title"></span><div class="crayon-tools" style="font-size:12px!important;height:18px!important;line-height:18px!important"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Oracle PL/SQL</span></div></div><div class="crayon-info" style="min-height:16.8px!important;line-height:16.8px!important"></div><div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4;font-size:12px!important;line-height:15px!important">
sql_stmt := 'INSERT INTO payroll VALUES (:x, :x, :y, :x)';</textarea></div><div class="crayon-main" style=""><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums" data-settings="hide"><div class="crayon-nums-content" style="font-size:12px!important;line-height:15px!important"><div class="crayon-num" data-line="crayon-63f843893d254199011902-1">1</div></div></td><td class="crayon-code"><div class="crayon-pre" style="font-size:12px!important;line-height:15px!important;-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4"><div class="crayon-line" id="crayon-63f843893d254199011902-1">sql_stmt<span class="crayon-h"> </span>:=<span class="crayon-h"> </span><span class="crayon-s">'INSERT INTO payroll VALUES (:x, :x, :y, :x)'</span>;</div></div></td></tr></table></div></div><p></p><p>тот факт, что имя <span class="arg">x</span> повторяется, не имеет значения. Вы можете кодировать соответствующее предложение USING с четырьмя различными переменными связывания:</p><p></p><div id="crayon-63f843893d256730869735" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top:12px;margin-bottom:12px;font-size:12px!important;line-height:15px!important"><div class="crayon-toolbar" data-settings=" show" style="font-size:12px!important;height:18px!important;line-height:18px!important"><span class="crayon-title"></span><div class="crayon-tools" style="font-size:12px!important;height:18px!important;line-height:18px!important"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Oracle PL/SQL</span></div></div><div class="crayon-info" style="min-height:16.8px!important;line-height:16.8px!important"></div><div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4;font-size:12px!important;line-height:15px!important">
EXECUTE IMMEDIATE sql_stmt USING a, a, b, a;</textarea></div><div class="crayon-main" style=""><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums" data-settings="hide"><div class="crayon-nums-content" style="font-size:12px!important;line-height:15px!important"><div class="crayon-num" data-line="crayon-63f843893d256730869735-1">1</div></div></td><td class="crayon-code"><div class="crayon-pre" style="font-size:12px!important;line-height:15px!important;-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4"><div class="crayon-line" id="crayon-63f843893d256730869735-1"><span class="crayon-r">EXECUTE</span><span class="crayon-h"> </span><span class="crayon-r">IMMEDIATE</span><span class="crayon-h"> </span>sql_stmt<span class="crayon-h"> </span><span class="crayon-r">USING</span><span class="crayon-h"> </span>a,<span class="crayon-h"> </span>a,<span class="crayon-h"> </span>b,<span class="crayon-h"> </span>a;</div></div></td></tr></table></div></div><p></p><p>Если динамический оператор представляет PL/SQL блок, то правила для дублирующих заполнителей различны. Каждый уникальный заполнитель отображается на один элемент в предложении USING. Если один и тот же заполнитель появляется два или более раз, все ссылки на это имя соответствуют одному аргументу связывания в предложении USING.<br>В следующем примере все ссылки на заполнитель <span class="arg">x</span> связаны с первым аргументом связывания <span class="arg">a</span>, а второй уникальный заполнитель <span class="arg">y</span> связан со вторым аргументом связывания <span class="arg">b</span>.<br>Например:</p><p></p><div id="crayon-63f843893d259849873735" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top:12px;margin-bottom:12px;font-size:12px!important;line-height:15px!important"><div class="crayon-toolbar" data-settings=" show" style="font-size:12px!important;height:18px!important;line-height:18px!important"><span class="crayon-title"></span><div class="crayon-tools" style="font-size:12px!important;height:18px!important;line-height:18px!important"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Oracle PL/SQL</span></div></div><div class="crayon-info" style="min-height:16.8px!important;line-height:16.8px!important"></div><div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4;font-size:12px!important;line-height:15px!important">
DECLARE
a NUMBER := 4;
b NUMBER := 7;
BEGIN
plsql_block := 'BEGIN calc_stats(:x, :x, :y, :x); END;'
EXECUTE IMMEDIATE plsql_block USING a, b;
END;</textarea></div><div class="crayon-main" style=""><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums" data-settings="hide"><div class="crayon-nums-content" style="font-size:12px!important;line-height:15px!important"><div class="crayon-num" data-line="crayon-63f843893d259849873735-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d259849873735-2">2</div><div class="crayon-num" data-line="crayon-63f843893d259849873735-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d259849873735-4">4</div><div class="crayon-num" data-line="crayon-63f843893d259849873735-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d259849873735-6">6</div><div class="crayon-num" data-line="crayon-63f843893d259849873735-7">7</div></div></td><td class="crayon-code"><div class="crayon-pre" style="font-size:12px!important;line-height:15px!important;-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4"><div class="crayon-line" id="crayon-63f843893d259849873735-1"><span class="crayon-r">DECLARE</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d259849873735-2"><span class="crayon-h">&nbsp;&nbsp; </span>a<span class="crayon-h"> </span><span class="crayon-r">NUMBER</span><span class="crayon-h"> </span>:=<span class="crayon-h"> </span>4;</div><div class="crayon-line" id="crayon-63f843893d259849873735-3"><span class="crayon-h">&nbsp;&nbsp; </span>b<span class="crayon-h"> </span><span class="crayon-r">NUMBER</span><span class="crayon-h"> </span>:=<span class="crayon-h"> </span>7;</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d259849873735-4"><span class="crayon-r">BEGIN</span></div><div class="crayon-line" id="crayon-63f843893d259849873735-5"><span class="crayon-h">&nbsp;&nbsp; </span>plsql_block<span class="crayon-h"> </span>:=<span class="crayon-h"> </span><span class="crayon-s">'BEGIN calc_stats(:x, :x, :y, :x); END;'</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d259849873735-6"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">EXECUTE</span><span class="crayon-h"> </span><span class="crayon-r">IMMEDIATE</span><span class="crayon-h"> </span>plsql_block<span class="crayon-h"> </span><span class="crayon-r">USING</span><span class="crayon-h"> </span>a,<span class="crayon-h"> </span>b;</div><div class="crayon-line" id="crayon-63f843893d259849873735-7"><span class="crayon-r">END</span>;</div></div></td></tr></table></div></div><p></p><p><a name="atrdyn"></a></p><h3>Использование атрибутов курсора с динамическим SQL</h3><p>SQL <a href="cursor-attributes.html">атрибуты курсора %FOUND, %ISOPEN, %NOTFOUND и %ROWCOUNT</a> работают в динамическом SQL при выдаче INSERT, UPDATE, DELETE или однорядного предложения SELECT:</p><p></p><div id="crayon-63f843893d25c674605200" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top:12px;margin-bottom:12px;font-size:12px!important;line-height:15px!important"><div class="crayon-toolbar" data-settings=" show" style="font-size:12px!important;height:18px!important;line-height:18px!important"><span class="crayon-title"></span><div class="crayon-tools" style="font-size:12px!important;height:18px!important;line-height:18px!important"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Oracle PL/SQL</span></div></div><div class="crayon-info" style="min-height:16.8px!important;line-height:16.8px!important"></div><div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4;font-size:12px!important;line-height:15px!important">
EXECUTE IMMEDIATE 'DELETE FROM employees WHERE employee_id &gt; 1000';
rows_deleted := SQL%ROWCOUNT;</textarea></div><div class="crayon-main" style=""><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums" data-settings="hide"><div class="crayon-nums-content" style="font-size:12px!important;line-height:15px!important"><div class="crayon-num" data-line="crayon-63f843893d25c674605200-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d25c674605200-2">2</div></div></td><td class="crayon-code"><div class="crayon-pre" style="font-size:12px!important;line-height:15px!important;-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4"><div class="crayon-line" id="crayon-63f843893d25c674605200-1"><span class="crayon-r">EXECUTE</span><span class="crayon-h"> </span><span class="crayon-r">IMMEDIATE</span><span class="crayon-h"> </span><span class="crayon-s">'DELETE FROM employees WHERE employee_id &gt; 1000'</span>;</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d25c674605200-2">rows_deleted<span class="crayon-h"> </span>:=<span class="crayon-h"> </span><span class="crayon-r">SQL</span>%ROWCOUNT;</div></div></td></tr></table></div></div><p></p><p>Аналогично, при добавлении к имени переменной курсора, атрибуты курсора возвращают информацию о выполнении многострочного запроса:</p><p></p><div id="crayon-63f843893d25f402761410" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top:12px;margin-bottom:12px;font-size:12px!important;line-height:15px!important"><div class="crayon-toolbar" data-settings=" show" style="font-size:12px!important;height:18px!important;line-height:18px!important"><span class="crayon-title"></span><div class="crayon-tools" style="font-size:12px!important;height:18px!important;line-height:18px!important"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Oracle PL/SQL</span></div></div><div class="crayon-info" style="min-height:16.8px!important;line-height:16.8px!important"></div><div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4;font-size:12px!important;line-height:15px!important">
OPEN c1 FOR 'SELECT * FROM employees';
FETCH c1 BULK COLLECT INTO rec_tab;
rows_fetched := c1%ROWCOUNT;</textarea></div><div class="crayon-main" style=""><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums" data-settings="hide"><div class="crayon-nums-content" style="font-size:12px!important;line-height:15px!important"><div class="crayon-num" data-line="crayon-63f843893d25f402761410-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d25f402761410-2">2</div><div class="crayon-num" data-line="crayon-63f843893d25f402761410-3">3</div></div></td><td class="crayon-code"><div class="crayon-pre" style="font-size:12px!important;line-height:15px!important;-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4"><div class="crayon-line" id="crayon-63f843893d25f402761410-1"><span class="crayon-r">OPEN</span><span class="crayon-h"> </span>c1<span class="crayon-h"> </span><span class="crayon-r">FOR</span><span class="crayon-h"> </span><span class="crayon-s">'SELECT * FROM employees'</span>;</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d25f402761410-2"><span class="crayon-r">FETCH</span><span class="crayon-h"> </span>c1<span class="crayon-h"> </span>BULK<span class="crayon-h"> </span><span class="crayon-k">COLLECT</span><span class="crayon-h"> </span><span class="crayon-r">INTO</span><span class="crayon-h"> </span>rec_tab;</div><div class="crayon-line" id="crayon-63f843893d25f402761410-3">rows_fetched<span class="crayon-h"> </span>:=<span class="crayon-h"> </span>c1%ROWCOUNT;</div></div></td></tr></table></div></div><p></p><p><a name="nulldyn"></a></p><h3>Передача NULL в динамический SQL</h3><p>Литерал NULL не допускается в предложении USING. Чтобы обойти это ограничение, замените ключевое слово NULL неинициализированной переменной:</p><p></p><div id="crayon-63f843893d261684706978" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top:12px;margin-bottom:12px;font-size:12px!important;line-height:15px!important"><div class="crayon-toolbar" data-settings=" show" style="font-size:12px!important;height:18px!important;line-height:18px!important"><span class="crayon-title"></span><div class="crayon-tools" style="font-size:12px!important;height:18px!important;line-height:18px!important"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Oracle PL/SQL</span></div></div><div class="crayon-info" style="min-height:16.8px!important;line-height:16.8px!important"></div><div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4;font-size:12px!important;line-height:15px!important">
DECLARE
a_null CHAR(1); -- установится в NULL автоматически во время выполнения
BEGIN
EXECUTE IMMEDIATE 'UPDATE emp SET comm = :x' USING a_null;
END;</textarea></div><div class="crayon-main" style=""><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums" data-settings="hide"><div class="crayon-nums-content" style="font-size:12px!important;line-height:15px!important"><div class="crayon-num" data-line="crayon-63f843893d261684706978-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d261684706978-2">2</div><div class="crayon-num" data-line="crayon-63f843893d261684706978-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d261684706978-4">4</div><div class="crayon-num" data-line="crayon-63f843893d261684706978-5">5</div></div></td><td class="crayon-code"><div class="crayon-pre" style="font-size:12px!important;line-height:15px!important;-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4"><div class="crayon-line" id="crayon-63f843893d261684706978-1"><span class="crayon-r">DECLARE</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d261684706978-2"><span class="crayon-h">&nbsp;&nbsp; </span>a_null<span class="crayon-h"> </span><span class="crayon-r">CHAR</span>(1);<span class="crayon-h"> </span><span class="crayon-c">-- установится в NULL автоматически во время выполнения</span></div><div class="crayon-line" id="crayon-63f843893d261684706978-3"><span class="crayon-r">BEGIN</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d261684706978-4"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">EXECUTE</span><span class="crayon-h"> </span><span class="crayon-r">IMMEDIATE</span><span class="crayon-h"> </span><span class="crayon-s">'UPDATE emp SET comm = :x'</span><span class="crayon-h"> </span><span class="crayon-r">USING</span><span class="crayon-h"> </span>a_null;</div><div class="crayon-line" id="crayon-63f843893d261684706978-5"><span class="crayon-r">END</span>;</div></div></td></tr></table></div></div><p></p><p><a name="relatdyn"></a></p><h3>Использование связей базы данных с динамическим SQL</h3><p>Подпрограммы PL/SQL могут выполнять динамические операторы SQL, которые используют ссылки на базы данных для ссылки на объекты в удаленных базах данных:</p><p></p><div id="crayon-63f843893d263521396228" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top:12px;margin-bottom:12px;font-size:12px!important;line-height:15px!important"><div class="crayon-toolbar" data-settings=" show" style="font-size:12px!important;height:18px!important;line-height:18px!important"><span class="crayon-title"></span><div class="crayon-tools" style="font-size:12px!important;height:18px!important;line-height:18px!important"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Oracle PL/SQL</span></div></div><div class="crayon-info" style="min-height:16.8px!important;line-height:16.8px!important"></div><div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4;font-size:12px!important;line-height:15px!important">
PROCEDURE delete_dept (db_link VARCHAR2, dept_id INTEGER) IS
BEGIN
EXECUTE IMMEDIATE 'DELETE FROM departments@' || db_link ||
' WHERE deptno = :num' USING dept_id;
END;</textarea></div><div class="crayon-main" style=""><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums" data-settings="hide"><div class="crayon-nums-content" style="font-size:12px!important;line-height:15px!important"><div class="crayon-num" data-line="crayon-63f843893d263521396228-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d263521396228-2">2</div><div class="crayon-num" data-line="crayon-63f843893d263521396228-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d263521396228-4">4</div><div class="crayon-num" data-line="crayon-63f843893d263521396228-5">5</div></div></td><td class="crayon-code"><div class="crayon-pre" style="font-size:12px!important;line-height:15px!important;-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4"><div class="crayon-line" id="crayon-63f843893d263521396228-1"><span class="crayon-r">PROCEDURE</span><span class="crayon-h"> </span>delete_dept<span class="crayon-h"> </span>(db_link<span class="crayon-h"> </span><span class="crayon-r">VARCHAR2</span>,<span class="crayon-h"> </span>dept_id<span class="crayon-h"> </span><span class="crayon-r">INTEGER</span>)<span class="crayon-h"> </span><span class="crayon-r">IS</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d263521396228-2"><span class="crayon-r">BEGIN</span></div><div class="crayon-line" id="crayon-63f843893d263521396228-3"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">EXECUTE</span><span class="crayon-h"> </span><span class="crayon-r">IMMEDIATE</span><span class="crayon-h"> </span><span class="crayon-s">'DELETE FROM departments@'</span><span class="crayon-h"> </span>||<span class="crayon-h"> </span>db_link<span class="crayon-h"> </span>||</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d263521396228-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-s">' WHERE deptno = :num'</span><span class="crayon-h"> </span><span class="crayon-r">USING</span><span class="crayon-h"> </span>dept_id;</div><div class="crayon-line" id="crayon-63f843893d263521396228-5"><span class="crayon-r">END</span>;</div></div></td></tr></table></div></div><p></p><p>Цели удаленных вызовов процедур (RPC) могут содержать динамические операторы SQL. Например, предположим, что следующая автономная функция, которая возвращает количество строк в таблице, находится в базе данных Чикаго:</p><p></p><div id="crayon-63f843893d266359590107" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top:12px;margin-bottom:12px;font-size:12px!important;line-height:15px!important"><div class="crayon-toolbar" data-settings=" show" style="font-size:12px!important;height:18px!important;line-height:18px!important"><span class="crayon-title"></span><div class="crayon-tools" style="font-size:12px!important;height:18px!important;line-height:18px!important"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Oracle PL/SQL</span></div></div><div class="crayon-info" style="min-height:16.8px!important;line-height:16.8px!important"></div><div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4;font-size:12px!important;line-height:15px!important">
CREATE FUNCTION row_count (tab_name VARCHAR2) RETURN INTEGER AS
rows INTEGER;
BEGIN
EXECUTE IMMEDIATE 'SELECT COUNT(*) FROM ' || tab_name INTO rows;
RETURN rows;
END;</textarea></div><div class="crayon-main" style=""><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums" data-settings="hide"><div class="crayon-nums-content" style="font-size:12px!important;line-height:15px!important"><div class="crayon-num" data-line="crayon-63f843893d266359590107-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d266359590107-2">2</div><div class="crayon-num" data-line="crayon-63f843893d266359590107-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d266359590107-4">4</div><div class="crayon-num" data-line="crayon-63f843893d266359590107-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d266359590107-6">6</div></div></td><td class="crayon-code"><div class="crayon-pre" style="font-size:12px!important;line-height:15px!important;-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4"><div class="crayon-line" id="crayon-63f843893d266359590107-1"><span class="crayon-r">CREATE</span><span class="crayon-h"> </span><span class="crayon-r">FUNCTION</span><span class="crayon-h"> </span>row_count<span class="crayon-h"> </span>(tab_name<span class="crayon-h"> </span><span class="crayon-r">VARCHAR2</span>)<span class="crayon-h"> </span><span class="crayon-r">RETURN</span><span class="crayon-h"> </span><span class="crayon-r">INTEGER</span><span class="crayon-h"> </span><span class="crayon-r">AS</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d266359590107-2"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">rows</span><span class="crayon-h"> </span><span class="crayon-r">INTEGER</span>;</div><div class="crayon-line" id="crayon-63f843893d266359590107-3"><span class="crayon-r">BEGIN</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d266359590107-4"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">EXECUTE</span><span class="crayon-h"> </span><span class="crayon-r">IMMEDIATE</span><span class="crayon-h"> </span><span class="crayon-s">'SELECT COUNT(*) FROM '</span><span class="crayon-h"> </span>||<span class="crayon-h"> </span>tab_name<span class="crayon-h"> </span><span class="crayon-r">INTO</span><span class="crayon-h"> </span><span class="crayon-r">rows</span>;</div><div class="crayon-line" id="crayon-63f843893d266359590107-5"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">RETURN</span><span class="crayon-h"> </span><span class="crayon-r">rows</span>;</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d266359590107-6"><span class="crayon-r">END</span>;</div></div></td></tr></table></div></div><p></p><p>Из анонимного блока вы можете вызвать функцию удаленно, как показано ниже:</p><p></p><div id="crayon-63f843893d268271611343" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top:12px;margin-bottom:12px;font-size:12px!important;line-height:15px!important"><div class="crayon-toolbar" data-settings=" show" style="font-size:12px!important;height:18px!important;line-height:18px!important"><span class="crayon-title"></span><div class="crayon-tools" style="font-size:12px!important;height:18px!important;line-height:18px!important"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Oracle PL/SQL</span></div></div><div class="crayon-info" style="min-height:16.8px!important;line-height:16.8px!important"></div><div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4;font-size:12px!important;line-height:15px!important">
DECLARE
emp_count INTEGER;
BEGIN
emp_count := row_count@chicago('employees');
END;</textarea></div><div class="crayon-main" style=""><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums" data-settings="hide"><div class="crayon-nums-content" style="font-size:12px!important;line-height:15px!important"><div class="crayon-num" data-line="crayon-63f843893d268271611343-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d268271611343-2">2</div><div class="crayon-num" data-line="crayon-63f843893d268271611343-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d268271611343-4">4</div><div class="crayon-num" data-line="crayon-63f843893d268271611343-5">5</div></div></td><td class="crayon-code"><div class="crayon-pre" style="font-size:12px!important;line-height:15px!important;-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4"><div class="crayon-line" id="crayon-63f843893d268271611343-1"><span class="crayon-r">DECLARE</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d268271611343-2"><span class="crayon-h">&nbsp;&nbsp; </span>emp_count<span class="crayon-h"> </span><span class="crayon-r">INTEGER</span>;</div><div class="crayon-line" id="crayon-63f843893d268271611343-3"><span class="crayon-r">BEGIN</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d268271611343-4"><span class="crayon-h">&nbsp;&nbsp; </span>emp_count<span class="crayon-h"> </span>:=<span class="crayon-h"> </span>row_count<span class="crayon-o">@</span>chicago(<span class="crayon-s">'employees'</span>);</div><div class="crayon-line" id="crayon-63f843893d268271611343-5"><span class="crayon-r">END</span>;</div></div></td></tr></table></div></div><p></p><p><a name="invdyn"></a></p><h3>Использование прав Invoker с динамическим SQL</h3><p>Динамический SQL позволяет писать процедуры управления схемами, которые можно централизовать в одной схеме, а также вызывать из других схем и работать с объектами в этих схемах.</p><p>Например, эта процедура может удалить любой объект базы данных:</p><p></p><div id="crayon-63f843893d26b680177947" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top:12px;margin-bottom:12px;font-size:12px!important;line-height:15px!important"><div class="crayon-toolbar" data-settings=" show" style="font-size:12px!important;height:18px!important;line-height:18px!important"><span class="crayon-title"></span><div class="crayon-tools" style="font-size:12px!important;height:18px!important;line-height:18px!important"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Oracle PL/SQL</span></div></div><div class="crayon-info" style="min-height:16.8px!important;line-height:16.8px!important"></div><div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4;font-size:12px!important;line-height:15px!important">
CREATE OR REPLACE PROCEDURE drop_it (kind IN VARCHAR2, name IN
VARCHAR2)
AUTHID CURRENT_USER
AS
BEGIN
EXECUTE IMMEDIATE 'DROP ' || kind || ' ' || name;
END;</textarea></div><div class="crayon-main" style=""><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums" data-settings="hide"><div class="crayon-nums-content" style="font-size:12px!important;line-height:15px!important"><div class="crayon-num" data-line="crayon-63f843893d26b680177947-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d26b680177947-2">2</div><div class="crayon-num" data-line="crayon-63f843893d26b680177947-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d26b680177947-4">4</div><div class="crayon-num" data-line="crayon-63f843893d26b680177947-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d26b680177947-6">6</div><div class="crayon-num" data-line="crayon-63f843893d26b680177947-7">7</div></div></td><td class="crayon-code"><div class="crayon-pre" style="font-size:12px!important;line-height:15px!important;-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4"><div class="crayon-line" id="crayon-63f843893d26b680177947-1"><span class="crayon-r">CREATE</span><span class="crayon-h"> </span><span class="crayon-r">OR</span><span class="crayon-h"> </span><span class="crayon-r">REPLACE</span><span class="crayon-h"> </span><span class="crayon-r">PROCEDURE</span><span class="crayon-h"> </span>drop_it<span class="crayon-h"> </span>(kind<span class="crayon-h"> </span><span class="crayon-r">IN</span><span class="crayon-h"> </span><span class="crayon-r">VARCHAR2</span>,<span class="crayon-h"> </span>name<span class="crayon-h"> </span><span class="crayon-r">IN</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d26b680177947-2"><span class="crayon-r">VARCHAR2</span>)</div><div class="crayon-line" id="crayon-63f843893d26b680177947-3">AUTHID<span class="crayon-h"> </span>CURRENT_USER</div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d26b680177947-4"><span class="crayon-r">AS</span></div><div class="crayon-line" id="crayon-63f843893d26b680177947-5"><span class="crayon-r">BEGIN</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d26b680177947-6"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">EXECUTE</span><span class="crayon-h"> </span><span class="crayon-r">IMMEDIATE</span><span class="crayon-h"> </span><span class="crayon-s">'DROP '</span><span class="crayon-h"> </span>||<span class="crayon-h"> </span>kind<span class="crayon-h"> </span>||<span class="crayon-h"> </span><span class="crayon-s">' '</span><span class="crayon-h"> </span>||<span class="crayon-h"> </span>name;</div><div class="crayon-line" id="crayon-63f843893d26b680177947-7"><span class="crayon-r">END</span>;</div></div></td></tr></table></div></div><p></p><p>Допустим, эта процедура является частью схемы HR. Без этого условия AUTHID процедура всегда удаляла бы объекты в схеме HR, независимо от того, кто ее вызывает. Даже если вы передадите полное имя объекта, эта процедура не будет иметь прав для внесения изменений в другие схемы.</p><p>AUTHID оператор поднимает оба этих ограничения. Он позволяет процедуре запускаться с привилегиями пользователя, который ее вызывает, и делает неквалифицированные ссылки на объекты в схеме этого пользователя.</p><p><a name="deadlockdyn"></a></p><h3>Как избежать тупиков с помощью динамического SQL</h3><p>В некоторых ситуациях выполнение оператора определения данных SQL приводит к тупику. Например, приведенная ниже процедура вызывает взаимоблокировку, поскольку она пытается удалить саму себя. Для того чтобы избежать тупиков, никогда не пытайтесь выполнить команды ALTER или DROP подпрограммы или пакета в то время как вы все еще используете его.</p><p></p><div id="crayon-63f843893d26e131693501" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top:12px;margin-bottom:12px;font-size:12px!important;line-height:15px!important"><div class="crayon-toolbar" data-settings=" show" style="font-size:12px!important;height:18px!important;line-height:18px!important"><span class="crayon-title"></span><div class="crayon-tools" style="font-size:12px!important;height:18px!important;line-height:18px!important"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Oracle PL/SQL</span></div></div><div class="crayon-info" style="min-height:16.8px!important;line-height:16.8px!important"></div><div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4;font-size:12px!important;line-height:15px!important">
CREATE OR REPLACE PROCEDURE calc_bonus (emp_id NUMBER) AS
BEGIN
EXECUTE IMMEDIATE 'DROP PROCEDURE calc_bonus'; -- тупик!
END;</textarea></div><div class="crayon-main" style=""><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums" data-settings="hide"><div class="crayon-nums-content" style="font-size:12px!important;line-height:15px!important"><div class="crayon-num" data-line="crayon-63f843893d26e131693501-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d26e131693501-2">2</div><div class="crayon-num" data-line="crayon-63f843893d26e131693501-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f843893d26e131693501-4">4</div></div></td><td class="crayon-code"><div class="crayon-pre" style="font-size:12px!important;line-height:15px!important;-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4"><div class="crayon-line" id="crayon-63f843893d26e131693501-1"><span class="crayon-r">CREATE</span><span class="crayon-h"> </span><span class="crayon-r">OR</span><span class="crayon-h"> </span><span class="crayon-r">REPLACE</span><span class="crayon-h"> </span><span class="crayon-r">PROCEDURE</span><span class="crayon-h"> </span>calc_bonus<span class="crayon-h"> </span>(emp_id<span class="crayon-h"> </span><span class="crayon-r">NUMBER</span>)<span class="crayon-h"> </span><span class="crayon-r">AS</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d26e131693501-2"><span class="crayon-r">BEGIN</span></div><div class="crayon-line" id="crayon-63f843893d26e131693501-3"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">EXECUTE</span><span class="crayon-h"> </span><span class="crayon-r">IMMEDIATE</span><span class="crayon-h"> </span><span class="crayon-s">'DROP PROCEDURE calc_bonus'</span>;<span class="crayon-h"> </span><span class="crayon-c">-- тупик!</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f843893d26e131693501-4"><span class="crayon-r">END</span>;</div></div></td></tr></table></div></div><p></p></div><footer class="entry-meta"><span class="cat-links">Рубрика:&nbsp;<a href="category/oracle-programming.html" rel="category tag">Программирование Oracle / PLSQL</a></span> <span class="sep">| </span><span class="permalink"><a href="dynamic-sql.html" rel="bookmark" title="Прямая ссылка на Oracle/PLSQL динамический SQL">Permalink</a></span></footer></article><nav role="navigation" id="nav-below" class="site-navigation post-navigation"><h1 class="assistive-text">Post navigation</h1><div class="nav-previous"><a href="with-oracle-plsql.html" rel="prev"><span class="meta-nav">&laquo;</span> Oracle PL/SQL оператор WITH</a></div><div class="nav-next"><a href="anonymous-block-plsql.html" rel="next">Oracle/PLSQL анонимные блоки <span class="meta-nav">&raquo;</span></a></div></nav></div></div><div id="secondary" class="widget-area"><div id="sidebar-1" class="sidebar" role="complementary"><aside id="nav_menu-4" class="widget widget_nav_menu"><h1 class="widget-title">ORACLE PL/SQL</h1><div class="menu-programmirovanie-oracle-plsql-container"><ul id="menu-programmirovanie-oracle-plsql" class="menu"><li id="menu-item-2217" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-2217"><a href="procedures.html">Процедуры</a></li><li id="menu-item-2218" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-2218"><a href="functions.html">Функции</a></li><li id="menu-item-2216" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-2216"><a href="triggers.html">Триггеры</a></li><li id="menu-item-7466" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-7466"><a href="collections-and-records-oracle-plsql.html">Коллекции и записи</a></li><li id="menu-item-2246" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-2246"><a href="cursors.html">Курсоры</a></li><li id="menu-item-7709" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-7709"><a href="packages-oracle-plsql.html">Пакеты</a></li><li id="menu-item-8217" class="menu-item menu-item-type-custom menu-item-object-custom current-menu-item menu-item-8217"><a href="dynamic-sql.html" aria-current="page">Динамический SQL</a></li><li id="menu-item-2353" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-2353"><a href="sequences.html">Последовательности</a></li><li id="menu-item-2540" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-2540"><a href="tables-and-views.html">Таблицы и представления</a></li><li id="menu-item-2677" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-2677"><a href="datatypes.html">Типы данных</a></li><li id="menu-item-2449" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-2449"><a href="transactions.html">Транзакции</a></li><li id="menu-item-2316" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-2316"><a href="conditional-statements.html">Условные операторы</a></li><li id="menu-item-2340" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-2340"><a href="loops.html">Циклы</a></li><li id="menu-item-8302" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-8302"><a href="anonymous-block-plsql.html">Блоки PL/SQL</a></li></ul></div></aside><aside id="nav_menu-2" class="widget widget_nav_menu"><h1 class="widget-title">ФУНКЦИИ ORACLE/PLSQL</h1><div class="menu-funkczii-oracle-pl-sql-container"><ul id="menu-funkczii-oracle-pl-sql" class="menu"><li id="menu-item-4" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-4"><a title="function category" href="index.html">По категориям</a></li><li id="menu-item-7402" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-7402"><a href="analytic.html">Аналитические</a></li><li id="menu-item-7405" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-7405"><a href="string-character.html">Символьные / строковые</a></li><li id="menu-item-7406" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-7406"><a href="numeric-mathematical.html">Числовые / математические</a></li><li id="menu-item-7403" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-7403"><a href="date-time.html">Дата / время</a></li><li id="menu-item-7407" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-7407"><a href="conversion.html">Преобразование</a></li><li id="menu-item-7404" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-7404"><a href="advanced-function.html">Вспомогательные</a></li></ul></div></aside><aside id="custom_html-14" class="widget_text widget widget_custom_html"><div class="textwidget custom-html-widget"></div></aside></div></div></div><footer id="colophon" class="site-footer" role="contentinfo"><div class="site-info"><div>&copy; Клуб дедов-программистов</div></div></footer></div><script src="wp-content/cache/min/1/5da3b72814b1a36896cd845e11329e29.js" data-minify="1" defer=""></script></body></html>