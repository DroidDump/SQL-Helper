<!DOCTYPE html><!--suppress ALL -->
<html lang="ru-RU"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="viewport" content="width=device-width"><title>Oracle PL/SQL Пакеты &#8212; SQL Helper</title><link rel="stylesheet" href="wp-content/cache/min/1/fa8990c4217289171489528cd3f70146.css" media="all" data-minify="1"><script type="text/javascript" src="wp-includes/js/jquery/jquery.min.js?ver=3.6.1" id="jquery-core-js" defer=""></script><link rel="stylesheet" href="css/style.css"></head><body class="post-template-default single single-post postid-7697 single-format-standard one-sidebar-left medium-sidebar large-font-sidebar large-font-content"><div id="page" class="hfeed site"><header id="masthead" class="site-header" role="banner"><div class="site-branding"><h1 class="site-title"><a href="index.html" rel="home">SQL Helper</a></h1></div><nav role="navigation" class="site-navigation main-navigation"><h1 class="assistive-text">Menu</h1><div class="assistive-text skip-link"><a href="#content" title="Skip to content">Skip to content</a></div><div class="menu-sql-container"><ul id="menu-sql" class="menu"><li id="menu-item-2533" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-2533"><a href="sql-language.html">SQL</a></li><li id="menu-item-7341" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-7341"><a href="contents-oracle-plsql.html">Oracle PL/SQL</a></li><li id="menu-item-3192" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-3192"><a href="mysql-manual.html">MySQL</a></li><li id="menu-item-7342" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-7342"><a href="contents-sql-server.html">SQL Server</a></li><li id="menu-item-7343" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-7343"><a href="sqlite-manual.html">SQLite</a></li><li id="menu-item-6422" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-6422"><a href="postgresql-manual.html">PostgreSQL</a></li><li id="menu-item-7201" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-7201"><a href="mariadb-manual.html">MariaDB</a></li></ul></div></nav></header><div id="main" class="site-main"><div id="primary" class="content-area"><div id="content" class="site-content" role="main"><article id="post-7697" class="post-7697 post type-post status-publish format-standard hentry category-oracle-programming"><header class="entry-header"><h1 class="entry-title">Oracle PL/SQL Пакеты</h1><div class="entry-meta"></div></header><div class="entry-content"><p>В этом учебном пособии вы узнаете, как создавать пакеты и тела пакетов в Oracle PL/SQL с синтаксисом и примерами.<br><span id="more-7697"></span></p><h2>Описание</h2><p>В Oracle PL/SQL набор элементов: процедур, функций, определения типов; объявления переменных, констант можно объединить в пакет. После написания пакет PL/SQL компилируется, а затем сохраняется в базе данных Oracle, где его содержимое может использоваться многими приложениями.</p><ul><li><a href="#def">Что такое пакет Oracle PL/SQL?</a></li><ul><li><a href="#packs">Синтаксис</a></li><li><a href="#packp">Пример пакета PL/SQL</a></li></ul><li><a href="#ppreim">Преимущества пакетов Oracle PL/SQL</a></li><li><a href="#pspecif">Понимание спецификации пакета.</a></li><li><a href="#pbody">Понимание тела пакета.</a></li><li><a href="#pexmpl">Некоторые примеры функций пакета.</a></li><li><a href="#pprivat">Частные и публичные предметы в пакетах.</a></li><li><a href="#pover">Перегрузка подпрограмм пакета.</a></li><li><a href="#pstand">Как пакет STANDARD определяет среду Oracle PL/SQL</a></li><li><a href="#rules">Руководство по написанию пакетов</a></li></ul><p><a name="def"></a></p><h2>Что такое пакет Oracle PL/SQL?</h2><p>Пакет Oracle PL/SQL - это объект схемы, который группирует логически связанные типы, элементы и подпрограммы. Пакеты обычно состоят из двух частей: спецификации и тела, хотя иногда тело не нужно. Спецификация - это интерфейс для ваших приложений.<br>В <em>спицификации</em> пакета объявляются типы, переменные, константы, исключения, курсоры и подпрограммы, доступные для использования.<br><em>Тело</em> пакета полностью определяет курсоры и подпрограммы и реализует спецификацию.</p><p><a href="wp-content/uploads/2019/05/package.png"><img decoding="async" src="data:image/svg+xml,%3Csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%20300%20119'%3E%3C/svg%3E" alt="Пакеты Oracle PL/SQL" width="300" height="119" class="alignnone size-medium wp-image-7696" data-lazy-srcset="wp-content/uploads/2019/05/package-300x119.png 300w, wp-content/uploads/2019/05/package.png 421w" data-lazy-sizes="(max-width: 300px) 100vw, 300px" data-lazy-src="wp-content/uploads/2019/05/package-300x119.png"><noscript><img decoding="async" src="wp-content/uploads/2019/05/package-300x119.png" alt="Пакеты Oracle PL/SQL" width="300" height="119" class="alignnone size-medium wp-image-7696" srcset="wp-content/uploads/2019/05/package-300x119.png 300w, wp-content/uploads/2019/05/package.png 421w" sizes="(max-width: 300px) 100vw, 300px"></noscript></a></p><p>Как показано на рисунке, вы можете думать о спецификации как о рабочем интерфейсе, а о теле - как о «черном ящике». Вы можете отлаживать, улучшать или изменять тело пакета без изменения интерфейса (спецификации) пакета.</p><p>Для создания пакетов используйте оператор CREATE PACKAGE.</p><p><a name="packs"></a></p><h2>Синтаксис</h2><p>Синтаксис CREATE PACKAGE в Oracle PL/SQL:</p><div class="sintax">CREATE [OR REPLACE] PACKAGE package_name<br>[AUTHID {CURRENT_USER | DEFINER}]<br>{IS | AS}<br>[PRAGMA SERIALLY_REUSABLE;]<br>[collection_type_definition ...]<br>[record_type_definition ...]<br>[subtype_definition ...]<br>[collection_declaration ...]<br>[constant_declaration ...]<br>[exception_declaration ...]<br>[object_declaration ...]<br>[record_declaration ...]<br>[variable_declaration ...]<br>[cursor_spec ...]<br>[function_spec ...]<br>[procedure_spec ...]<br>[call_spec ...]<br>[PRAGMA RESTRICT_REFERENCES(assertions) ...]<br>END [package_name];<p>[CREATE [OR REPLACE] PACKAGE BODY package_name {IS | AS}<br>[PRAGMA SERIALLY_REUSABLE;]<br>[collection_type_definition ...]<br>[record_type_definition ...]<br>[subtype_definition ...]<br>[collection_declaration ...]<br>[constant_declaration ...]<br>[exception_declaration ...]<br>[object_declaration ...]<br>[record_declaration ...]<br>[variable_declaration ...]<br>[cursor_body ...]<br>[function_spec ...]<br>[procedure_spec ...]<br>[call_spec ...]<br>[BEGIN<br>sequence_of_statements]<br>END [package_name];]</p></div><p><span class="arg">collection_type_definition</span> - определение типа коллекции<br><span class="arg">record_type_definition</span> - определение типа записи<br><span class="arg">subtype_definition</span> - определение подтипа<br><span class="arg">collection_declaration</span> - объявление коллекции<br><span class="arg">constant_declaration</span> - объявление константы<br><span class="arg">exception_declaration</span> - объявление исключения<br><span class="arg">object_declaration</span> - объявление объекта<br><span class="arg">record_declaration</span> - объявление записи<br><span class="arg">variable_declaration</span> - объявление переменной<br><span class="arg">cursor_spec</span> - спецификация курсора<br><span class="arg">function_spec</span> - спецификация функции<br><span class="arg">procedure_spec</span> - спецификация процедуры<br><span class="arg">call_spec</span> - спецификация вызова</p><p><strong>Спецификация пакета</strong> содержит публичные объявления, которые видны вашему приложению. Вы должны объявить подпрограммы в конце спецификации после всех других элементов (кроме прагм, которые вызывают конкретную функцию; такие прагмы должны следовать спецификации функции).</p><p><strong>Тело пакета</strong> содержит детали реализации и приватные объявления, которые скрыты от вашего приложения. За декларативной частью тела пакета следует необязательная часть инициализации, которая обычно содержит операторы, которые инициализируют переменные пакета.</p><p><a name="packp"></a></p><h2>Пример пакета Oracle PL/SQL</h2><p>В приведенном ниже примере, вы определяете тип запись, курсор и две процедуры по трудоустройству. Обратите внимание, что процедура <span class="arg">hire_employee</span> использует последовательность базы данных <span class="arg">empno_seq</span> и функцию <a href="sysdate-function.html">SYSDATE</a> для вставки нового номера сотрудника и дату приема на работу соответственно.</p><p></p><div id="crayon-63f82f57e1324684906405" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top:12px;margin-bottom:12px;font-size:12px!important;line-height:15px!important"><div class="crayon-toolbar" data-settings=" show" style="font-size:12px!important;height:18px!important;line-height:18px!important"><span class="crayon-title"></span><div class="crayon-tools" style="font-size:12px!important;height:18px!important;line-height:18px!important"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Oracle PL/SQL</span></div></div><div class="crayon-info" style="min-height:16.8px!important;line-height:16.8px!important"></div><div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4;font-size:12px!important;line-height:15px!important">
CREATE OR REPLACE PACKAGE emp_actions AS  -- спецификация
TYPE EmpRecTyp IS RECORD (emp_id INT, salary REAL); -- тип запись
CURSOR desc_salary RETURN EmpRecTyp;                -- курсор
/*процедура приема на работу*/
PROCEDURE hire_employee (
ename  VARCHAR2,
job    VARCHAR2,
mgr    NUMBER,
sal    NUMBER,
comm   NUMBER,
deptno NUMBER);
/*процедура увольнения*/
PROCEDURE fire_employee (emp_id NUMBER);
END emp_actions;
CREATE OR REPLACE PACKAGE BODY emp_actions AS  -- тело
CURSOR desc_salary RETURN EmpRecTyp IS
SELECT empno, sal FROM emp ORDER BY sal DESC;
PROCEDURE hire_employee (
ename  VARCHAR2,
job    VARCHAR2,
mgr    NUMBER,
sal    NUMBER,
comm   NUMBER,
deptno NUMBER) IS
BEGIN
INSERT INTO emp VALUES (empno_seq.NEXTVAL, ename, job,
mgr, SYSDATE, sal, comm, deptno);
END hire_employee;
PROCEDURE fire_employee (emp_id NUMBER) IS
BEGIN
DELETE FROM emp WHERE empno = emp_id;
END fire_employee;
END emp_actions;</textarea></div><div class="crayon-main" style=""><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums" data-settings="hide"><div class="crayon-nums-content" style="font-size:12px!important;line-height:15px!important"><div class="crayon-num" data-line="crayon-63f82f57e1324684906405-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1324684906405-2">2</div><div class="crayon-num" data-line="crayon-63f82f57e1324684906405-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1324684906405-4">4</div><div class="crayon-num" data-line="crayon-63f82f57e1324684906405-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1324684906405-6">6</div><div class="crayon-num" data-line="crayon-63f82f57e1324684906405-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1324684906405-8">8</div><div class="crayon-num" data-line="crayon-63f82f57e1324684906405-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1324684906405-10">10</div><div class="crayon-num" data-line="crayon-63f82f57e1324684906405-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1324684906405-12">12</div><div class="crayon-num" data-line="crayon-63f82f57e1324684906405-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1324684906405-14">14</div><div class="crayon-num" data-line="crayon-63f82f57e1324684906405-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1324684906405-16">16</div><div class="crayon-num" data-line="crayon-63f82f57e1324684906405-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1324684906405-18">18</div><div class="crayon-num" data-line="crayon-63f82f57e1324684906405-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1324684906405-20">20</div><div class="crayon-num" data-line="crayon-63f82f57e1324684906405-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1324684906405-22">22</div><div class="crayon-num" data-line="crayon-63f82f57e1324684906405-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1324684906405-24">24</div><div class="crayon-num" data-line="crayon-63f82f57e1324684906405-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1324684906405-26">26</div><div class="crayon-num" data-line="crayon-63f82f57e1324684906405-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1324684906405-28">28</div><div class="crayon-num" data-line="crayon-63f82f57e1324684906405-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1324684906405-30">30</div><div class="crayon-num" data-line="crayon-63f82f57e1324684906405-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1324684906405-32">32</div><div class="crayon-num" data-line="crayon-63f82f57e1324684906405-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1324684906405-34">34</div><div class="crayon-num" data-line="crayon-63f82f57e1324684906405-35">35</div></div></td><td class="crayon-code"><div class="crayon-pre" style="font-size:12px!important;line-height:15px!important;-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4"><div class="crayon-line" id="crayon-63f82f57e1324684906405-1"><span class="crayon-r">CREATE</span><span class="crayon-h"> </span><span class="crayon-r">OR</span><span class="crayon-h"> </span><span class="crayon-r">REPLACE</span><span class="crayon-h"> </span><span class="crayon-r">PACKAGE</span><span class="crayon-h"> </span>emp_actions<span class="crayon-h"> </span><span class="crayon-r">AS</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">-- спецификация</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1324684906405-2"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">TYPE</span><span class="crayon-h"> </span>EmpRecTyp<span class="crayon-h"> </span><span class="crayon-r">IS</span><span class="crayon-h"> </span><span class="crayon-r">RECORD</span><span class="crayon-h"> </span>(emp_id<span class="crayon-h"> </span><span class="crayon-r">INT</span>,<span class="crayon-h"> </span>salary<span class="crayon-h"> </span><span class="crayon-r">REAL</span>);<span class="crayon-h"> </span><span class="crayon-c">-- тип запись</span></div><div class="crayon-line" id="crayon-63f82f57e1324684906405-3"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">CURSOR</span><span class="crayon-h"> </span>desc_salary<span class="crayon-h"> </span><span class="crayon-r">RETURN</span><span class="crayon-h"> </span>EmpRecTyp;<span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-c">-- курсор</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1324684906405-4"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-c">/*процедура приема на работу*/</span></div><div class="crayon-line" id="crayon-63f82f57e1324684906405-5"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">PROCEDURE</span><span class="crayon-h"> </span>hire_employee<span class="crayon-h"> </span>(</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1324684906405-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>ename<span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-r">VARCHAR2</span>,</div><div class="crayon-line" id="crayon-63f82f57e1324684906405-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>job<span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">VARCHAR2</span>,</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1324684906405-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>mgr<span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">NUMBER</span>,</div><div class="crayon-line" id="crayon-63f82f57e1324684906405-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>sal<span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">NUMBER</span>,</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1324684906405-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>comm<span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">NUMBER</span>,</div><div class="crayon-line" id="crayon-63f82f57e1324684906405-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>deptno<span class="crayon-h"> </span><span class="crayon-r">NUMBER</span>);</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1324684906405-12"><span class="crayon-h"></span><span class="crayon-c">/*процедура увольнения*/</span><span class="crayon-h">	&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-63f82f57e1324684906405-13"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">PROCEDURE</span><span class="crayon-h"> </span>fire_employee<span class="crayon-h"> </span>(emp_id<span class="crayon-h"> </span><span class="crayon-r">NUMBER</span>);</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1324684906405-14"><span class="crayon-r">END</span><span class="crayon-h"> </span>emp_actions;</div><div class="crayon-line" id="crayon-63f82f57e1324684906405-15">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1324684906405-16"><span class="crayon-r">CREATE</span><span class="crayon-h"> </span><span class="crayon-r">OR</span><span class="crayon-h"> </span><span class="crayon-r">REPLACE</span><span class="crayon-h"> </span><span class="crayon-r">PACKAGE</span><span class="crayon-h"> </span><span class="crayon-r">BODY</span><span class="crayon-h"> </span>emp_actions<span class="crayon-h"> </span><span class="crayon-r">AS</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">-- тело</span></div><div class="crayon-line" id="crayon-63f82f57e1324684906405-17"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">CURSOR</span><span class="crayon-h"> </span>desc_salary<span class="crayon-h"> </span><span class="crayon-r">RETURN</span><span class="crayon-h"> </span>EmpRecTyp<span class="crayon-h"> </span><span class="crayon-r">IS</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1324684906405-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">SELECT</span><span class="crayon-h"> </span>empno,<span class="crayon-h"> </span>sal<span class="crayon-h"> </span><span class="crayon-r">FROM</span><span class="crayon-h"> </span>emp<span class="crayon-h"> </span><span class="crayon-r">ORDER</span><span class="crayon-h"> </span><span class="crayon-r">BY</span><span class="crayon-h"> </span>sal<span class="crayon-h"> </span><span class="crayon-r">DESC</span>;</div><div class="crayon-line" id="crayon-63f82f57e1324684906405-19"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">PROCEDURE</span><span class="crayon-h"> </span>hire_employee<span class="crayon-h"> </span>(</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1324684906405-20"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>ename<span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-r">VARCHAR2</span>,</div><div class="crayon-line" id="crayon-63f82f57e1324684906405-21"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>job<span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">VARCHAR2</span>,</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1324684906405-22"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>mgr<span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">NUMBER</span>,</div><div class="crayon-line" id="crayon-63f82f57e1324684906405-23"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>sal<span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">NUMBER</span>,</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1324684906405-24"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>comm<span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">NUMBER</span>,</div><div class="crayon-line" id="crayon-63f82f57e1324684906405-25"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>deptno<span class="crayon-h"> </span><span class="crayon-r">NUMBER</span>)<span class="crayon-h"> </span><span class="crayon-r">IS</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1324684906405-26"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">BEGIN</span></div><div class="crayon-line" id="crayon-63f82f57e1324684906405-27"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">INSERT</span><span class="crayon-h"> </span><span class="crayon-r">INTO</span><span class="crayon-h"> </span>emp<span class="crayon-h"> </span><span class="crayon-r">VALUES</span><span class="crayon-h"> </span>(empno_seq.NEXTVAL,<span class="crayon-h"> </span>ename,<span class="crayon-h"> </span>job,</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1324684906405-28"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>mgr,<span class="crayon-h"> </span><span class="crayon-r">SYSDATE</span>,<span class="crayon-h"> </span>sal,<span class="crayon-h"> </span>comm,<span class="crayon-h"> </span>deptno);</div><div class="crayon-line" id="crayon-63f82f57e1324684906405-29"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">END</span><span class="crayon-h"> </span>hire_employee;</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1324684906405-30">&nbsp;</div><div class="crayon-line" id="crayon-63f82f57e1324684906405-31"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">PROCEDURE</span><span class="crayon-h"> </span>fire_employee<span class="crayon-h"> </span>(emp_id<span class="crayon-h"> </span><span class="crayon-r">NUMBER</span>)<span class="crayon-h"> </span><span class="crayon-r">IS</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1324684906405-32"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">BEGIN</span></div><div class="crayon-line" id="crayon-63f82f57e1324684906405-33"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">DELETE</span><span class="crayon-h"> </span><span class="crayon-r">FROM</span><span class="crayon-h"> </span>emp<span class="crayon-h"> </span><span class="crayon-r">WHERE</span><span class="crayon-h"> </span>empno<span class="crayon-h"> </span>=<span class="crayon-h"> </span>emp_id;</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1324684906405-34"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">END</span><span class="crayon-h"> </span>fire_employee;</div><div class="crayon-line" id="crayon-63f82f57e1324684906405-35"><span class="crayon-r">END</span><span class="crayon-h"> </span>emp_actions;</div></div></td></tr></table></div></div><p></p><p>Только объявления в спецификации пакета видны и доступны для приложений. Детали реализации в теле пакета скрыты и недоступны. Таким образом, вы можете изменить тело (реализацию) без перекомпиляции вызывающих программ.</p><p><a name="ppreim"></a></p><h2>Преимущества пакетов Oracle PL/SQL</h2><h3>Модульность</h3><p>Пакеты позволяют инкапсулировать логически связанные типы, элементы и подпрограммы в именованный модуль PL/SQL. Каждый пакет прост для понимания, а интерфейсы между пакетами просты, понятны и хорошо определены. Это помогает разработке приложений.</p><h3>Более простой дизайн приложений</h3><p>При разработке приложения все, что вам первоначально нужно, это информация об интерфейсе в спецификации пакета. Вы можете кодировать и компилировать спецификацию без ее тела. Затем сохраненные подпрограммы, которые ссылаются на пакет, также могут быть скомпилированы.</p><h3>Сокрытие информации</h3><p>С помощью пакетов вы можете указать, какие типы, элементы и подпрограммы являются общедоступными (видимыми и доступными) или приватными (скрытыми и недоступными). Например, если пакет содержит четыре подпрограммы, три могут быть открытыми и одна закрытая. Пакет скрывает реализацию закрытой подпрограммы, поэтому при изменении реализации затрагивается только пакет (не ваше приложение). Это упрощает обслуживание и улучшение. Кроме того, скрывая детали реализации от пользователей, вы защищаете целостность пакета.</p><h3>Добавленная функциональность</h3><p>Пакетные общедоступные переменные и курсоры сохраняются в течение сеанса. Таким образом, они могут быть общими для всех подпрограмм, которые выполняются в среде. Кроме того, они позволяют поддерживать данные между транзакциями, не сохраняя их в базе данных.</p><h3>Лучшая производительность</h3><p>Когда вы вызываете пакетную подпрограмму в первый раз, весь пакет загружается в память. Поэтому последующие вызовы связанных подпрограмм в пакете не требуют дискового ввода-вывода. Кроме того, пакеты останавливают каскадные зависимости и тем самым избегают ненужной перекомпиляции. Например, если вы измените реализацию пакетной функции, Oracle не нужно перекомпилировать вызывающие подпрограммы, поскольку они не зависят от тела пакета.</p><p><a name="pspecif"></a></p><h2>Понимание спецификации пакета.</h2><p>Спецификация пакета содержит публичные объявления элементов. Область этих объявлений является локальной для вашей схемы базы данных и глобальной для пакета. Итак, объявленные элементы доступны из вашего приложения и из любой точки пакета.</p><p>В спецификации перечислены элементы пакета, доступные приложениям. Вся информация, необходимая вашему приложению для использования элементов, содержится в спецификации. Например, следующее объявление показывает, что функция с именем <span class="arg">fac</span> принимает один аргумент типа INTEGER и возвращает значение типа INTEGER:</p><p></p><div id="crayon-63f82f57e132b013699364" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top:12px;margin-bottom:12px;font-size:12px!important;line-height:15px!important"><div class="crayon-toolbar" data-settings=" show" style="font-size:12px!important;height:18px!important;line-height:18px!important"><span class="crayon-title"></span><div class="crayon-tools" style="font-size:12px!important;height:18px!important;line-height:18px!important"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Oracle PL/SQL</span></div></div><div class="crayon-info" style="min-height:16.8px!important;line-height:16.8px!important"></div><div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4;font-size:12px!important;line-height:15px!important">
FUNCTION fac (n INTEGER) RETURN INTEGER;  -- returns n!</textarea></div><div class="crayon-main" style=""><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums" data-settings="hide"><div class="crayon-nums-content" style="font-size:12px!important;line-height:15px!important"><div class="crayon-num" data-line="crayon-63f82f57e132b013699364-1">1</div></div></td><td class="crayon-code"><div class="crayon-pre" style="font-size:12px!important;line-height:15px!important;-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4"><div class="crayon-line" id="crayon-63f82f57e132b013699364-1"><span class="crayon-r">FUNCTION</span><span class="crayon-h"> </span>fac<span class="crayon-h"> </span>(n<span class="crayon-h"> </span><span class="crayon-r">INTEGER</span>)<span class="crayon-h"> </span><span class="crayon-r">RETURN</span><span class="crayon-h"> </span><span class="crayon-r">INTEGER</span>;<span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">-- returns n!</span></div></div></td></tr></table></div></div><p></p><p>Это вся информация, необходимая для вызова функции. Вам не нужно рассматривать его базовую реализацию (например, итеративную или рекурсивную).</p><p>Только подпрограммы и курсоры имеют базовую реализацию. Таким образом, если спецификация объявляет только типы, константы, переменные, исключения и спецификации вызовов, то тело пакета не требуется. Рассмотрим следующий пакет без тела:</p><p></p><div id="crayon-63f82f57e1332188773590" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top:12px;margin-bottom:12px;font-size:12px!important;line-height:15px!important"><div class="crayon-toolbar" data-settings=" show" style="font-size:12px!important;height:18px!important;line-height:18px!important"><span class="crayon-title"></span><div class="crayon-tools" style="font-size:12px!important;height:18px!important;line-height:18px!important"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Oracle PL/SQL</span></div></div><div class="crayon-info" style="min-height:16.8px!important;line-height:16.8px!important"></div><div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4;font-size:12px!important;line-height:15px!important">
CREATE PACKAGE trans_data AS  -- bodiless package
TYPE TimeRec IS RECORD (
minutes SMALLINT,
hours   SMALLINT);
TYPE TransRec IS RECORD (
category VARCHAR2,
account  INT,
amount   REAL,
time_of  TimeRec);
minimum_balance    CONSTANT REAL := 10.00;
number_processed   INT;
insufficient_funds EXCEPTION;
END trans_data;</textarea></div><div class="crayon-main" style=""><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums" data-settings="hide"><div class="crayon-nums-content" style="font-size:12px!important;line-height:15px!important"><div class="crayon-num" data-line="crayon-63f82f57e1332188773590-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1332188773590-2">2</div><div class="crayon-num" data-line="crayon-63f82f57e1332188773590-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1332188773590-4">4</div><div class="crayon-num" data-line="crayon-63f82f57e1332188773590-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1332188773590-6">6</div><div class="crayon-num" data-line="crayon-63f82f57e1332188773590-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1332188773590-8">8</div><div class="crayon-num" data-line="crayon-63f82f57e1332188773590-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1332188773590-10">10</div><div class="crayon-num" data-line="crayon-63f82f57e1332188773590-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1332188773590-12">12</div><div class="crayon-num" data-line="crayon-63f82f57e1332188773590-13">13</div></div></td><td class="crayon-code"><div class="crayon-pre" style="font-size:12px!important;line-height:15px!important;-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4"><div class="crayon-line" id="crayon-63f82f57e1332188773590-1"><span class="crayon-r">CREATE</span><span class="crayon-h"> </span><span class="crayon-r">PACKAGE</span><span class="crayon-h"> </span>trans_data<span class="crayon-h"> </span><span class="crayon-r">AS</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">-- bodiless package</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1332188773590-2"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">TYPE</span><span class="crayon-h"> </span>TimeRec<span class="crayon-h"> </span><span class="crayon-r">IS</span><span class="crayon-h"> </span><span class="crayon-r">RECORD</span><span class="crayon-h"> </span>(</div><div class="crayon-line" id="crayon-63f82f57e1332188773590-3"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>minutes<span class="crayon-h"> </span><span class="crayon-r">SMALLINT</span>,</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1332188773590-4"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>hours<span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">SMALLINT</span>);</div><div class="crayon-line" id="crayon-63f82f57e1332188773590-5"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">TYPE</span><span class="crayon-h"> </span>TransRec<span class="crayon-h"> </span><span class="crayon-r">IS</span><span class="crayon-h"> </span><span class="crayon-r">RECORD</span><span class="crayon-h"> </span>(</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1332188773590-6"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>category<span class="crayon-h"> </span><span class="crayon-r">VARCHAR2</span>,</div><div class="crayon-line" id="crayon-63f82f57e1332188773590-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">account</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-r">INT</span>,</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1332188773590-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>amount<span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">REAL</span>,</div><div class="crayon-line" id="crayon-63f82f57e1332188773590-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>time_of<span class="crayon-h">&nbsp;&nbsp;</span>TimeRec);</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1332188773590-10"><span class="crayon-h">&nbsp;&nbsp; </span>minimum_balance<span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span>CONSTANT<span class="crayon-h"> </span><span class="crayon-r">REAL</span><span class="crayon-h"> </span>:=<span class="crayon-h"> </span>10.00;</div><div class="crayon-line" id="crayon-63f82f57e1332188773590-11"><span class="crayon-h">&nbsp;&nbsp; </span>number_processed<span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">INT</span>;</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1332188773590-12"><span class="crayon-h">&nbsp;&nbsp; </span>insufficient_funds<span class="crayon-h"> </span><span class="crayon-r">EXCEPTION</span>;</div><div class="crayon-line" id="crayon-63f82f57e1332188773590-13"><span class="crayon-r">END</span><span class="crayon-h"> </span>trans_data;</div></div></td></tr></table></div></div><p></p><p>Пакет <span class="arg">trans_data</span> не нуждается в теле, потому что типы, константы, переменные и исключения не имеют базовой реализации. Такие пакеты позволяют вам определять глобальные переменные - используемые подпрограммами и триггерами базы данных - которые сохраняются в течение сеанса.</p><h3>Ссылка на содержание пакета</h3><p>Чтобы ссылаться на типы, элементы, подпрограммы и спецификации вызовов, объявленные в спецификации пакета, используйте точечную нотацию следующим образом:</p><p><span class="arg">package_name.type_name</span></p><p><span class="arg">package_name.item_name</span></p><p><span class="arg">package_name.subprogram_name</span></p><p><span class="arg">package_name.call_spec_name</span></p><p>Вы можете ссылаться на содержимое пакета с помощью триггеров базы данных, хранимых подпрограмм, прикладных программ 3GL и различных инструментов Oracle. Например, вы можете вызвать процедуру пакета <span class="arg">hire_employee</span> из PL/SQL Developer следующим образом:</p><p></p><div id="crayon-63f82f57e1335738942705" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top:12px;margin-bottom:12px;font-size:12px!important;line-height:15px!important"><div class="crayon-toolbar" data-settings=" show" style="font-size:12px!important;height:18px!important;line-height:18px!important"><span class="crayon-title"></span><div class="crayon-tools" style="font-size:12px!important;height:18px!important;line-height:18px!important"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Oracle PL/SQL</span></div></div><div class="crayon-info" style="min-height:16.8px!important;line-height:16.8px!important"></div><div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4;font-size:12px!important;line-height:15px!important">
BEGIN
emp_actions.hire_employee('VLADIMIR', 'MEDIC', ...);
END;</textarea></div><div class="crayon-main" style=""><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums" data-settings="hide"><div class="crayon-nums-content" style="font-size:12px!important;line-height:15px!important"><div class="crayon-num" data-line="crayon-63f82f57e1335738942705-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1335738942705-2">2</div><div class="crayon-num" data-line="crayon-63f82f57e1335738942705-3">3</div></div></td><td class="crayon-code"><div class="crayon-pre" style="font-size:12px!important;line-height:15px!important;-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4"><div class="crayon-line" id="crayon-63f82f57e1335738942705-1"><span class="crayon-r">BEGIN</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1335738942705-2"><span class="crayon-h">&nbsp;&nbsp;</span>emp_actions.hire_employee(<span class="crayon-s">'VLADIMIR'</span>,<span class="crayon-h"> </span><span class="crayon-s">'MEDIC'</span>,<span class="crayon-h"> </span>...);</div><div class="crayon-line" id="crayon-63f82f57e1335738942705-3"><span class="crayon-r">END</span>;</div></div></td></tr></table></div></div><p></p><h4>Ограничения</h4><p>Вы не можете ссылаться на удаленные переменные пакета прямо или косвенно. Например, вы не можете вызвать следующую процедуру удаленно, потому что она ссылается на переменную пакета, когда параметр инициализируется:</p><p></p><div id="crayon-63f82f57e1337519574401" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top:12px;margin-bottom:12px;font-size:12px!important;line-height:15px!important"><div class="crayon-toolbar" data-settings=" show" style="font-size:12px!important;height:18px!important;line-height:18px!important"><span class="crayon-title"></span><div class="crayon-tools" style="font-size:12px!important;height:18px!important;line-height:18px!important"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Oracle PL/SQL</span></div></div><div class="crayon-info" style="min-height:16.8px!important;line-height:16.8px!important"></div><div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4;font-size:12px!important;line-height:15px!important">
CREATE PACKAGE random AS
seed NUMBER;
PROCEDURE initialize (starter IN NUMBER := seed, ...);</textarea></div><div class="crayon-main" style=""><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums" data-settings="hide"><div class="crayon-nums-content" style="font-size:12px!important;line-height:15px!important"><div class="crayon-num" data-line="crayon-63f82f57e1337519574401-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1337519574401-2">2</div><div class="crayon-num" data-line="crayon-63f82f57e1337519574401-3">3</div></div></td><td class="crayon-code"><div class="crayon-pre" style="font-size:12px!important;line-height:15px!important;-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4"><div class="crayon-line" id="crayon-63f82f57e1337519574401-1"><span class="crayon-r">CREATE</span><span class="crayon-h"> </span><span class="crayon-r">PACKAGE</span><span class="crayon-h"> </span>random<span class="crayon-h"> </span><span class="crayon-r">AS</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1337519574401-2"><span class="crayon-h">&nbsp;&nbsp; </span>seed<span class="crayon-h"> </span><span class="crayon-r">NUMBER</span>;</div><div class="crayon-line" id="crayon-63f82f57e1337519574401-3"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">PROCEDURE</span><span class="crayon-h"> </span>initialize<span class="crayon-h"> </span>(starter<span class="crayon-h"> </span><span class="crayon-r">IN</span><span class="crayon-h"> </span><span class="crayon-r">NUMBER</span><span class="crayon-h"> </span>:=<span class="crayon-h"> </span>seed,<span class="crayon-h"> </span>...);</div></div></td></tr></table></div></div><p></p><p>Кроме того, внутри пакета вы не можете ссылаться на переменные хоста.</p><p><a name="pbody"></a></p><h2>Понимание тела пакета</h2><p>Тело пакета реализует спецификацию пакета. То есть тело пакета содержит реализацию каждого курсора и подпрограммы, объявленных в спецификации пакета. Помните, что подпрограммы, определенные в теле пакета, доступны вне пакета, только если их спецификации также указаны в спецификации пакета.</p><p>Чтобы сопоставить спецификации и тела подпрограмм, PL/SQL выполняет сравнение их заголовков по определениям. Таким образом, за исключением пробелов, заголовки должны соответствовать слово в слово. В противном случае PL/SQL вызывает исключение, как показано в следующем примере:</p><p></p><div id="crayon-63f82f57e133a556645966" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top:12px;margin-bottom:12px;font-size:12px!important;line-height:15px!important"><div class="crayon-toolbar" data-settings=" show" style="font-size:12px!important;height:18px!important;line-height:18px!important"><span class="crayon-title"></span><div class="crayon-tools" style="font-size:12px!important;height:18px!important;line-height:18px!important"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Oracle PL/SQL</span></div></div><div class="crayon-info" style="min-height:16.8px!important;line-height:16.8px!important"></div><div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4;font-size:12px!important;line-height:15px!important">
CREATE PACKAGE emp_actions AS
...
PROCEDURE calc_bonus (date_hired emp.hiredate%TYPE, ...);
END emp_actions;

CREATE PACKAGE BODY emp_actions AS
...
PROCEDURE calc_bonus (date_hired DATE, ...) IS
/* объявление параметра вызывает исключение, потому что 'DATE'
не соответствует 'emp.hiredate%TYPE' слово в слово
*/
BEGIN ... END;
END emp_actions;</textarea></div><div class="crayon-main" style=""><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums" data-settings="hide"><div class="crayon-nums-content" style="font-size:12px!important;line-height:15px!important"><div class="crayon-num" data-line="crayon-63f82f57e133a556645966-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e133a556645966-2">2</div><div class="crayon-num" data-line="crayon-63f82f57e133a556645966-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e133a556645966-4">4</div><div class="crayon-num" data-line="crayon-63f82f57e133a556645966-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e133a556645966-6">6</div><div class="crayon-num" data-line="crayon-63f82f57e133a556645966-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e133a556645966-8">8</div><div class="crayon-num" data-line="crayon-63f82f57e133a556645966-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e133a556645966-10">10</div><div class="crayon-num" data-line="crayon-63f82f57e133a556645966-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e133a556645966-12">12</div><div class="crayon-num" data-line="crayon-63f82f57e133a556645966-13">13</div></div></td><td class="crayon-code"><div class="crayon-pre" style="font-size:12px!important;line-height:15px!important;-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4"><div class="crayon-line" id="crayon-63f82f57e133a556645966-1"><span class="crayon-r">CREATE</span><span class="crayon-h"> </span><span class="crayon-r">PACKAGE</span><span class="crayon-h"> </span>emp_actions<span class="crayon-h"> </span><span class="crayon-r">AS</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e133a556645966-2"><span class="crayon-h">&nbsp;&nbsp; </span>...</div><div class="crayon-line" id="crayon-63f82f57e133a556645966-3"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">PROCEDURE</span><span class="crayon-h"> </span>calc_bonus<span class="crayon-h"> </span>(date_hired<span class="crayon-h"> </span>emp.hiredate<span class="crayon-t">%TYPE</span>,<span class="crayon-h"> </span>...);</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e133a556645966-4"><span class="crayon-r">END</span><span class="crayon-h"> </span>emp_actions;</div><div class="crayon-line" id="crayon-63f82f57e133a556645966-5"><span class="crayon-h"></span></div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e133a556645966-6"><span class="crayon-r">CREATE</span><span class="crayon-h"> </span><span class="crayon-r">PACKAGE</span><span class="crayon-h"> </span><span class="crayon-r">BODY</span><span class="crayon-h"> </span>emp_actions<span class="crayon-h"> </span><span class="crayon-r">AS</span></div><div class="crayon-line" id="crayon-63f82f57e133a556645966-7"><span class="crayon-h">&nbsp;&nbsp; </span>...<span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e133a556645966-8"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">PROCEDURE</span><span class="crayon-h"> </span>calc_bonus<span class="crayon-h"> </span>(date_hired<span class="crayon-h"> </span><span class="crayon-r">DATE</span>,<span class="crayon-h"> </span>...)<span class="crayon-h"> </span><span class="crayon-r">IS</span><span class="crayon-h"></span></div><div class="crayon-line" id="crayon-63f82f57e133a556645966-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-c">/* объявление параметра вызывает исключение, потому что 'DATE'</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e133a556645966-10"><span class="crayon-c">не соответствует 'emp.hiredate%TYPE' слово в слово</span></div><div class="crayon-line" id="crayon-63f82f57e133a556645966-11"><span class="crayon-c">&nbsp;&nbsp;&nbsp;&nbsp; */</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e133a556645966-12"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">BEGIN</span><span class="crayon-h"> </span>...<span class="crayon-h"> </span><span class="crayon-r">END</span>;</div><div class="crayon-line" id="crayon-63f82f57e133a556645966-13"><span class="crayon-r">END</span><span class="crayon-h"> </span>emp_actions;</div></div></td></tr></table></div></div><p></p><p>Тело пакета также может содержать частные объявления, которые определяют типы и элементы, необходимые для внутренней работы пакета. Область этих объявлений является локальной для тела пакета. Поэтому объявленные типы и элементы недоступны, кроме как внутри тела пакета. В отличие от спецификации пакета, декларативная часть тела пакета может содержать тела подпрограммы.</p><p>За декларативной частью тела пакета следует дополнительная часть инициализации, которая обычно содержит операторы, которые инициализируют некоторые переменные, ранее объявленные в пакете.</p><p>Часть инициализации пакета играет второстепенную роль, потому что, в отличие от подпрограмм, пакет не может быть вызван или передан параметрами. В результате часть инициализации пакета запускается только один раз, при первом обращении к пакету.</p><p>Помните, если спецификация пакета объявляет только типы, константы, переменные, исключения и спецификации вызовов, тело пакета не требуется. Однако тело все еще можно использовать для инициализации элементов, объявленных в спецификации пакета.</p><p><a name="pexmpl"></a></p><h2>Некоторые примеры функций пакета</h2><p>Рассмотрим пакет с именем <span class="arg">emp_actions</span> ниже. Спецификация пакета объявляет следующие типы, элементы и подпрограммы:</p><p></p><div id="crayon-63f82f57e133c109792722" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top:12px;margin-bottom:12px;font-size:12px!important;line-height:15px!important"><div class="crayon-toolbar" data-settings=" show" style="font-size:12px!important;height:18px!important;line-height:18px!important"><span class="crayon-title"></span><div class="crayon-tools" style="font-size:12px!important;height:18px!important;line-height:18px!important"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Oracle PL/SQL</span></div></div><div class="crayon-info" style="min-height:16.8px!important;line-height:16.8px!important"></div><div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4;font-size:12px!important;line-height:15px!important">
Types EmpRecTyp and DeptRecTyp
Cursor desc_salary
Exception invalid_salary
Functions hire_employee and nth_highest_salary
Procedures fire_employee and raise_salary</textarea></div><div class="crayon-main" style=""><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums" data-settings="hide"><div class="crayon-nums-content" style="font-size:12px!important;line-height:15px!important"><div class="crayon-num" data-line="crayon-63f82f57e133c109792722-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e133c109792722-2">2</div><div class="crayon-num" data-line="crayon-63f82f57e133c109792722-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e133c109792722-4">4</div><div class="crayon-num" data-line="crayon-63f82f57e133c109792722-5">5</div></div></td><td class="crayon-code"><div class="crayon-pre" style="font-size:12px!important;line-height:15px!important;-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4"><div class="crayon-line" id="crayon-63f82f57e133c109792722-1">Types<span class="crayon-h"> </span>EmpRecTyp<span class="crayon-h"> </span><span class="crayon-r">and</span><span class="crayon-h"> </span>DeptRecTyp</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e133c109792722-2"><span class="crayon-r">Cursor</span><span class="crayon-h"> </span>desc_salary</div><div class="crayon-line" id="crayon-63f82f57e133c109792722-3"><span class="crayon-r">Exception</span><span class="crayon-h"> </span>invalid_salary</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e133c109792722-4">Functions<span class="crayon-h"> </span>hire_employee<span class="crayon-h"> </span><span class="crayon-r">and</span><span class="crayon-h"> </span>nth_highest_salary</div><div class="crayon-line" id="crayon-63f82f57e133c109792722-5">Procedures<span class="crayon-h"> </span>fire_employee<span class="crayon-h"> </span><span class="crayon-r">and</span><span class="crayon-h"> </span>raise_salary</div></div></td></tr></table></div></div><p></p><p>После написания пакета вы можете разрабатывать приложения, которые ссылаются на его типы, вызывать его подпрограммы, использовать его курсор и вызывать его исключение. Когда вы создаете пакет, он сохраняется в базе данных Oracle для общего пользования.</p><p></p><div id="crayon-63f82f57e133f980662931" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top:12px;margin-bottom:12px;font-size:12px!important;line-height:15px!important"><div class="crayon-toolbar" data-settings=" show" style="font-size:12px!important;height:18px!important;line-height:18px!important"><span class="crayon-title"></span><div class="crayon-tools" style="font-size:12px!important;height:18px!important;line-height:18px!important"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Oracle PL/SQL</span></div></div><div class="crayon-info" style="min-height:16.8px!important;line-height:16.8px!important"></div><div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4;font-size:12px!important;line-height:15px!important">
CREATE PACKAGE emp_actions AS
/* Объявление внешних видимых: типов, курсора, исключения. */
TYPE EmpRecTyp IS RECORD (emp_id INT, salary REAL);
TYPE DeptRecTyp IS RECORD (dept_id INT, location VARCHAR2);
CURSOR desc_salary RETURN EmpRecTyp;
invalid_salary EXCEPTION;

/* Объявление внешних вызываемых подпрограмм. */
FUNCTION hire_employee (
ename  VARCHAR2,
job    VARCHAR2,
mgr    REAL,
sal    REAL,
comm   REAL,
deptno REAL) RETURN INT;
PROCEDURE fire_employee (emp_id INT);
PROCEDURE raise_salary (emp_id INT, grade INT, amount REAL);
FUNCTION nth_highest_salary (n INT) RETURN EmpRecTyp;
END emp_actions;

CREATE PACKAGE BODY emp_actions AS
number_hired INT;  -- видна только в этом пакете

/* Полностью определенный курсор, указанный в пакете. */
CURSOR desc_salary RETURN EmpRecTyp IS
SELECT empno, sal FROM emp ORDER BY sal DESC;

/* Полностью определенная подпрограмма, указанная в пакете. */
FUNCTION hire_employee (
ename  VARCHAR2,
job    VARCHAR2,
mgr    REAL,
sal    REAL,
comm   REAL,
deptno REAL) RETURN INT IS
new_empno INT;
BEGIN
SELECT empno_seq.NEXTVAL INTO new_empno FROM dual;
INSERT INTO emp VALUES (new_empno, ename, job,
mgr, SYSDATE, sal, comm, deptno);
number_hired := number_hired + 1;
RETURN new_empno;
END hire_employee;

PROCEDURE fire_employee (emp_id INT) IS
BEGIN
DELETE FROM emp WHERE empno = emp_id;
END fire_employee;
/* Определенная локальная функция, доступна только внутри пакета. */
FUNCTION sal_ok (rank INT, salary REAL) RETURN BOOLEAN IS
min_sal REAL;
max_sal REAL;
BEGIN
SELECT losal, hisal INTO min_sal, max_sal FROM salgrade
WHERE grade = rank;
RETURN (salary &gt;= min_sal) AND (salary &lt;= max_sal);
END sal_ok;
PROCEDURE raise_salary (emp_id INT, grade INT, amount REAL) IS
salary REAL;
BEGIN
SELECT sal INTO salary FROM emp WHERE empno = emp_id;
IF sal_ok(grade, salary + amount) THEN
UPDATE emp SET sal = sal + amount WHERE empno = emp_id;
ELSE
RAISE invalid_salary;
END IF;
END raise_salary;

FUNCTION nth_highest_salary (n INT) RETURN EmpRecTyp IS
emp_rec EmpRecTyp;
BEGIN
OPEN desc_salary;
FOR i IN 1..n LOOP
FETCH desc_salary INTO emp_rec;
END LOOP;
CLOSE desc_salary;
RETURN emp_rec;
END nth_highest_salary;

BEGIN  -- часть инициализации начинается здесь
INSERT INTO emp_audit VALUES (SYSDATE, USER, 'EMP_ACTIONS');
number_hired := 0;
END emp_actions;</textarea></div><div class="crayon-main" style=""><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums" data-settings="hide"><div class="crayon-nums-content" style="font-size:12px!important;line-height:15px!important"><div class="crayon-num" data-line="crayon-63f82f57e133f980662931-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e133f980662931-2">2</div><div class="crayon-num" data-line="crayon-63f82f57e133f980662931-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e133f980662931-4">4</div><div class="crayon-num" data-line="crayon-63f82f57e133f980662931-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e133f980662931-6">6</div><div class="crayon-num" data-line="crayon-63f82f57e133f980662931-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e133f980662931-8">8</div><div class="crayon-num" data-line="crayon-63f82f57e133f980662931-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e133f980662931-10">10</div><div class="crayon-num" data-line="crayon-63f82f57e133f980662931-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e133f980662931-12">12</div><div class="crayon-num" data-line="crayon-63f82f57e133f980662931-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e133f980662931-14">14</div><div class="crayon-num" data-line="crayon-63f82f57e133f980662931-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e133f980662931-16">16</div><div class="crayon-num" data-line="crayon-63f82f57e133f980662931-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e133f980662931-18">18</div><div class="crayon-num" data-line="crayon-63f82f57e133f980662931-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e133f980662931-20">20</div><div class="crayon-num" data-line="crayon-63f82f57e133f980662931-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e133f980662931-22">22</div><div class="crayon-num" data-line="crayon-63f82f57e133f980662931-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e133f980662931-24">24</div><div class="crayon-num" data-line="crayon-63f82f57e133f980662931-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e133f980662931-26">26</div><div class="crayon-num" data-line="crayon-63f82f57e133f980662931-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e133f980662931-28">28</div><div class="crayon-num" data-line="crayon-63f82f57e133f980662931-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e133f980662931-30">30</div><div class="crayon-num" data-line="crayon-63f82f57e133f980662931-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e133f980662931-32">32</div><div class="crayon-num" data-line="crayon-63f82f57e133f980662931-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e133f980662931-34">34</div><div class="crayon-num" data-line="crayon-63f82f57e133f980662931-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e133f980662931-36">36</div><div class="crayon-num" data-line="crayon-63f82f57e133f980662931-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e133f980662931-38">38</div><div class="crayon-num" data-line="crayon-63f82f57e133f980662931-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e133f980662931-40">40</div><div class="crayon-num" data-line="crayon-63f82f57e133f980662931-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e133f980662931-42">42</div><div class="crayon-num" data-line="crayon-63f82f57e133f980662931-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e133f980662931-44">44</div><div class="crayon-num" data-line="crayon-63f82f57e133f980662931-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e133f980662931-46">46</div><div class="crayon-num" data-line="crayon-63f82f57e133f980662931-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e133f980662931-48">48</div><div class="crayon-num" data-line="crayon-63f82f57e133f980662931-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e133f980662931-50">50</div><div class="crayon-num" data-line="crayon-63f82f57e133f980662931-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e133f980662931-52">52</div><div class="crayon-num" data-line="crayon-63f82f57e133f980662931-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e133f980662931-54">54</div><div class="crayon-num" data-line="crayon-63f82f57e133f980662931-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e133f980662931-56">56</div><div class="crayon-num" data-line="crayon-63f82f57e133f980662931-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e133f980662931-58">58</div><div class="crayon-num" data-line="crayon-63f82f57e133f980662931-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e133f980662931-60">60</div><div class="crayon-num" data-line="crayon-63f82f57e133f980662931-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e133f980662931-62">62</div><div class="crayon-num" data-line="crayon-63f82f57e133f980662931-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e133f980662931-64">64</div><div class="crayon-num" data-line="crayon-63f82f57e133f980662931-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e133f980662931-66">66</div><div class="crayon-num" data-line="crayon-63f82f57e133f980662931-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e133f980662931-68">68</div><div class="crayon-num" data-line="crayon-63f82f57e133f980662931-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e133f980662931-70">70</div><div class="crayon-num" data-line="crayon-63f82f57e133f980662931-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e133f980662931-72">72</div><div class="crayon-num" data-line="crayon-63f82f57e133f980662931-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e133f980662931-74">74</div><div class="crayon-num" data-line="crayon-63f82f57e133f980662931-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e133f980662931-76">76</div><div class="crayon-num" data-line="crayon-63f82f57e133f980662931-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e133f980662931-78">78</div><div class="crayon-num" data-line="crayon-63f82f57e133f980662931-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e133f980662931-80">80</div><div class="crayon-num" data-line="crayon-63f82f57e133f980662931-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e133f980662931-82">82</div><div class="crayon-num" data-line="crayon-63f82f57e133f980662931-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e133f980662931-84">84</div><div class="crayon-num" data-line="crayon-63f82f57e133f980662931-85">85</div></div></td><td class="crayon-code"><div class="crayon-pre" style="font-size:12px!important;line-height:15px!important;-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4"><div class="crayon-line" id="crayon-63f82f57e133f980662931-1"><span class="crayon-r">CREATE</span><span class="crayon-h"> </span><span class="crayon-r">PACKAGE</span><span class="crayon-h"> </span>emp_actions<span class="crayon-h"> </span><span class="crayon-r">AS</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e133f980662931-2"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-c">/* Объявление внешних видимых: типов, курсора, исключения. */</span></div><div class="crayon-line" id="crayon-63f82f57e133f980662931-3"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">TYPE</span><span class="crayon-h"> </span>EmpRecTyp<span class="crayon-h"> </span><span class="crayon-r">IS</span><span class="crayon-h"> </span><span class="crayon-r">RECORD</span><span class="crayon-h"> </span>(emp_id<span class="crayon-h"> </span><span class="crayon-r">INT</span>,<span class="crayon-h"> </span>salary<span class="crayon-h"> </span><span class="crayon-r">REAL</span>);</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e133f980662931-4"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">TYPE</span><span class="crayon-h"> </span>DeptRecTyp<span class="crayon-h"> </span><span class="crayon-r">IS</span><span class="crayon-h"> </span><span class="crayon-r">RECORD</span><span class="crayon-h"> </span>(dept_id<span class="crayon-h"> </span><span class="crayon-r">INT</span>,<span class="crayon-h"> </span>location<span class="crayon-h"> </span><span class="crayon-r">VARCHAR2</span>);</div><div class="crayon-line" id="crayon-63f82f57e133f980662931-5"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">CURSOR</span><span class="crayon-h"> </span>desc_salary<span class="crayon-h"> </span><span class="crayon-r">RETURN</span><span class="crayon-h"> </span>EmpRecTyp;</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e133f980662931-6"><span class="crayon-h">&nbsp;&nbsp; </span>invalid_salary<span class="crayon-h"> </span><span class="crayon-r">EXCEPTION</span>;</div><div class="crayon-line" id="crayon-63f82f57e133f980662931-7"><span class="crayon-h"></span></div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e133f980662931-8"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-c">/* Объявление внешних вызываемых подпрограмм. */</span></div><div class="crayon-line" id="crayon-63f82f57e133f980662931-9"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">FUNCTION</span><span class="crayon-h"> </span>hire_employee<span class="crayon-h"> </span>(</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e133f980662931-10"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>ename<span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-r">VARCHAR2</span>,</div><div class="crayon-line" id="crayon-63f82f57e133f980662931-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>job<span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">VARCHAR2</span>,</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e133f980662931-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>mgr<span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">REAL</span>,</div><div class="crayon-line" id="crayon-63f82f57e133f980662931-13"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>sal<span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">REAL</span>,</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e133f980662931-14"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>comm<span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">REAL</span>,</div><div class="crayon-line" id="crayon-63f82f57e133f980662931-15"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>deptno<span class="crayon-h"> </span><span class="crayon-r">REAL</span>)<span class="crayon-h"> </span><span class="crayon-r">RETURN</span><span class="crayon-h"> </span><span class="crayon-r">INT</span>;</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e133f980662931-16"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">PROCEDURE</span><span class="crayon-h"> </span>fire_employee<span class="crayon-h"> </span>(emp_id<span class="crayon-h"> </span><span class="crayon-r">INT</span>);</div><div class="crayon-line" id="crayon-63f82f57e133f980662931-17"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">PROCEDURE</span><span class="crayon-h"> </span>raise_salary<span class="crayon-h"> </span>(emp_id<span class="crayon-h"> </span><span class="crayon-r">INT</span>,<span class="crayon-h"> </span>grade<span class="crayon-h"> </span><span class="crayon-r">INT</span>,<span class="crayon-h"> </span>amount<span class="crayon-h"> </span><span class="crayon-r">REAL</span>);</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e133f980662931-18"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">FUNCTION</span><span class="crayon-h"> </span>nth_highest_salary<span class="crayon-h"> </span>(n<span class="crayon-h"> </span><span class="crayon-r">INT</span>)<span class="crayon-h"> </span><span class="crayon-r">RETURN</span><span class="crayon-h"> </span>EmpRecTyp;</div><div class="crayon-line" id="crayon-63f82f57e133f980662931-19"><span class="crayon-r">END</span><span class="crayon-h"> </span>emp_actions;</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e133f980662931-20"><span class="crayon-h"></span></div><div class="crayon-line" id="crayon-63f82f57e133f980662931-21"><span class="crayon-r">CREATE</span><span class="crayon-h"> </span><span class="crayon-r">PACKAGE</span><span class="crayon-h"> </span><span class="crayon-r">BODY</span><span class="crayon-h"> </span>emp_actions<span class="crayon-h"> </span><span class="crayon-r">AS</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e133f980662931-22"><span class="crayon-h">&nbsp;&nbsp; </span>number_hired<span class="crayon-h"> </span><span class="crayon-r">INT</span>;<span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">-- видна только в этом пакете</span></div><div class="crayon-line" id="crayon-63f82f57e133f980662931-23"><span class="crayon-h"></span></div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e133f980662931-24"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-c">/* Полностью определенный курсор, указанный в пакете. */</span></div><div class="crayon-line" id="crayon-63f82f57e133f980662931-25"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">CURSOR</span><span class="crayon-h"> </span>desc_salary<span class="crayon-h"> </span><span class="crayon-r">RETURN</span><span class="crayon-h"> </span>EmpRecTyp<span class="crayon-h"> </span><span class="crayon-r">IS</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e133f980662931-26"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">SELECT</span><span class="crayon-h"> </span>empno,<span class="crayon-h"> </span>sal<span class="crayon-h"> </span><span class="crayon-r">FROM</span><span class="crayon-h"> </span>emp<span class="crayon-h"> </span><span class="crayon-r">ORDER</span><span class="crayon-h"> </span><span class="crayon-r">BY</span><span class="crayon-h"> </span>sal<span class="crayon-h"> </span><span class="crayon-r">DESC</span>;</div><div class="crayon-line" id="crayon-63f82f57e133f980662931-27"><span class="crayon-h"></span></div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e133f980662931-28"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-c">/* Полностью определенная подпрограмма, указанная в пакете. */</span></div><div class="crayon-line" id="crayon-63f82f57e133f980662931-29"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">FUNCTION</span><span class="crayon-h"> </span>hire_employee<span class="crayon-h"> </span>(</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e133f980662931-30"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>ename<span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-r">VARCHAR2</span>,</div><div class="crayon-line" id="crayon-63f82f57e133f980662931-31"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>job<span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">VARCHAR2</span>,</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e133f980662931-32"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>mgr<span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">REAL</span>,</div><div class="crayon-line" id="crayon-63f82f57e133f980662931-33"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>sal<span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">REAL</span>,</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e133f980662931-34"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>comm<span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">REAL</span>,</div><div class="crayon-line" id="crayon-63f82f57e133f980662931-35"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>deptno<span class="crayon-h"> </span><span class="crayon-r">REAL</span>)<span class="crayon-h"> </span><span class="crayon-r">RETURN</span><span class="crayon-h"> </span><span class="crayon-r">INT</span><span class="crayon-h"> </span><span class="crayon-r">IS</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e133f980662931-36"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>new_empno<span class="crayon-h"> </span><span class="crayon-r">INT</span>;</div><div class="crayon-line" id="crayon-63f82f57e133f980662931-37"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">BEGIN</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e133f980662931-38"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">SELECT</span><span class="crayon-h"> </span>empno_seq.NEXTVAL<span class="crayon-h"> </span><span class="crayon-r">INTO</span><span class="crayon-h"> </span>new_empno<span class="crayon-h"> </span><span class="crayon-r">FROM</span><span class="crayon-h"> </span>dual;</div><div class="crayon-line" id="crayon-63f82f57e133f980662931-39"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">INSERT</span><span class="crayon-h"> </span><span class="crayon-r">INTO</span><span class="crayon-h"> </span>emp<span class="crayon-h"> </span><span class="crayon-r">VALUES</span><span class="crayon-h"> </span>(new_empno,<span class="crayon-h"> </span>ename,<span class="crayon-h"> </span>job,</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e133f980662931-40"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>mgr,<span class="crayon-h"> </span><span class="crayon-r">SYSDATE</span>,<span class="crayon-h"> </span>sal,<span class="crayon-h"> </span>comm,<span class="crayon-h"> </span>deptno);</div><div class="crayon-line" id="crayon-63f82f57e133f980662931-41"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>number_hired<span class="crayon-h"> </span>:=<span class="crayon-h"> </span>number_hired<span class="crayon-h"> </span>+<span class="crayon-h"> </span>1;</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e133f980662931-42"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">RETURN</span><span class="crayon-h"> </span>new_empno;</div><div class="crayon-line" id="crayon-63f82f57e133f980662931-43"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">END</span><span class="crayon-h"> </span>hire_employee;</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e133f980662931-44"><span class="crayon-h"></span></div><div class="crayon-line" id="crayon-63f82f57e133f980662931-45"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">PROCEDURE</span><span class="crayon-h"> </span>fire_employee<span class="crayon-h"> </span>(emp_id<span class="crayon-h"> </span><span class="crayon-r">INT</span>)<span class="crayon-h"> </span><span class="crayon-r">IS</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e133f980662931-46"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">BEGIN</span></div><div class="crayon-line" id="crayon-63f82f57e133f980662931-47"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">DELETE</span><span class="crayon-h"> </span><span class="crayon-r">FROM</span><span class="crayon-h"> </span>emp<span class="crayon-h"> </span><span class="crayon-r">WHERE</span><span class="crayon-h"> </span>empno<span class="crayon-h"> </span>=<span class="crayon-h"> </span>emp_id;</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e133f980662931-48"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">END</span><span class="crayon-h"> </span>fire_employee;</div><div class="crayon-line" id="crayon-63f82f57e133f980662931-49">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e133f980662931-50"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-c">/* Определенная локальная функция, доступна только внутри пакета. */</span></div><div class="crayon-line" id="crayon-63f82f57e133f980662931-51"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">FUNCTION</span><span class="crayon-h"> </span>sal_ok<span class="crayon-h"> </span>(<span class="crayon-k">rank</span><span class="crayon-h"> </span><span class="crayon-r">INT</span>,<span class="crayon-h"> </span>salary<span class="crayon-h"> </span><span class="crayon-r">REAL</span>)<span class="crayon-h"> </span><span class="crayon-r">RETURN</span><span class="crayon-h"> </span><span class="crayon-t">BOOLEAN</span><span class="crayon-h"> </span><span class="crayon-r">IS</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e133f980662931-52"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>min_sal<span class="crayon-h"> </span><span class="crayon-r">REAL</span>;</div><div class="crayon-line" id="crayon-63f82f57e133f980662931-53"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>max_sal<span class="crayon-h"> </span><span class="crayon-r">REAL</span>;</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e133f980662931-54"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">BEGIN</span></div><div class="crayon-line" id="crayon-63f82f57e133f980662931-55"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">SELECT</span><span class="crayon-h"> </span>losal,<span class="crayon-h"> </span>hisal<span class="crayon-h"> </span><span class="crayon-r">INTO</span><span class="crayon-h"> </span>min_sal,<span class="crayon-h"> </span>max_sal<span class="crayon-h"> </span><span class="crayon-r">FROM</span><span class="crayon-h"> </span>salgrade</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e133f980662931-56"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-r">WHERE</span><span class="crayon-h"> </span>grade<span class="crayon-h"> </span>=<span class="crayon-h"> </span><span class="crayon-k">rank</span>;</div><div class="crayon-line" id="crayon-63f82f57e133f980662931-57"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">RETURN</span><span class="crayon-h"> </span>(salary<span class="crayon-h"> </span><span class="crayon-h">&gt;</span>=<span class="crayon-h"> </span>min_sal)<span class="crayon-h"> </span><span class="crayon-r">AND</span><span class="crayon-h"> </span>(salary<span class="crayon-h"> </span><span class="crayon-h">&lt;</span>=<span class="crayon-h"> </span>max_sal);</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e133f980662931-58"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">END</span><span class="crayon-h"> </span>sal_ok;</div><div class="crayon-line" id="crayon-63f82f57e133f980662931-59">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e133f980662931-60"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">PROCEDURE</span><span class="crayon-h"> </span>raise_salary<span class="crayon-h"> </span>(emp_id<span class="crayon-h"> </span><span class="crayon-r">INT</span>,<span class="crayon-h"> </span>grade<span class="crayon-h"> </span><span class="crayon-r">INT</span>,<span class="crayon-h"> </span>amount<span class="crayon-h"> </span><span class="crayon-r">REAL</span>)<span class="crayon-h"> </span><span class="crayon-r">IS</span></div><div class="crayon-line" id="crayon-63f82f57e133f980662931-61"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>salary<span class="crayon-h"> </span><span class="crayon-r">REAL</span>;</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e133f980662931-62"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">BEGIN</span></div><div class="crayon-line" id="crayon-63f82f57e133f980662931-63"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">SELECT</span><span class="crayon-h"> </span>sal<span class="crayon-h"> </span><span class="crayon-r">INTO</span><span class="crayon-h"> </span>salary<span class="crayon-h"> </span><span class="crayon-r">FROM</span><span class="crayon-h"> </span>emp<span class="crayon-h"> </span><span class="crayon-r">WHERE</span><span class="crayon-h"> </span>empno<span class="crayon-h"> </span>=<span class="crayon-h"> </span>emp_id;</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e133f980662931-64"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">IF</span><span class="crayon-h"> </span>sal_ok(grade,<span class="crayon-h"> </span>salary<span class="crayon-h"> </span>+<span class="crayon-h"> </span>amount)<span class="crayon-h"> </span><span class="crayon-r">THEN</span></div><div class="crayon-line" id="crayon-63f82f57e133f980662931-65"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-r">UPDATE</span><span class="crayon-h"> </span>emp<span class="crayon-h"> </span><span class="crayon-r">SET</span><span class="crayon-h"> </span>sal<span class="crayon-h"> </span>=<span class="crayon-h"> </span>sal<span class="crayon-h"> </span>+<span class="crayon-h"> </span>amount<span class="crayon-h"> </span><span class="crayon-r">WHERE</span><span class="crayon-h"> </span>empno<span class="crayon-h"> </span>=<span class="crayon-h"> </span>emp_id;</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e133f980662931-66"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">ELSE</span></div><div class="crayon-line" id="crayon-63f82f57e133f980662931-67"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>RAISE<span class="crayon-h"> </span>invalid_salary;</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e133f980662931-68"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">END</span><span class="crayon-h"> </span><span class="crayon-r">IF</span>;</div><div class="crayon-line" id="crayon-63f82f57e133f980662931-69"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">END</span><span class="crayon-h"> </span>raise_salary;</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e133f980662931-70"><span class="crayon-h"></span></div><div class="crayon-line" id="crayon-63f82f57e133f980662931-71"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">FUNCTION</span><span class="crayon-h"> </span>nth_highest_salary<span class="crayon-h"> </span>(n<span class="crayon-h"> </span><span class="crayon-r">INT</span>)<span class="crayon-h"> </span><span class="crayon-r">RETURN</span><span class="crayon-h"> </span>EmpRecTyp<span class="crayon-h"> </span><span class="crayon-r">IS</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e133f980662931-72"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>emp_rec<span class="crayon-h"> </span>EmpRecTyp;</div><div class="crayon-line" id="crayon-63f82f57e133f980662931-73"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">BEGIN</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e133f980662931-74"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">OPEN</span><span class="crayon-h"> </span>desc_salary;</div><div class="crayon-line" id="crayon-63f82f57e133f980662931-75"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">FOR</span><span class="crayon-h"> </span>i<span class="crayon-h"> </span><span class="crayon-r">IN</span><span class="crayon-h"> </span>1..n<span class="crayon-h"> </span>LOOP</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e133f980662931-76"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-r">FETCH</span><span class="crayon-h"> </span>desc_salary<span class="crayon-h"> </span><span class="crayon-r">INTO</span><span class="crayon-h"> </span>emp_rec;</div><div class="crayon-line" id="crayon-63f82f57e133f980662931-77"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">END</span><span class="crayon-h"> </span>LOOP;</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e133f980662931-78"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">CLOSE</span><span class="crayon-h"> </span>desc_salary;</div><div class="crayon-line" id="crayon-63f82f57e133f980662931-79"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">RETURN</span><span class="crayon-h"> </span>emp_rec;</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e133f980662931-80"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">END</span><span class="crayon-h"> </span>nth_highest_salary;</div><div class="crayon-line" id="crayon-63f82f57e133f980662931-81"><span class="crayon-h"></span></div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e133f980662931-82"><span class="crayon-r">BEGIN</span><span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">-- часть инициализации начинается здесь</span></div><div class="crayon-line" id="crayon-63f82f57e133f980662931-83"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">INSERT</span><span class="crayon-h"> </span><span class="crayon-r">INTO</span><span class="crayon-h"> </span>emp_audit<span class="crayon-h"> </span><span class="crayon-r">VALUES</span><span class="crayon-h"> </span>(<span class="crayon-r">SYSDATE</span>,<span class="crayon-h"> </span><span class="crayon-r">USER</span>,<span class="crayon-h"> </span><span class="crayon-s">'EMP_ACTIONS'</span>);</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e133f980662931-84"><span class="crayon-h">&nbsp;&nbsp; </span>number_hired<span class="crayon-h"> </span>:=<span class="crayon-h"> </span>0;</div><div class="crayon-line" id="crayon-63f82f57e133f980662931-85"><span class="crayon-r">END</span><span class="crayon-h"> </span>emp_actions;</div></div></td></tr></table></div></div><p></p><p>Помните, что часть инициализации пакета запускается только один раз, когда вы впервые ссылаетесь на пакет. Итак, в последнем примере в таблицу базы данных <span class="arg">emp_audit</span> вставляется только одна строка. Аналогично, переменная <span class="arg">number_hired</span> инициализируется только один раз.</p><p>Каждый раз, когда вызывается процедура <span class="arg">hire_employee</span>, переменная <span class="arg">number_hired</span> обновляется. Тем не менее, число, сохраняемое в <span class="arg">number_hired</span>, зависит от конкретной сессии. То есть количество отражает количество новых сотрудников, обработанных одним пользователем, а не количество, обработанное всеми пользователями.</p><h3>Пример пакета банковских операций</h3><p>Следующий пример - это ваш пакет некоторых типичных банковских операций. Предположим, что дебетовые и кредитные транзакции вводятся в нерабочее время через банкоматы, а затем применяются к счетам на следующее утро.</p><p></p><div id="crayon-63f82f57e1341568878686" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top:12px;margin-bottom:12px;font-size:12px!important;line-height:15px!important"><div class="crayon-toolbar" data-settings=" show" style="font-size:12px!important;height:18px!important;line-height:18px!important"><span class="crayon-title"></span><div class="crayon-tools" style="font-size:12px!important;height:18px!important;line-height:18px!important"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Oracle PL/SQL</span></div></div><div class="crayon-info" style="min-height:16.8px!important;line-height:16.8px!important"></div><div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4;font-size:12px!important;line-height:15px!important">
CREATE PACKAGE bank_transactions AS
/* Объявление внешней видимой константы. */
minimum_balance  CONSTANT REAL := 100.00;
/* Объявление внешней вызываемой процедуры. */
PROCEDURE apply_transactions;
PROCEDURE enter_transaction (
acct   INT,
kind   CHAR,
amount REAL);
END bank_transactions;
CREATE PACKAGE BODY bank_transactions AS
/* Объявите глобальной переменной для хранения статуса транзакции. */
new_status  VARCHAR2(70) := 'Unknown';
/* Используйте предварительные объявления, потому что apply_transactions
вызывает credit_account и debit_account, которые еще не объявлены, когда вызовы сделаны. */
PROCEDURE credit_account (acct INT, credit REAL);
PROCEDURE debit_account (acct INT, debit REAL);
/* Полностью определить процедуры, указанные в пакете. */
PROCEDURE apply_transactions IS

/* Применить ожидающие транзакции в таблице transactions
к таблице accounts. Используйте курсор для выборки строк. */
CURSOR trans_cursor IS
SELECT acct_id, kind, amount FROM transactions
WHERE status = 'Pending'
ORDER BY time_tag
FOR UPDATE OF status;  -- для блокировки строки
BEGIN
FOR trans IN trans_cursor LOOP
IF trans.kind = 'D' THEN
debit_account(trans.acct_id, trans.amount);
ELSIF trans.kind = 'C' THEN
credit_account(trans.acct_id, trans.amount);
ELSE
new_status := 'Rejected';
END IF;
UPDATE transactions SET status = new_status
WHERE CURRENT OF trans_cursor;
END LOOP;
END apply_transactions;
PROCEDURE enter_transaction (
/* Добавить транзакцию в таблицу transactions. */
acct   INT,
kind   CHAR,
amount REAL) IS
BEGIN
INSERT INTO transactions
VALUES (acct, kind, amount, 'Pending', SYSDATE);
END enter_transaction;
/* Определите локальные процедуры, доступные только в пакете. */
PROCEDURE do_journal_entry (
/* Запись транзакции в журнале. */
acct    INT,
kind    CHAR,
new_bal REAL) IS
BEGIN
INSERT INTO journal
VALUES (acct, kind, new_bal, sysdate);
IF kind = 'D' THEN
new_status := 'Debit applied';
ELSE
new_status := 'Credit applied';
END IF;
END do_journal_entry;
PROCEDURE credit_account (acct INT, credit REAL) IS
/* Кредитный счет, кроме плохого номер счета (который не существует). */
old_balance REAL;
new_balance REAL;
BEGIN
SELECT balance INTO old_balance FROM accounts
WHERE acct_id = acct
FOR UPDATE OF balance;  -- для блокировки строки
new_balance := old_balance + credit;
UPDATE accounts SET balance = new_balance
WHERE acct_id = acct;
do_journal_entry(acct, 'C', new_balance);
EXCEPTION
WHEN NO_DATA_FOUND THEN
new_status := 'Bad account number';
WHEN OTHERS THEN
new_status := SUBSTR(SQLERRM,1,70);
END credit_account;
PROCEDURE debit_account (acct INT, debit REAL) IS
/* Дебетовый счет, если номер счета не является плохим или
на счету недостаточно средств. */
old_balance REAL;
new_balance REAL;
insufficient_funds EXCEPTION;
BEGIN
SELECT balance INTO old_balance FROM accounts
WHERE acct_id = acct
FOR UPDATE OF balance;  -- для блокировки строки
new_balance := old_balance - debit;
IF new_balance &gt;= minimum_balance THEN
UPDATE accounts SET balance = new_balance
WHERE acct_id = acct;
do_journal_entry(acct, 'D', new_balance);
ELSE
RAISE insufficient_funds;
END IF;
EXCEPTION
WHEN NO_DATA_FOUND THEN
new_status := 'Bad account number';
WHEN insufficient_funds THEN
new_status := 'Insufficient funds';
WHEN OTHERS THEN
new_status := SUBSTR(SQLERRM,1,70);
END debit_account;
END bank_transactions;</textarea></div><div class="crayon-main" style=""><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums" data-settings="hide"><div class="crayon-nums-content" style="font-size:12px!important;line-height:15px!important"><div class="crayon-num" data-line="crayon-63f82f57e1341568878686-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1341568878686-2">2</div><div class="crayon-num" data-line="crayon-63f82f57e1341568878686-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1341568878686-4">4</div><div class="crayon-num" data-line="crayon-63f82f57e1341568878686-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1341568878686-6">6</div><div class="crayon-num" data-line="crayon-63f82f57e1341568878686-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1341568878686-8">8</div><div class="crayon-num" data-line="crayon-63f82f57e1341568878686-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1341568878686-10">10</div><div class="crayon-num" data-line="crayon-63f82f57e1341568878686-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1341568878686-12">12</div><div class="crayon-num" data-line="crayon-63f82f57e1341568878686-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1341568878686-14">14</div><div class="crayon-num" data-line="crayon-63f82f57e1341568878686-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1341568878686-16">16</div><div class="crayon-num" data-line="crayon-63f82f57e1341568878686-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1341568878686-18">18</div><div class="crayon-num" data-line="crayon-63f82f57e1341568878686-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1341568878686-20">20</div><div class="crayon-num" data-line="crayon-63f82f57e1341568878686-21">21</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1341568878686-22">22</div><div class="crayon-num" data-line="crayon-63f82f57e1341568878686-23">23</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1341568878686-24">24</div><div class="crayon-num" data-line="crayon-63f82f57e1341568878686-25">25</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1341568878686-26">26</div><div class="crayon-num" data-line="crayon-63f82f57e1341568878686-27">27</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1341568878686-28">28</div><div class="crayon-num" data-line="crayon-63f82f57e1341568878686-29">29</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1341568878686-30">30</div><div class="crayon-num" data-line="crayon-63f82f57e1341568878686-31">31</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1341568878686-32">32</div><div class="crayon-num" data-line="crayon-63f82f57e1341568878686-33">33</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1341568878686-34">34</div><div class="crayon-num" data-line="crayon-63f82f57e1341568878686-35">35</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1341568878686-36">36</div><div class="crayon-num" data-line="crayon-63f82f57e1341568878686-37">37</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1341568878686-38">38</div><div class="crayon-num" data-line="crayon-63f82f57e1341568878686-39">39</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1341568878686-40">40</div><div class="crayon-num" data-line="crayon-63f82f57e1341568878686-41">41</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1341568878686-42">42</div><div class="crayon-num" data-line="crayon-63f82f57e1341568878686-43">43</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1341568878686-44">44</div><div class="crayon-num" data-line="crayon-63f82f57e1341568878686-45">45</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1341568878686-46">46</div><div class="crayon-num" data-line="crayon-63f82f57e1341568878686-47">47</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1341568878686-48">48</div><div class="crayon-num" data-line="crayon-63f82f57e1341568878686-49">49</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1341568878686-50">50</div><div class="crayon-num" data-line="crayon-63f82f57e1341568878686-51">51</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1341568878686-52">52</div><div class="crayon-num" data-line="crayon-63f82f57e1341568878686-53">53</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1341568878686-54">54</div><div class="crayon-num" data-line="crayon-63f82f57e1341568878686-55">55</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1341568878686-56">56</div><div class="crayon-num" data-line="crayon-63f82f57e1341568878686-57">57</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1341568878686-58">58</div><div class="crayon-num" data-line="crayon-63f82f57e1341568878686-59">59</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1341568878686-60">60</div><div class="crayon-num" data-line="crayon-63f82f57e1341568878686-61">61</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1341568878686-62">62</div><div class="crayon-num" data-line="crayon-63f82f57e1341568878686-63">63</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1341568878686-64">64</div><div class="crayon-num" data-line="crayon-63f82f57e1341568878686-65">65</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1341568878686-66">66</div><div class="crayon-num" data-line="crayon-63f82f57e1341568878686-67">67</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1341568878686-68">68</div><div class="crayon-num" data-line="crayon-63f82f57e1341568878686-69">69</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1341568878686-70">70</div><div class="crayon-num" data-line="crayon-63f82f57e1341568878686-71">71</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1341568878686-72">72</div><div class="crayon-num" data-line="crayon-63f82f57e1341568878686-73">73</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1341568878686-74">74</div><div class="crayon-num" data-line="crayon-63f82f57e1341568878686-75">75</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1341568878686-76">76</div><div class="crayon-num" data-line="crayon-63f82f57e1341568878686-77">77</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1341568878686-78">78</div><div class="crayon-num" data-line="crayon-63f82f57e1341568878686-79">79</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1341568878686-80">80</div><div class="crayon-num" data-line="crayon-63f82f57e1341568878686-81">81</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1341568878686-82">82</div><div class="crayon-num" data-line="crayon-63f82f57e1341568878686-83">83</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1341568878686-84">84</div><div class="crayon-num" data-line="crayon-63f82f57e1341568878686-85">85</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1341568878686-86">86</div><div class="crayon-num" data-line="crayon-63f82f57e1341568878686-87">87</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1341568878686-88">88</div><div class="crayon-num" data-line="crayon-63f82f57e1341568878686-89">89</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1341568878686-90">90</div><div class="crayon-num" data-line="crayon-63f82f57e1341568878686-91">91</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1341568878686-92">92</div><div class="crayon-num" data-line="crayon-63f82f57e1341568878686-93">93</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1341568878686-94">94</div><div class="crayon-num" data-line="crayon-63f82f57e1341568878686-95">95</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1341568878686-96">96</div><div class="crayon-num" data-line="crayon-63f82f57e1341568878686-97">97</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1341568878686-98">98</div><div class="crayon-num" data-line="crayon-63f82f57e1341568878686-99">99</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1341568878686-100">100</div><div class="crayon-num" data-line="crayon-63f82f57e1341568878686-101">101</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1341568878686-102">102</div><div class="crayon-num" data-line="crayon-63f82f57e1341568878686-103">103</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1341568878686-104">104</div><div class="crayon-num" data-line="crayon-63f82f57e1341568878686-105">105</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1341568878686-106">106</div><div class="crayon-num" data-line="crayon-63f82f57e1341568878686-107">107</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1341568878686-108">108</div><div class="crayon-num" data-line="crayon-63f82f57e1341568878686-109">109</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1341568878686-110">110</div><div class="crayon-num" data-line="crayon-63f82f57e1341568878686-111">111</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1341568878686-112">112</div><div class="crayon-num" data-line="crayon-63f82f57e1341568878686-113">113</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1341568878686-114">114</div><div class="crayon-num" data-line="crayon-63f82f57e1341568878686-115">115</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1341568878686-116">116</div></div></td><td class="crayon-code"><div class="crayon-pre" style="font-size:12px!important;line-height:15px!important;-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4"><div class="crayon-line" id="crayon-63f82f57e1341568878686-1"><span class="crayon-r">CREATE</span><span class="crayon-h"> </span><span class="crayon-r">PACKAGE</span><span class="crayon-h"> </span>bank_transactions<span class="crayon-h"> </span><span class="crayon-r">AS</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1341568878686-2"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-c">/* Объявление внешней видимой константы. */</span></div><div class="crayon-line" id="crayon-63f82f57e1341568878686-3"><span class="crayon-h">&nbsp;&nbsp; </span>minimum_balance<span class="crayon-h">&nbsp;&nbsp;</span>CONSTANT<span class="crayon-h"> </span><span class="crayon-r">REAL</span><span class="crayon-h"> </span>:=<span class="crayon-h"> </span>100.00;</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1341568878686-4"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-c">/* Объявление внешней вызываемой процедуры. */</span></div><div class="crayon-line" id="crayon-63f82f57e1341568878686-5"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">PROCEDURE</span><span class="crayon-h"> </span>apply_transactions;</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1341568878686-6"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">PROCEDURE</span><span class="crayon-h"> </span>enter_transaction<span class="crayon-h"> </span>(</div><div class="crayon-line" id="crayon-63f82f57e1341568878686-7"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>acct<span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">INT</span>,</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1341568878686-8"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>kind<span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">CHAR</span>,</div><div class="crayon-line" id="crayon-63f82f57e1341568878686-9"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>amount<span class="crayon-h"> </span><span class="crayon-r">REAL</span>);</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1341568878686-10"><span class="crayon-r">END</span><span class="crayon-h"> </span>bank_transactions;</div><div class="crayon-line" id="crayon-63f82f57e1341568878686-11">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1341568878686-12"><span class="crayon-r">CREATE</span><span class="crayon-h"> </span><span class="crayon-r">PACKAGE</span><span class="crayon-h"> </span><span class="crayon-r">BODY</span><span class="crayon-h"> </span>bank_transactions<span class="crayon-h"> </span><span class="crayon-r">AS</span></div><div class="crayon-line" id="crayon-63f82f57e1341568878686-13"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-c">/* Объявите глобальной переменной для хранения статуса транзакции. */</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1341568878686-14"><span class="crayon-h">&nbsp;&nbsp; </span>new_status<span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-r">VARCHAR2</span>(70)<span class="crayon-h"> </span>:=<span class="crayon-h"> </span><span class="crayon-s">'Unknown'</span>;</div><div class="crayon-line" id="crayon-63f82f57e1341568878686-15">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1341568878686-16"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-c">/* Используйте предварительные объявления, потому что apply_transactions</span></div><div class="crayon-line" id="crayon-63f82f57e1341568878686-17"><span class="crayon-c">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; вызывает credit_account и debit_account, которые еще не объявлены, когда вызовы сделаны. */</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1341568878686-18"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">PROCEDURE</span><span class="crayon-h"> </span>credit_account<span class="crayon-h"> </span>(acct<span class="crayon-h"> </span><span class="crayon-r">INT</span>,<span class="crayon-h"> </span>credit<span class="crayon-h"> </span><span class="crayon-r">REAL</span>);</div><div class="crayon-line" id="crayon-63f82f57e1341568878686-19"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">PROCEDURE</span><span class="crayon-h"> </span>debit_account<span class="crayon-h"> </span>(acct<span class="crayon-h"> </span><span class="crayon-r">INT</span>,<span class="crayon-h"> </span>debit<span class="crayon-h"> </span><span class="crayon-r">REAL</span>);</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1341568878686-20">&nbsp;</div><div class="crayon-line" id="crayon-63f82f57e1341568878686-21"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-c">/* Полностью определить процедуры, указанные в пакете. */</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1341568878686-22"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">PROCEDURE</span><span class="crayon-h"> </span>apply_transactions<span class="crayon-h"> </span><span class="crayon-r">IS</span></div><div class="crayon-line" id="crayon-63f82f57e1341568878686-23"><span class="crayon-h">&nbsp;&nbsp;</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1341568878686-24"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-c">/* Применить ожидающие транзакции в таблице transactions</span></div><div class="crayon-line" id="crayon-63f82f57e1341568878686-25"><span class="crayon-c">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; к таблице accounts. Используйте курсор для выборки строк. */</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1341568878686-26"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">CURSOR</span><span class="crayon-h"> </span>trans_cursor<span class="crayon-h"> </span><span class="crayon-r">IS</span></div><div class="crayon-line" id="crayon-63f82f57e1341568878686-27"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-r">SELECT</span><span class="crayon-h"> </span>acct_id,<span class="crayon-h"> </span>kind,<span class="crayon-h"> </span>amount<span class="crayon-h"> </span><span class="crayon-r">FROM</span><span class="crayon-h"> </span>transactions</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1341568878686-28"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">WHERE</span><span class="crayon-h"> </span>status<span class="crayon-h"> </span>=<span class="crayon-h"> </span><span class="crayon-s">'Pending'</span></div><div class="crayon-line" id="crayon-63f82f57e1341568878686-29"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">ORDER</span><span class="crayon-h"> </span><span class="crayon-r">BY</span><span class="crayon-h"> </span>time_tag</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1341568878686-30"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">FOR</span><span class="crayon-h"> </span><span class="crayon-r">UPDATE</span><span class="crayon-h"> </span><span class="crayon-r">OF</span><span class="crayon-h"> </span>status;<span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">-- для блокировки строки</span></div><div class="crayon-line" id="crayon-63f82f57e1341568878686-31"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">BEGIN</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1341568878686-32"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">FOR</span><span class="crayon-h"> </span>trans<span class="crayon-h"> </span><span class="crayon-r">IN</span><span class="crayon-h"> </span>trans_cursor<span class="crayon-h"> </span>LOOP</div><div class="crayon-line" id="crayon-63f82f57e1341568878686-33"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-r">IF</span><span class="crayon-h"> </span>trans.kind<span class="crayon-h"> </span>=<span class="crayon-h"> </span><span class="crayon-s">'D'</span><span class="crayon-h"> </span><span class="crayon-r">THEN</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1341568878686-34"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>debit_account(trans.acct_id,<span class="crayon-h"> </span>trans.amount);</div><div class="crayon-line" id="crayon-63f82f57e1341568878686-35"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>ELSIF<span class="crayon-h"> </span>trans.kind<span class="crayon-h"> </span>=<span class="crayon-h"> </span><span class="crayon-s">'C'</span><span class="crayon-h"> </span><span class="crayon-r">THEN</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1341568878686-36"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>credit_account(trans.acct_id,<span class="crayon-h"> </span>trans.amount);</div><div class="crayon-line" id="crayon-63f82f57e1341568878686-37"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-r">ELSE</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1341568878686-38"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>new_status<span class="crayon-h"> </span>:=<span class="crayon-h"> </span><span class="crayon-s">'Rejected'</span>;</div><div class="crayon-line" id="crayon-63f82f57e1341568878686-39"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-r">END</span><span class="crayon-h"> </span><span class="crayon-r">IF</span>;</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1341568878686-40"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-r">UPDATE</span><span class="crayon-h"> </span>transactions<span class="crayon-h"> </span><span class="crayon-r">SET</span><span class="crayon-h"> </span>status<span class="crayon-h"> </span>=<span class="crayon-h"> </span>new_status</div><div class="crayon-line" id="crayon-63f82f57e1341568878686-41"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">WHERE</span><span class="crayon-h"> </span><span class="crayon-r">CURRENT</span><span class="crayon-h"> </span><span class="crayon-r">OF</span><span class="crayon-h"> </span>trans_cursor;</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1341568878686-42"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">END</span><span class="crayon-h"> </span>LOOP;</div><div class="crayon-line" id="crayon-63f82f57e1341568878686-43"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">END</span><span class="crayon-h"> </span>apply_transactions;</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1341568878686-44">&nbsp;</div><div class="crayon-line" id="crayon-63f82f57e1341568878686-45"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">PROCEDURE</span><span class="crayon-h"> </span>enter_transaction<span class="crayon-h"> </span>(</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1341568878686-46"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-c">/* Добавить транзакцию в таблицу transactions. */</span></div><div class="crayon-line" id="crayon-63f82f57e1341568878686-47"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>acct<span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">INT</span>,</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1341568878686-48"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>kind<span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">CHAR</span>,</div><div class="crayon-line" id="crayon-63f82f57e1341568878686-49"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>amount<span class="crayon-h"> </span><span class="crayon-r">REAL</span>)<span class="crayon-h"> </span><span class="crayon-r">IS</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1341568878686-50"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">BEGIN</span></div><div class="crayon-line" id="crayon-63f82f57e1341568878686-51"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">INSERT</span><span class="crayon-h"> </span><span class="crayon-r">INTO</span><span class="crayon-h"> </span>transactions</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1341568878686-52"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-r">VALUES</span><span class="crayon-h"> </span>(acct,<span class="crayon-h"> </span>kind,<span class="crayon-h"> </span>amount,<span class="crayon-h"> </span><span class="crayon-s">'Pending'</span>,<span class="crayon-h"> </span><span class="crayon-r">SYSDATE</span>);</div><div class="crayon-line" id="crayon-63f82f57e1341568878686-53"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">END</span><span class="crayon-h"> </span>enter_transaction;</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1341568878686-54">&nbsp;</div><div class="crayon-line" id="crayon-63f82f57e1341568878686-55"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-c">/* Определите локальные процедуры, доступные только в пакете. */</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1341568878686-56"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">PROCEDURE</span><span class="crayon-h"> </span>do_journal_entry<span class="crayon-h"> </span>(</div><div class="crayon-line" id="crayon-63f82f57e1341568878686-57"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-c">/* Запись транзакции в журнале. */</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1341568878686-58"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>acct<span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">INT</span>,</div><div class="crayon-line" id="crayon-63f82f57e1341568878686-59"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>kind<span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">CHAR</span>,</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1341568878686-60"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>new_bal<span class="crayon-h"> </span><span class="crayon-r">REAL</span>)<span class="crayon-h"> </span><span class="crayon-r">IS</span></div><div class="crayon-line" id="crayon-63f82f57e1341568878686-61"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">BEGIN</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1341568878686-62"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">INSERT</span><span class="crayon-h"> </span><span class="crayon-r">INTO</span><span class="crayon-h"> </span>journal</div><div class="crayon-line" id="crayon-63f82f57e1341568878686-63"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-r">VALUES</span><span class="crayon-h"> </span>(acct,<span class="crayon-h"> </span>kind,<span class="crayon-h"> </span>new_bal,<span class="crayon-h"> </span><span class="crayon-r">sysdate</span>);</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1341568878686-64"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">IF</span><span class="crayon-h"> </span>kind<span class="crayon-h"> </span>=<span class="crayon-h"> </span><span class="crayon-s">'D'</span><span class="crayon-h"> </span><span class="crayon-r">THEN</span></div><div class="crayon-line" id="crayon-63f82f57e1341568878686-65"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>new_status<span class="crayon-h"> </span>:=<span class="crayon-h"> </span><span class="crayon-s">'Debit applied'</span>;</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1341568878686-66"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">ELSE</span></div><div class="crayon-line" id="crayon-63f82f57e1341568878686-67"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>new_status<span class="crayon-h"> </span>:=<span class="crayon-h"> </span><span class="crayon-s">'Credit applied'</span>;</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1341568878686-68"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">END</span><span class="crayon-h"> </span><span class="crayon-r">IF</span>;</div><div class="crayon-line" id="crayon-63f82f57e1341568878686-69"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">END</span><span class="crayon-h"> </span>do_journal_entry;</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1341568878686-70">&nbsp;</div><div class="crayon-line" id="crayon-63f82f57e1341568878686-71"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">PROCEDURE</span><span class="crayon-h"> </span>credit_account<span class="crayon-h"> </span>(acct<span class="crayon-h"> </span><span class="crayon-r">INT</span>,<span class="crayon-h"> </span>credit<span class="crayon-h"> </span><span class="crayon-r">REAL</span>)<span class="crayon-h"> </span><span class="crayon-r">IS</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1341568878686-72"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-c">/* Кредитный счет, кроме плохого номер счета (который не существует). */</span></div><div class="crayon-line" id="crayon-63f82f57e1341568878686-73"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>old_balance<span class="crayon-h"> </span><span class="crayon-r">REAL</span>;</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1341568878686-74"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>new_balance<span class="crayon-h"> </span><span class="crayon-r">REAL</span>;</div><div class="crayon-line" id="crayon-63f82f57e1341568878686-75"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">BEGIN</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1341568878686-76"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">SELECT</span><span class="crayon-h"> </span>balance<span class="crayon-h"> </span><span class="crayon-r">INTO</span><span class="crayon-h"> </span>old_balance<span class="crayon-h"> </span><span class="crayon-r">FROM</span><span class="crayon-h"> </span>accounts</div><div class="crayon-line" id="crayon-63f82f57e1341568878686-77"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-r">WHERE</span><span class="crayon-h"> </span>acct_id<span class="crayon-h"> </span>=<span class="crayon-h"> </span>acct</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1341568878686-78"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-r">FOR</span><span class="crayon-h"> </span><span class="crayon-r">UPDATE</span><span class="crayon-h"> </span><span class="crayon-r">OF</span><span class="crayon-h"> </span>balance;<span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">-- для блокировки строки</span></div><div class="crayon-line" id="crayon-63f82f57e1341568878686-79"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>new_balance<span class="crayon-h"> </span>:=<span class="crayon-h"> </span>old_balance<span class="crayon-h"> </span>+<span class="crayon-h"> </span>credit;</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1341568878686-80"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">UPDATE</span><span class="crayon-h"> </span>accounts<span class="crayon-h"> </span><span class="crayon-r">SET</span><span class="crayon-h"> </span>balance<span class="crayon-h"> </span>=<span class="crayon-h"> </span>new_balance</div><div class="crayon-line" id="crayon-63f82f57e1341568878686-81"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-r">WHERE</span><span class="crayon-h"> </span>acct_id<span class="crayon-h"> </span>=<span class="crayon-h"> </span>acct;</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1341568878686-82"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>do_journal_entry(acct,<span class="crayon-h"> </span><span class="crayon-s">'C'</span>,<span class="crayon-h"> </span>new_balance);</div><div class="crayon-line" id="crayon-63f82f57e1341568878686-83"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">EXCEPTION</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1341568878686-84"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">WHEN</span><span class="crayon-h"> </span>NO_DATA_FOUND<span class="crayon-h"> </span><span class="crayon-r">THEN</span></div><div class="crayon-line" id="crayon-63f82f57e1341568878686-85"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>new_status<span class="crayon-h"> </span>:=<span class="crayon-h"> </span><span class="crayon-s">'Bad account number'</span>;</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1341568878686-86"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">WHEN</span><span class="crayon-h"> </span>OTHERS<span class="crayon-h"> </span><span class="crayon-r">THEN</span></div><div class="crayon-line" id="crayon-63f82f57e1341568878686-87"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>new_status<span class="crayon-h"> </span>:=<span class="crayon-h"> </span><span class="crayon-k">SUBSTR</span>(<span class="crayon-k">SQLERRM</span>,1,70);</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1341568878686-88"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">END</span><span class="crayon-h"> </span>credit_account;</div><div class="crayon-line" id="crayon-63f82f57e1341568878686-89">&nbsp;</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1341568878686-90"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">PROCEDURE</span><span class="crayon-h"> </span>debit_account<span class="crayon-h"> </span>(acct<span class="crayon-h"> </span><span class="crayon-r">INT</span>,<span class="crayon-h"> </span>debit<span class="crayon-h"> </span><span class="crayon-r">REAL</span>)<span class="crayon-h"> </span><span class="crayon-r">IS</span></div><div class="crayon-line" id="crayon-63f82f57e1341568878686-91"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-c">/* Дебетовый счет, если номер счета не является плохим или</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1341568878686-92"><span class="crayon-c">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; на счету недостаточно средств. */</span></div><div class="crayon-line" id="crayon-63f82f57e1341568878686-93"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>old_balance<span class="crayon-h"> </span><span class="crayon-r">REAL</span>;</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1341568878686-94"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>new_balance<span class="crayon-h"> </span><span class="crayon-r">REAL</span>;</div><div class="crayon-line" id="crayon-63f82f57e1341568878686-95"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>insufficient_funds<span class="crayon-h"> </span><span class="crayon-r">EXCEPTION</span>;</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1341568878686-96"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">BEGIN</span></div><div class="crayon-line" id="crayon-63f82f57e1341568878686-97"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">SELECT</span><span class="crayon-h"> </span>balance<span class="crayon-h"> </span><span class="crayon-r">INTO</span><span class="crayon-h"> </span>old_balance<span class="crayon-h"> </span><span class="crayon-r">FROM</span><span class="crayon-h"> </span>accounts</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1341568878686-98"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-r">WHERE</span><span class="crayon-h"> </span>acct_id<span class="crayon-h"> </span>=<span class="crayon-h"> </span>acct</div><div class="crayon-line" id="crayon-63f82f57e1341568878686-99"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-r">FOR</span><span class="crayon-h"> </span><span class="crayon-r">UPDATE</span><span class="crayon-h"> </span><span class="crayon-r">OF</span><span class="crayon-h"> </span>balance;<span class="crayon-h">&nbsp;&nbsp;</span><span class="crayon-c">-- для блокировки строки</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1341568878686-100"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>new_balance<span class="crayon-h"> </span>:=<span class="crayon-h"> </span>old_balance<span class="crayon-h"> </span>-<span class="crayon-h"> </span>debit;</div><div class="crayon-line" id="crayon-63f82f57e1341568878686-101"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">IF</span><span class="crayon-h"> </span>new_balance<span class="crayon-h"> </span><span class="crayon-h">&gt;</span>=<span class="crayon-h"> </span>minimum_balance<span class="crayon-h"> </span><span class="crayon-r">THEN</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1341568878686-102"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-r">UPDATE</span><span class="crayon-h"> </span>accounts<span class="crayon-h"> </span><span class="crayon-r">SET</span><span class="crayon-h"> </span>balance<span class="crayon-h"> </span>=<span class="crayon-h"> </span>new_balance</div><div class="crayon-line" id="crayon-63f82f57e1341568878686-103"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">WHERE</span><span class="crayon-h"> </span>acct_id<span class="crayon-h"> </span>=<span class="crayon-h"> </span>acct;</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1341568878686-104"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>do_journal_entry(acct,<span class="crayon-h"> </span><span class="crayon-s">'D'</span>,<span class="crayon-h"> </span>new_balance);</div><div class="crayon-line" id="crayon-63f82f57e1341568878686-105"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">ELSE</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1341568878686-106"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>RAISE<span class="crayon-h"> </span>insufficient_funds;</div><div class="crayon-line" id="crayon-63f82f57e1341568878686-107"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">END</span><span class="crayon-h"> </span><span class="crayon-r">IF</span>;</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1341568878686-108"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">EXCEPTION</span></div><div class="crayon-line" id="crayon-63f82f57e1341568878686-109"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">WHEN</span><span class="crayon-h"> </span>NO_DATA_FOUND<span class="crayon-h"> </span><span class="crayon-r">THEN</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1341568878686-110"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>new_status<span class="crayon-h"> </span>:=<span class="crayon-h"> </span><span class="crayon-s">'Bad account number'</span>;</div><div class="crayon-line" id="crayon-63f82f57e1341568878686-111"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">WHEN</span><span class="crayon-h"> </span>insufficient_funds<span class="crayon-h"> </span><span class="crayon-r">THEN</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1341568878686-112"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>new_status<span class="crayon-h"> </span>:=<span class="crayon-h"> </span><span class="crayon-s">'Insufficient funds'</span>;</div><div class="crayon-line" id="crayon-63f82f57e1341568878686-113"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">WHEN</span><span class="crayon-h"> </span>OTHERS<span class="crayon-h"> </span><span class="crayon-r">THEN</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1341568878686-114"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>new_status<span class="crayon-h"> </span>:=<span class="crayon-h"> </span><span class="crayon-k">SUBSTR</span>(<span class="crayon-k">SQLERRM</span>,1,70);</div><div class="crayon-line" id="crayon-63f82f57e1341568878686-115"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">END</span><span class="crayon-h"> </span>debit_account;</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1341568878686-116"><span class="crayon-r">END</span><span class="crayon-h"> </span>bank_transactions;</div></div></td></tr></table></div></div><p>В этом примере пакета часть инициализации не используется.</p><p><a name="pprivat"></a></p><h2>Приватные и публичные элементы в пакетах</h2><p>Посмотрите еще раз на пакет <span class="arg">emp_actions</span>. Тело пакета объявляет переменную с именем <span class="arg">number_hired</span>, которая инициализируется <code>0</code> - нулем. В отличие от элементов, объявленных в спецификации <span class="arg">emp_actions</span>, элементы, объявленные в теле, ограничены для использования в пакете. Поэтому код PL/SQL вне пакета не может ссылаться на переменную <span class="arg">number_hired</span>. Такие элементы называются приватными.</p><p>Однако элементы, объявленные в спецификации <span class="arg">emp_actions</span>, такие как исключение <span class="arg">invalid_salary</span>, видны вне пакета. Поэтому любой код PL/SQL может ссылаться на исключение <span class="arg">invalid_salary</span>. Такие элементы называются публичными.</p><p>Когда вы должны поддерживать элементы в течение сеанса или между транзакциями, поместите их в декларативную часть тела пакета. Например, значение <span class="arg">number_hired</span> сохраняется между вызовами <span class="arg">hire_employee</span> в одном и том же сеансе. Значение теряется при завершении сеанса.</p><p>Если вы также должны сделать элементы публичными, поместите их в спецификацию пакета. Например, константа <span class="arg">minimum_balance</span>, объявленная в спецификации пакета <span class="arg">bank_transactions</span>, доступна для общего пользования.</p><p><a name="pover"></a></p><h2>Перегрузка подпрограмм пакета</h2><p>PL/SQL позволяет двум или более подпрограммам пакета иметь одинаковое имя. Эта опция полезна, когда вы хотите, чтобы подпрограмма принимала аналогичные наборы параметров, которые имеют разные типы данных. Например, следующий пакет определяет две процедуры с именем <span class="arg">journalize</span>:</p><p></p><div id="crayon-63f82f57e1344125055034" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top:12px;margin-bottom:12px;font-size:12px!important;line-height:15px!important"><div class="crayon-toolbar" data-settings=" show" style="font-size:12px!important;height:18px!important;line-height:18px!important"><span class="crayon-title"></span><div class="crayon-tools" style="font-size:12px!important;height:18px!important;line-height:18px!important"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Oracle PL/SQL</span></div></div><div class="crayon-info" style="min-height:16.8px!important;line-height:16.8px!important"></div><div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4;font-size:12px!important;line-height:15px!important">
CREATE PACKAGE journal_entries AS
...
PROCEDURE journalize (amount REAL, trans_date VARCHAR2);
PROCEDURE journalize (amount REAL, trans_date INT);
END journal_entries;
CREATE PACKAGE BODY journal_entries AS
...
PROCEDURE journalize (amount REAL, trans_date VARCHAR2) IS
BEGIN
INSERT INTO journal
VALUES (amount, TO_DATE(trans_date, 'DD-MON-YYYY'));
END journalize;
PROCEDURE journalize (amount REAL, trans_date INT) IS
BEGIN
INSERT INTO journal
VALUES (amount, TO_DATE(trans_date, 'J'));
END journalize;
END journal_entries;</textarea></div><div class="crayon-main" style=""><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums" data-settings="hide"><div class="crayon-nums-content" style="font-size:12px!important;line-height:15px!important"><div class="crayon-num" data-line="crayon-63f82f57e1344125055034-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1344125055034-2">2</div><div class="crayon-num" data-line="crayon-63f82f57e1344125055034-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1344125055034-4">4</div><div class="crayon-num" data-line="crayon-63f82f57e1344125055034-5">5</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1344125055034-6">6</div><div class="crayon-num" data-line="crayon-63f82f57e1344125055034-7">7</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1344125055034-8">8</div><div class="crayon-num" data-line="crayon-63f82f57e1344125055034-9">9</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1344125055034-10">10</div><div class="crayon-num" data-line="crayon-63f82f57e1344125055034-11">11</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1344125055034-12">12</div><div class="crayon-num" data-line="crayon-63f82f57e1344125055034-13">13</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1344125055034-14">14</div><div class="crayon-num" data-line="crayon-63f82f57e1344125055034-15">15</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1344125055034-16">16</div><div class="crayon-num" data-line="crayon-63f82f57e1344125055034-17">17</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1344125055034-18">18</div><div class="crayon-num" data-line="crayon-63f82f57e1344125055034-19">19</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e1344125055034-20">20</div></div></td><td class="crayon-code"><div class="crayon-pre" style="font-size:12px!important;line-height:15px!important;-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4"><div class="crayon-line" id="crayon-63f82f57e1344125055034-1"><span class="crayon-r">CREATE</span><span class="crayon-h"> </span><span class="crayon-r">PACKAGE</span><span class="crayon-h"> </span>journal_entries<span class="crayon-h"> </span><span class="crayon-r">AS</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1344125055034-2"><span class="crayon-h">&nbsp;&nbsp; </span>...</div><div class="crayon-line" id="crayon-63f82f57e1344125055034-3"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">PROCEDURE</span><span class="crayon-h"> </span>journalize<span class="crayon-h"> </span>(amount<span class="crayon-h"> </span><span class="crayon-r">REAL</span>,<span class="crayon-h"> </span>trans_date<span class="crayon-h"> </span><span class="crayon-r">VARCHAR2</span>);</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1344125055034-4"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">PROCEDURE</span><span class="crayon-h"> </span>journalize<span class="crayon-h"> </span>(amount<span class="crayon-h"> </span><span class="crayon-r">REAL</span>,<span class="crayon-h"> </span>trans_date<span class="crayon-h"> </span><span class="crayon-r">INT</span>);</div><div class="crayon-line" id="crayon-63f82f57e1344125055034-5"><span class="crayon-r">END</span><span class="crayon-h"> </span>journal_entries;</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1344125055034-6">&nbsp;</div><div class="crayon-line" id="crayon-63f82f57e1344125055034-7"><span class="crayon-r">CREATE</span><span class="crayon-h"> </span><span class="crayon-r">PACKAGE</span><span class="crayon-h"> </span><span class="crayon-r">BODY</span><span class="crayon-h"> </span>journal_entries<span class="crayon-h"> </span><span class="crayon-r">AS</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1344125055034-8"><span class="crayon-h">&nbsp;&nbsp; </span>...</div><div class="crayon-line" id="crayon-63f82f57e1344125055034-9"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">PROCEDURE</span><span class="crayon-h"> </span>journalize<span class="crayon-h"> </span>(amount<span class="crayon-h"> </span><span class="crayon-r">REAL</span>,<span class="crayon-h"> </span>trans_date<span class="crayon-h"> </span><span class="crayon-r">VARCHAR2</span>)<span class="crayon-h"> </span><span class="crayon-r">IS</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1344125055034-10"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">BEGIN</span></div><div class="crayon-line" id="crayon-63f82f57e1344125055034-11"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">INSERT</span><span class="crayon-h"> </span><span class="crayon-r">INTO</span><span class="crayon-h"> </span>journal</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1344125055034-12"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-r">VALUES</span><span class="crayon-h"> </span>(amount,<span class="crayon-h"> </span><span class="crayon-k">TO_DATE</span>(trans_date,<span class="crayon-h"> </span><span class="crayon-s">'DD-MON-YYYY'</span>));</div><div class="crayon-line" id="crayon-63f82f57e1344125055034-13"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">END</span><span class="crayon-h"> </span>journalize;</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1344125055034-14">&nbsp;</div><div class="crayon-line" id="crayon-63f82f57e1344125055034-15"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">PROCEDURE</span><span class="crayon-h"> </span>journalize<span class="crayon-h"> </span>(amount<span class="crayon-h"> </span><span class="crayon-r">REAL</span>,<span class="crayon-h"> </span>trans_date<span class="crayon-h"> </span><span class="crayon-r">INT</span>)<span class="crayon-h"> </span><span class="crayon-r">IS</span></div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1344125055034-16"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">BEGIN</span></div><div class="crayon-line" id="crayon-63f82f57e1344125055034-17"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="crayon-r">INSERT</span><span class="crayon-h"> </span><span class="crayon-r">INTO</span><span class="crayon-h"> </span>journal</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1344125055034-18"><span class="crayon-h">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span><span class="crayon-r">VALUES</span><span class="crayon-h"> </span>(amount,<span class="crayon-h"> </span><span class="crayon-k">TO_DATE</span>(trans_date,<span class="crayon-h"> </span><span class="crayon-s">'J'</span>));</div><div class="crayon-line" id="crayon-63f82f57e1344125055034-19"><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-r">END</span><span class="crayon-h"> </span>journalize;</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e1344125055034-20"><span class="crayon-r">END</span><span class="crayon-h"> </span>journal_entries;</div></div></td></tr></table></div></div><p></p><p>Первая процедура принимает <span class="arg">trans_date</span> как символьную строку, в то время как вторая процедура принимает ее как число (юлианский день). Каждая процедура обрабатывает данные соответствующим образом.</p><p><a name="pstand"></a></p><h2>Как пакет STANDARD определяет среду Oracle PL/SQL</h2><p>Пакет с именем STANDARD определяет среду PL/SQL. Спецификация пакета глобально объявляет типы, исключения и подпрограммы, которые автоматически доступны для программ PL/SQL. Например, пакет STANDARD объявляет функцию ABS, которая возвращает абсолютное значение своего аргумента, следующим образом:</p><p></p><div id="crayon-63f82f57e134f203294395" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top:12px;margin-bottom:12px;font-size:12px!important;line-height:15px!important"><div class="crayon-toolbar" data-settings=" show" style="font-size:12px!important;height:18px!important;line-height:18px!important"><span class="crayon-title"></span><div class="crayon-tools" style="font-size:12px!important;height:18px!important;line-height:18px!important"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Oracle PL/SQL</span></div></div><div class="crayon-info" style="min-height:16.8px!important;line-height:16.8px!important"></div><div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4;font-size:12px!important;line-height:15px!important">
FUNCTION ABS (n NUMBER) RETURN NUMBER;</textarea></div><div class="crayon-main" style=""><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums" data-settings="hide"><div class="crayon-nums-content" style="font-size:12px!important;line-height:15px!important"><div class="crayon-num" data-line="crayon-63f82f57e134f203294395-1">1</div></div></td><td class="crayon-code"><div class="crayon-pre" style="font-size:12px!important;line-height:15px!important;-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4"><div class="crayon-line" id="crayon-63f82f57e134f203294395-1"><span class="crayon-r">FUNCTION</span><span class="crayon-h"> </span><span class="crayon-k">ABS</span><span class="crayon-h"> </span>(n<span class="crayon-h"> </span><span class="crayon-r">NUMBER</span>)<span class="crayon-h"> </span><span class="crayon-r">RETURN</span><span class="crayon-h"> </span><span class="crayon-r">NUMBER</span>;</div></div></td></tr></table></div></div><p></p><p>Содержимое пакета STANDARD непосредственно видно приложениям. Вам не нужно указывать ссылки на его содержимое, добавляя префикс имени пакета. Например, вы можете вызывать ABS из триггера базы данных, хранимой подпрограммы, инструмента Oracle или приложения 3GL следующим образом:</p><p></p><div id="crayon-63f82f57e1352567740418" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top:12px;margin-bottom:12px;font-size:12px!important;line-height:15px!important"><div class="crayon-toolbar" data-settings=" show" style="font-size:12px!important;height:18px!important;line-height:18px!important"><span class="crayon-title"></span><div class="crayon-tools" style="font-size:12px!important;height:18px!important;line-height:18px!important"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Oracle PL/SQL</span></div></div><div class="crayon-info" style="min-height:16.8px!important;line-height:16.8px!important"></div><div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4;font-size:12px!important;line-height:15px!important">
abs_diff := ABS(x - y);</textarea></div><div class="crayon-main" style=""><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums" data-settings="hide"><div class="crayon-nums-content" style="font-size:12px!important;line-height:15px!important"><div class="crayon-num" data-line="crayon-63f82f57e1352567740418-1">1</div></div></td><td class="crayon-code"><div class="crayon-pre" style="font-size:12px!important;line-height:15px!important;-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4"><div class="crayon-line" id="crayon-63f82f57e1352567740418-1">abs_diff<span class="crayon-h"> </span>:=<span class="crayon-h"> </span><span class="crayon-k">ABS</span>(x<span class="crayon-h"> </span>-<span class="crayon-h"> </span>y);</div></div></td></tr></table></div></div><p></p><p>Если вы повторно объявите ABS в программе PL/SQL, ваша локальная декларация переопределяет глобальную декларацию. Однако вы все равно можете вызвать встроенную функцию, указав ссылку на ABS следующим образом:</p><p></p><div id="crayon-63f82f57e1359553730791" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top:12px;margin-bottom:12px;font-size:12px!important;line-height:15px!important"><div class="crayon-toolbar" data-settings=" show" style="font-size:12px!important;height:18px!important;line-height:18px!important"><span class="crayon-title"></span><div class="crayon-tools" style="font-size:12px!important;height:18px!important;line-height:18px!important"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Oracle PL/SQL</span></div></div><div class="crayon-info" style="min-height:16.8px!important;line-height:16.8px!important"></div><div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4;font-size:12px!important;line-height:15px!important">
abs_diff := STANDARD.ABS(x - y);</textarea></div><div class="crayon-main" style=""><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums" data-settings="hide"><div class="crayon-nums-content" style="font-size:12px!important;line-height:15px!important"><div class="crayon-num" data-line="crayon-63f82f57e1359553730791-1">1</div></div></td><td class="crayon-code"><div class="crayon-pre" style="font-size:12px!important;line-height:15px!important;-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4"><div class="crayon-line" id="crayon-63f82f57e1359553730791-1">abs_diff<span class="crayon-h"> </span>:=<span class="crayon-h"> </span>STANDARD.<span class="crayon-k">ABS</span>(x<span class="crayon-h"> </span>-<span class="crayon-h"> </span>y);</div></div></td></tr></table></div></div><p></p><p>Большинство встроенных функций перегружены. Например, пакет STANDARD содержит следующие объявления:</p><p></p><div id="crayon-63f82f57e135c982356971" class="crayon-syntax crayon-theme-classic crayon-font-monaco crayon-os-pc print-yes notranslate" data-settings=" minimize scroll-mouseover" style="margin-top:12px;margin-bottom:12px;font-size:12px!important;line-height:15px!important"><div class="crayon-toolbar" data-settings=" show" style="font-size:12px!important;height:18px!important;line-height:18px!important"><span class="crayon-title"></span><div class="crayon-tools" style="font-size:12px!important;height:18px!important;line-height:18px!important"><div class="crayon-button crayon-nums-button" title="Toggle Line Numbers"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-plain-button" title="Toggle Plain Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-wrap-button" title="Toggle Line Wrap"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-expand-button" title="Expand Code"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-copy-button" title="Copy"><div class="crayon-button-icon"></div></div><div class="crayon-button crayon-popup-button" title="Open Code In New Window"><div class="crayon-button-icon"></div></div><span class="crayon-language">Oracle PL/SQL</span></div></div><div class="crayon-info" style="min-height:16.8px!important;line-height:16.8px!important"></div><div class="crayon-plain-wrap"><textarea wrap="soft" class="crayon-plain print-no" data-settings="dblclick" readonly="" style="-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4;font-size:12px!important;line-height:15px!important">
FUNCTION TO_CHAR (right DATE) RETURN VARCHAR2;
FUNCTION TO_CHAR (left NUMBER) RETURN VARCHAR2;
FUNCTION TO_CHAR (left DATE, right VARCHAR2) RETURN VARCHAR2;
FUNCTION TO_CHAR (left NUMBER, right VARCHAR2) RETURN VARCHAR2;</textarea></div><div class="crayon-main" style=""><table class="crayon-table"><tr class="crayon-row"><td class="crayon-nums" data-settings="hide"><div class="crayon-nums-content" style="font-size:12px!important;line-height:15px!important"><div class="crayon-num" data-line="crayon-63f82f57e135c982356971-1">1</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e135c982356971-2">2</div><div class="crayon-num" data-line="crayon-63f82f57e135c982356971-3">3</div><div class="crayon-num crayon-striped-num" data-line="crayon-63f82f57e135c982356971-4">4</div></div></td><td class="crayon-code"><div class="crayon-pre" style="font-size:12px!important;line-height:15px!important;-moz-tab-size:4;-o-tab-size:4;-webkit-tab-size:4;tab-size:4"><div class="crayon-line" id="crayon-63f82f57e135c982356971-1"><span class="crayon-r">FUNCTION</span><span class="crayon-h"> </span><span class="crayon-k">TO_CHAR</span><span class="crayon-h"> </span>(<span class="crayon-st">right</span><span class="crayon-h"> </span><span class="crayon-r">DATE</span>)<span class="crayon-h"> </span><span class="crayon-r">RETURN</span><span class="crayon-h"> </span><span class="crayon-r">VARCHAR2</span>;</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e135c982356971-2"><span class="crayon-r">FUNCTION</span><span class="crayon-h"> </span><span class="crayon-k">TO_CHAR</span><span class="crayon-h"> </span>(<span class="crayon-st">left</span><span class="crayon-h"> </span><span class="crayon-r">NUMBER</span>)<span class="crayon-h"> </span><span class="crayon-r">RETURN</span><span class="crayon-h"> </span><span class="crayon-r">VARCHAR2</span>;</div><div class="crayon-line" id="crayon-63f82f57e135c982356971-3"><span class="crayon-r">FUNCTION</span><span class="crayon-h"> </span><span class="crayon-k">TO_CHAR</span><span class="crayon-h"> </span>(<span class="crayon-st">left</span><span class="crayon-h"> </span><span class="crayon-r">DATE</span>,<span class="crayon-h"> </span><span class="crayon-st">right</span><span class="crayon-h"> </span><span class="crayon-r">VARCHAR2</span>)<span class="crayon-h"> </span><span class="crayon-r">RETURN</span><span class="crayon-h"> </span><span class="crayon-r">VARCHAR2</span>;</div><div class="crayon-line crayon-striped-line" id="crayon-63f82f57e135c982356971-4"><span class="crayon-r">FUNCTION</span><span class="crayon-h"> </span><span class="crayon-k">TO_CHAR</span><span class="crayon-h"> </span>(<span class="crayon-st">left</span><span class="crayon-h"> </span><span class="crayon-r">NUMBER</span>,<span class="crayon-h"> </span><span class="crayon-st">right</span><span class="crayon-h"> </span><span class="crayon-r">VARCHAR2</span>)<span class="crayon-h"> </span><span class="crayon-r">RETURN</span><span class="crayon-h"> </span><span class="crayon-r">VARCHAR2</span>;</div></div></td></tr></table></div></div><p></p><p>PL/SQL разрешает вызов TO_CHAR путем сопоставления числа и типов данных формальных и фактических параметров.</p><p><a name="rules"></a></p><h2>Руководство по написанию пакетов</h2><p>При написании пакетов держите их как можно более общими, чтобы их можно было использовать в будущих приложениях. Избегайте написания пакетов, которые дублируют некоторые функции, уже предоставленные Oracle.</p><p>Спецификации пакета отражают дизайн вашего приложения. Определяйте их перед телом пакета. Поместите в спецификацию только те типы, элементы и подпрограммы, которые должны быть видны пользователям пакета. Таким образом, другие разработчики не могут неправильно использовать пакет, основывая свой код на нерелевантных деталях реализации.</p><p>Чтобы уменьшить необходимость перекомпиляции при изменении кода, поместите как можно меньше элементов в спецификацию пакета. Изменения в теле пакета не требуют, чтобы Oracle перекомпилировал зависимые процедуры. Однако изменения в спецификации пакета требуют, чтобы Oracle перекомпилировал каждую сохраненную подпрограмму, которая ссылается на пакет.</p><p><a href="https://docs.oracle.com/cd/A97630_01/appdev.920/a96624/09_packs.htm">Оригинал статьи.</a></p></div><footer class="entry-meta"><span class="cat-links">Рубрика:&nbsp;<a href="category/oracle-programming.html" rel="category tag">Программирование Oracle / PLSQL</a></span> <span class="sep">| </span><span class="permalink"><a href="packages-oracle-plsql.html" rel="bookmark" title="Прямая ссылка на Oracle PL/SQL Пакеты">Permalink</a></span></footer></article><nav role="navigation" id="nav-below" class="site-navigation post-navigation"><h1 class="assistive-text">Post navigation</h1><div class="nav-previous"><a href="conditions-sql-server.html" rel="prev"><span class="meta-nav">&laquo;</span> SQL Server условия</a></div><div class="nav-next"><a href="aliases-sql.html" rel="next">SQL псевдонимы <span class="meta-nav">&raquo;</span></a></div></nav></div></div><div id="secondary" class="widget-area"><div id="sidebar-1" class="sidebar" role="complementary"><aside id="nav_menu-4" class="widget widget_nav_menu"><h1 class="widget-title">ORACLE PL/SQL</h1><div class="menu-programmirovanie-oracle-plsql-container"><ul id="menu-programmirovanie-oracle-plsql" class="menu"><li id="menu-item-2217" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-2217"><a href="procedures.html">Процедуры</a></li><li id="menu-item-2218" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-2218"><a href="functions.html">Функции</a></li><li id="menu-item-2216" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-2216"><a href="triggers.html">Триггеры</a></li><li id="menu-item-7466" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-7466"><a href="collections-and-records-oracle-plsql.html">Коллекции и записи</a></li><li id="menu-item-2246" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-2246"><a href="cursors.html">Курсоры</a></li><li id="menu-item-7709" class="menu-item menu-item-type-custom menu-item-object-custom current-menu-item menu-item-7709"><a href="packages-oracle-plsql.html" aria-current="page">Пакеты</a></li><li id="menu-item-8217" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-8217"><a href="dynamic-sql.html">Динамический SQL</a></li><li id="menu-item-2353" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-2353"><a href="sequences.html">Последовательности</a></li><li id="menu-item-2540" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-2540"><a href="tables-and-views.html">Таблицы и представления</a></li><li id="menu-item-2677" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-2677"><a href="datatypes.html">Типы данных</a></li><li id="menu-item-2449" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-2449"><a href="transactions.html">Транзакции</a></li><li id="menu-item-2316" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-2316"><a href="conditional-statements.html">Условные операторы</a></li><li id="menu-item-2340" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-2340"><a href="loops.html">Циклы</a></li><li id="menu-item-8302" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-8302"><a href="anonymous-block-plsql.html">Блоки PL/SQL</a></li></ul></div></aside><aside id="nav_menu-2" class="widget widget_nav_menu"><h1 class="widget-title">ФУНКЦИИ ORACLE/PLSQL</h1><div class="menu-funkczii-oracle-pl-sql-container"><ul id="menu-funkczii-oracle-pl-sql" class="menu"><li id="menu-item-4" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-4"><a title="function category" href="index.html">По категориям</a></li><li id="menu-item-7402" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-7402"><a href="analytic.html">Аналитические</a></li><li id="menu-item-7405" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-7405"><a href="string-character.html">Символьные / строковые</a></li><li id="menu-item-7406" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-7406"><a href="numeric-mathematical.html">Числовые / математические</a></li><li id="menu-item-7403" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-7403"><a href="date-time.html">Дата / время</a></li><li id="menu-item-7407" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-7407"><a href="conversion.html">Преобразование</a></li><li id="menu-item-7404" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-7404"><a href="advanced-function.html">Вспомогательные</a></li></ul></div></aside><aside id="custom_html-14" class="widget_text widget widget_custom_html"><div class="textwidget custom-html-widget"></div></aside></div></div></div><footer id="colophon" class="site-footer" role="contentinfo"><div class="site-info"><div>&copy; Клуб дедов-программистов</div></div></footer></div><script src="wp-content/cache/min/1/5da3b72814b1a36896cd845e11329e29.js" data-minify="1" defer=""></script></body></html>
